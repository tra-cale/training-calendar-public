<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
<style>
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #FFF9C4 0%, #FFECB3 50%, #FFE082 100%);
  min-height: 100vh;
  padding: 20px;
  padding-bottom: 100px; /* ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ */
  color: #212121;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.hero-section {
  text-align: center;
  padding: 60px 20px;
  margin-bottom: 40px;
}

.hero-icon {
  font-size: 80px;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.hero-title {
  font-size: 2.5em;
  font-weight: bold;
  background: linear-gradient(135deg, #F57C00 0%, #FFB300 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 10px;
}

.hero-subtitle {
  font-size: 1.2em;
  color: #616161;
  margin-bottom: 30px;
}

.hero-cta {
  display: inline-block;
  padding: 16px 48px;
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  font-size: 1.2em;
  font-weight: 600;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(245, 124, 0, 0.3);
}

.hero-cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(245, 124, 0, 0.4);
}

/* ã‚«ãƒ¼ãƒ‰å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
.card {
  background: white;
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.card-title {
  font-size: 1.5em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã‚«ãƒ¼ãƒ‰ */
.profile-setup-card {
  background: linear-gradient(145deg, #FFFFFF, #FFFBF5);
}

.setup-header {
  text-align: center;
  margin-bottom: 30px;
}

.setup-title {
  font-size: 1.8em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 10px;
}

.setup-subtitle {
  color: #616161;
  font-size: 1em;
}

.form-group {
  margin-bottom: 24px;
  text-align: center;
}

.form-label {
  display: block;
  font-size: 0.95em;
  font-weight: 600;
  color: #424242;
  margin-bottom: 8px;
  text-align: center;
}

.form-hint {
  font-size: 0.85em;
  color: #9E9E9E;
  margin-top: 4px;
  text-align: center;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  font-size: 1em;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: #FFB300;
  box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.1);
}

.form-input.error {
  border-color: #EF5350;
}

.error-message {
  color: #EF5350;
  font-size: 0.85em;
  margin-top: 4px;
  display: none;
  text-align: center;
}

.error-message.show {
  display: block;
}

/* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
.radio-group {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
}

.radio-group.vertical {
  flex-direction: column;
  align-items: flex-start;
}

.radio-option {
  display: flex;
  align-items: center;
  cursor: pointer;
}

.radio-option input[type="radio"] {
  width: 20px;
  height: 20px;
  margin-right: 8px;
  cursor: pointer;
  accent-color: #F57C00;
}

.radio-option label {
  font-size: 0.95em;
  cursor: pointer;
  user-select: none;
}

/* æ•°å€¤å…¥åŠ›ã‚°ãƒ«ãƒ¼ãƒ— */
.input-with-unit {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  max-width: 200px;
  margin: 0 auto;
}

.input-with-unit .form-input {
  flex: 1;
  text-align: center;
}

.unit {
  font-size: 0.95em;
  color: #616161;
  font-weight: 500;
}

/* ãƒœã‚¿ãƒ³ */
.btn {
  padding: 14px 32px;
  font-size: 1.1em;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  display: inline-block;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  width: 100%;
  box-shadow: 0 4px 12px rgba(245, 124, 0, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(245, 124, 0, 0.4);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.skip-link {
  display: block;
  text-align: center;
  margin-top: 16px;
  color: #9E9E9E;
  text-decoration: none;
  font-size: 0.95em;
  transition: color 0.3s ease;
}

.skip-link:hover {
  color: #616161;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã‚«ãƒ¼ãƒ‰ */
.profile-display-card {
  background: linear-gradient(145deg, #FFF9C4, #FFFFFF);
  border: 2px solid #FFD54F;
  transition: all 0.3s ease;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ä¿ƒé€²æ™‚ã®å¼·èª¿è¡¨ç¤º */
.profile-display-card.highlight {
  border: 3px solid #F57C00;
  box-shadow: 0 0 0 4px rgba(245, 124, 0, 0.2), 0 4px 20px rgba(245, 124, 0, 0.3);
  animation: pulseHighlight 2s ease-in-out 3;
}

@keyframes pulseHighlight {
  0%, 100% {
    box-shadow: 0 0 0 4px rgba(245, 124, 0, 0.2), 0 4px 20px rgba(245, 124, 0, 0.3);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(245, 124, 0, 0.3), 0 6px 30px rgba(245, 124, 0, 0.5);
  }
}

.profile-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 2px solid #FFD54F;
}

.profile-name {
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.9em;
  font-weight: 600;
}

.profile-info-grid {
  list-style: none;
  padding: 0;
  margin: 0 0 20px 0;
}

.profile-info-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid #E0E0E0;
}

.profile-info-item:last-child {
  border-bottom: none;
}

.profile-info-label {
  font-size: 0.95em;
  color: #616161;
  display: flex;
  align-items: center;
  gap: 8px;
}

.profile-info-label-icon {
  font-size: 1.2em;
}

.profile-info-value {
  font-size: 1.05em;
  font-weight: 600;
  color: #212121;
}

.bmi-low {
  color: #42A5F5;
}

.bmi-normal {
  color: #66BB6A;
}

.bmi-high {
  color: #FFA726;
}

.bmi-very-high {
  color: #EF5350;
}

.btn-edit {
  background: white;
  color: #F57C00;
  border: 2px solid #F57C00;
  width: 100%;
}

.btn-edit:hover {
  background: #F57C00;
  color: white;
}

/* æœˆé–“ç›®æ¨™è¡¨ç¤ºã‚«ãƒ¼ãƒ‰ */
.goal-display-card {
  background: linear-gradient(145deg, #E8F5E9, #FFFFFF);
  border: 2px solid #66BB6A;
}

.goal-display-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 2px solid #66BB6A;
}

.goal-month-selector-home {
  display: flex;
  align-items: center;
  gap: 8px;
}

.goal-month-selector-home label {
  font-size: 0.85em;
  font-weight: 600;
  color: #616161;
}

.home-month-dropdown {
  padding: 4px 12px;
  border: 2px solid #66BB6A;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
  color: white;
  background: linear-gradient(135deg, #66BB6A, #81C784);
  cursor: pointer;
  transition: all 0.3s ease;
}

.home-month-dropdown:hover {
  background: linear-gradient(135deg, #4CAF50, #66BB6A);
}

.home-month-dropdown:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(56, 142, 60, 0.1);
}

.goal-display-grid {
  list-style: none;
  padding: 0;
  margin: 0 0 20px 0;
}

.goal-display-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid #E0E0E0;
}

.goal-display-item:last-child {
  border-bottom: none;
}

.goal-display-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  gap: 12px;
}

.goal-display-main {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 8px;
}

.goal-display-label {
  font-size: 0.95em;
  color: #616161;
  display: flex;
  align-items: center;
  gap: 8px;
}

.goal-display-label-icon {
  font-size: 1.2em;
}

.goal-display-value {
  font-size: 1.05em;
  font-weight: 600;
  color: #212121;
  margin-left: auto;
}

.goal-display-previous {
  font-size: 0.75em;
  color: #9E9E9E;
  font-weight: 500;
  white-space: nowrap;
  padding: 4px 8px;
  background: #F5F5F5;
  border-radius: 4px;
}

/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ */
.nav-card {
  display: none; /* ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã«ç½®ãæ›ãˆãŸãŸã‚éè¡¨ç¤º */
  justify-content: space-between;
  align-items: center;
  background: white;
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  text-decoration: none;
  color: inherit;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.nav-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  border-color: #FFD54F;
}

.nav-card-content {
  display: flex;
  align-items: center;
  gap: 20px;
}

.nav-card-icon {
  font-size: 2.5em;
}

.nav-card-text {
  display: flex;
  flex-direction: column;
}

.nav-card-title {
  font-size: 1.2em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 4px;
}

.nav-card-subtitle {
  font-size: 0.9em;
  color: #616161;
}

.nav-card-arrow {
  font-size: 1.5em;
  color: #FFB300;
  font-weight: bold;
}

/* æœˆé–“ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */
.goal-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 10000;
  align-items: center;
  justify-content: center;
  padding: 20px;
  overflow-y: auto;
}

.goal-modal.active {
  display: flex;
}

.goal-modal-content {
  background: white;
  border-radius: 20px;
  max-width: 800px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.goal-modal-header {
  background: linear-gradient(135deg, #66BB6A, #81C784);
  color: white;
  padding: 24px 30px;
  border-radius: 20px 20px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.goal-modal-header h2 {
  font-size: 1.6em;
  margin: 0;
}

.goal-close-btn {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: white;
  font-size: 2em;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

.goal-close-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(90deg);
}

.goal-modal-body {
  padding: 30px;
}

/* ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒœã‚¿ãƒ³ */
.goal-mode-selector {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 30px;
}

/* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³é¢¨ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒœã‚¿ãƒ³ */
.goal-mode-btn {
  width: 100%;
  background: white;
  border: 2px solid #E0E0E0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 10px;
  overflow: hidden;
}

.goal-mode-btn:hover {
  border-color: #1976D2;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.goal-mode-btn.active {
  border-color: #2196F3;
  box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
}

/* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ */
.goal-mode-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 15px 20px;
  transition: background 0.3s ease;
  font-weight: 600;
  color: #333;
}

.goal-mode-btn:hover .goal-mode-header {
  background: #F5F5F5;
}

.goal-mode-btn.active .goal-mode-header {
  background: #E3F2FD;
  color: #1976D2;
}

.goal-mode-icon {
  font-size: 1.5em;
  flex-shrink: 0;
}

.goal-mode-title {
  font-size: 1.05em;
  font-weight: 600;
  flex: 1;
}

.goal-mode-description {
  display: none; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¯è¡¨ç¤ºã—ãªã„ */
}

.goal-mode-badge {
  background: #FF9800;
  color: white;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.7em;
  font-weight: 600;
  margin-left: 8px;
}

.goal-mode-arrow {
  font-size: 0.8em;
  color: #757575;
  transition: transform 0.3s ease;
  margin-left: auto;
  flex-shrink: 0;
}

.goal-mode-btn.active .goal-mode-arrow {
  transform: rotate(90deg);
  color: #1976D2;
}

/* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.goal-mode-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease, padding 0.4s ease;
  padding: 0 20px;
}

.goal-mode-btn.active .goal-mode-content {
  max-height: 400px;
  padding: 0 20px 20px 20px;
}

.goal-mode-content-desc {
  color: #666;
  margin-bottom: 15px;
  font-size: 0.9em;
  line-height: 1.5;
}

.goal-mode-content-details {
  background: #F5F5F5;
  padding: 15px;
  border-radius: 8px;
  font-size: 0.85em;
}

.goal-mode-detail-title {
  font-weight: 600;
  color: #333;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.goal-mode-detail-item {
  margin-bottom: 8px;
  color: #555;
  padding-left: 8px;
}

.goal-mode-detail-item:last-child {
  margin-bottom: 0;
}

.goal-mode-change {
  margin-top: 12px;
  padding: 8px 12px;
  background: linear-gradient(145deg, #FFF9C4, #FFECB3);
  border-radius: 8px;
  font-size: 0.8em;
  color: #F57C00;
  font-weight: 600;
  line-height: 1.5;
  border: 1px solid #FFD54F;
}

.goal-mode-change .change-item {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  margin: 2px 0;
}

.goal-mode-change .change-value {
  color: #D84315;
  font-weight: 700;
}

/* æœˆé¸æŠ */
.goal-month-selector {
  margin-bottom: 25px;
  padding: 16px;
  background: linear-gradient(145deg, #E3F2FD, #FFFFFF);
  border-radius: 12px;
  border: 2px solid #42A5F5;
  display: flex;
  align-items: center;
  gap: 12px;
}

.goal-month-selector label {
  font-size: 1em;
  font-weight: 600;
  color: #1976D2;
  flex-shrink: 0;
}

.goal-month-dropdown {
  flex: 1;
  padding: 10px 16px;
  border: 2px solid #90CAF9;
  border-radius: 8px;
  font-size: 1em;
  font-weight: 600;
  color: #1565C0;
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
}

.goal-month-dropdown:hover {
  border-color: #42A5F5;
  background: #E3F2FD;
}

.goal-month-dropdown:focus {
  outline: none;
  border-color: #1976D2;
  box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
}

/* å‰æœˆã®ç›®æ¨™è¡¨ç¤º */
.previous-month-goal {
  margin-left: 12px;
  padding: 6px 10px;
  background: #F5F5F5;
  border-radius: 6px;
  border-left: 3px solid #9E9E9E;
  font-size: 0.8em;
  color: #616161;
  white-space: nowrap;
  align-self: center;
}

.previous-month-goal .label {
  font-weight: 600;
}

.previous-month-goal .value {
  color: #424242;
  font-weight: 500;
}

/* å…¥åŠ›ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ¨ªä¸¦ã³ã« */
.goal-input-group {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  gap: 8px;
}

.goal-input-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.goal-input-wrapper label {
  font-size: 0.9em;
  color: #424242;
  font-weight: 600;
  margin-bottom: 6px;
}

.goal-input-wrapper input {
  padding: 12px;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  font-size: 1em;
  transition: all 0.3s ease;
}

.goal-input-wrapper input:focus {
  outline: none;
  border-color: #66BB6A;
  box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.1);
}

/* ç›®æ¨™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.goal-section {
  margin-bottom: 20px;
  background: linear-gradient(145deg, #FAFAFA, #FFFFFF);
  border-radius: 12px;
  border: 2px solid #E0E0E0;
  transition: all 0.3s ease;
}

.goal-section.disabled {
  opacity: 0.5;
}

.goal-section-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  cursor: pointer;
  user-select: none;
  transition: background 0.3s ease;
  pointer-events: auto; /* å¸¸ã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ */
}

.goal-section-header:hover {
  background: rgba(102, 126, 234, 0.05);
}

.goal-section-checkbox {
  flex-shrink: 0;
}

.checkbox-custom {
  width: 24px;
  height: 24px;
  border: 2px solid #9E9E9E;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  background: white;
}

.checkbox-custom.checked {
  background: linear-gradient(135deg, #667eea, #764ba2);
  border-color: #667eea;
}

.checkbox-custom.checked::after {
  content: 'âœ“';
  color: white;
  font-size: 16px;
  font-weight: bold;
}

.goal-section-content {
  padding: 0 20px 20px 20px;
  display: block;
}

.goal-section.disabled .goal-section-content {
  display: none;
}

.goal-section-title {
  font-size: 1.2em;
  color: #212121;
  margin: 0;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.goal-current-info {
  background: linear-gradient(145deg, #E3F2FD, #FFFFFF);
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 15px;
  border-left: 4px solid #42A5F5;
}

.goal-current-title {
  font-size: 0.85em;
  color: #1976D2;
  font-weight: 600;
  margin-bottom: 4px;
}

.goal-current-value {
  font-size: 1.2em;
  color: #212121;
  font-weight: 600;
}

.goal-input-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 12px;
}

.goal-input-group {
  display: flex;
  flex-direction: column;
}

.goal-input-group label {
  font-size: 0.9em;
  color: #424242;
  font-weight: 600;
  margin-bottom: 6px;
}

.goal-input-group input {
  padding: 12px;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  font-size: 1em;
  transition: all 0.3s ease;
}

.goal-input-group input:focus {
  outline: none;
  border-color: #66BB6A;
  box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.1);
}

.goal-error-message {
  color: #EF5350;
  font-size: 0.85em;
  margin-top: 4px;
  display: none;
}

.goal-error-message.show {
  display: block;
}

.goal-hint {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 12px;
  background: #FFF9C4;
  border-radius: 8px;
  border-left: 4px solid #FFB300;
  font-size: 0.85em;
  color: #616161;
  line-height: 1.5;
}

.goal-hint-icon {
  font-size: 1.2em;
  flex-shrink: 0;
}

/* ãƒœã‚¿ãƒ³ */
.goal-buttons {
  display: flex;
  gap: 12px;
  margin-top: 30px;
}

.btn-goal-save {
  flex: 2;
  padding: 16px 32px;
  background: linear-gradient(135deg, #66BB6A, #81C784);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1.1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(102, 187, 106, 0.3);
}

.btn-goal-save:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(102, 187, 106, 0.4);
}

.btn-goal-cancel {
  flex: 1;
  padding: 16px 32px;
  background: white;
  color: #616161;
  border: 2px solid #E0E0E0;
  border-radius: 10px;
  font-size: 1.1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-goal-cancel:hover {
  background: #F5F5F5;
  border-color: #BDBDBD;
}

/* ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */
.confirm-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10001;
  animation: fadeIn 0.3s ease;
}

.confirm-modal-content {
  background: white;
  border-radius: 16px;
  padding: 0;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  animation: slideUp 0.3s ease;
}

.confirm-modal-header {
  padding: 24px;
  border-bottom: 2px solid #FFB300;
  background: linear-gradient(145deg, #FFF9C4, #FFFFFF);
}

.confirm-modal-header h3 {
  margin: 0;
  font-size: 1.4em;
  color: #F57C00;
  display: flex;
  align-items: center;
  gap: 10px;
}

.confirm-modal-body {
  padding: 24px;
  line-height: 1.8;
}

.confirm-modal-body p {
  margin-bottom: 12px;
  color: #424242;
  font-size: 0.95em;
}

.confirm-modal-body strong {
  color: #D84315;
  font-weight: 600;
}

.confirm-modal-body #confirm-month-name {
  color: #1976D2;
  font-weight: 600;
}

.confirm-modal-buttons {
  padding: 20px 24px;
  display: flex;
  gap: 12px;
  border-top: 1px solid #E0E0E0;
}

.btn-confirm-yes {
  flex: 1;
  padding: 14px 24px;
  background: linear-gradient(135deg, #66BB6A, #81C784);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-confirm-yes:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 187, 106, 0.4);
}

.btn-confirm-no {
  flex: 1;
  padding: 14px 24px;
  background: white;
  color: #616161;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-confirm-no:hover {
  background: #F5F5F5;
  border-color: #BDBDBD;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ */
.hidden {
  display: none;
}

.fade-in {
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
  .hero-title {
    font-size: 2em;
  }

  .hero-subtitle {
    font-size: 1em;
  }

  .nav-card-content {
    gap: 15px;
  }

  .nav-card-icon {
    font-size: 2em;
  }

  .nav-card-title {
    font-size: 1em;
  }

  .nav-card-subtitle {
    font-size: 0.85em;
  }

  .goal-mode-selector {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .goal-mode-btn {
    min-width: 100%;
  }

  /* ã‚¹ãƒãƒ›ç‰ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®èª¿æ•´ */
  .goal-mode-header {
    padding: 12px 16px;
    gap: 10px;
  }

  .goal-mode-icon {
    font-size: 1.3em;
  }

  .goal-mode-title {
    font-size: 0.95em;
  }

  .goal-mode-badge {
    font-size: 0.65em;
    padding: 2px 8px;
  }

  .goal-mode-content {
    padding: 0 16px;
  }

  .goal-mode-btn.active .goal-mode-content {
    padding: 0 16px 16px 16px;
  }

  .goal-mode-content-desc {
    font-size: 0.85em;
    margin-bottom: 12px;
  }

  .goal-mode-content-details {
    padding: 12px;
    font-size: 0.8em;
  }

  .goal-mode-detail-title {
    font-size: 0.9em;
    margin-bottom: 8px;
  }

  .goal-mode-detail-item {
    font-size: 0.85em;
    margin-bottom: 6px;
  }

  .goal-input-row {
    grid-template-columns: 1fr;
  }

  .goal-buttons {
    flex-direction: column;
  }
}

/* ========== ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ ========== */
.bottom-nav-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
  padding: 8px 0;
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 1000;
  border-top: 3px solid #FFD54F;
}

.bottom-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  text-decoration: none;
  color: #9E9E9E;
  transition: all 0.3s ease;
  padding: 8px 8px;
  border-radius: 12px;
  min-width: 60px;
  position: relative;
}

.bottom-nav-item:hover {
  background: #FFF9C4;
  color: #F57C00;
  transform: translateY(-3px);
}

.bottom-nav-item.active {
  color: #F57C00;
  background: #FFF9C4;
}

/* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
.bottom-nav-item.active::before {
  content: '';
  position: absolute;
  top: -3px;
  left: 50%;
  transform: translateX(-50%);
  width: 30px;
  height: 3px;
  background: linear-gradient(135deg, #F57C00, #FFB300);
  border-radius: 2px;
}

.bottom-nav-icon {
  font-size: 1.6em;
  transition: all 0.3s ease;
}

.bottom-nav-item:hover .bottom-nav-icon {
  transform: scale(1.1);
}

.bottom-nav-label {
  font-size: 0.7em;
  font-weight: 600;
  text-align: center;
  line-height: 1.2;
}

/* ãƒœãƒˆãƒ ãƒŠãƒ“ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 480px) {
  .bottom-nav-label {
    font-size: 0.6em;
  }
  
  .bottom-nav-icon {
    font-size: 1.3em;
  }
  
  .bottom-nav-item {
    min-width: 50px;
    padding: 6px 4px;
  }
}

@media (min-width: 769px) {
  /* PCç”»é¢ã§ã¯å°‘ã—å¤§ãã */
  .bottom-nav-bar {
    padding: 12px 0;
  }
  
  .bottom-nav-icon {
    font-size: 1.8em;
  }
  
  .bottom-nav-label {
    font-size: 0.75em;
  }
  
  .bottom-nav-item {
    min-width: 90px;
    padding: 10px 16px;
  }
}

/* æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ« */
.success-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 10000;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.success-modal.active {
  display: flex;
}

.success-modal-content {
  background: white;
  border-radius: 20px;
  padding: 50px 40px;
  max-width: 500px;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: slideUp 0.4s ease;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.success-icon {
  font-size: 5em;
  margin-bottom: 20px;
  animation: bounce 0.6s ease;
}

@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

.success-title {
  font-size: 2em;
  font-weight: bold;
  color: #2E7D32;
  margin-bottom: 15px;
}

.success-message {
  font-size: 1.2em;
  color: #616161;
  line-height: 1.8;
  margin-bottom: 30px;
}

.success-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
}

.btn-success {
  padding: 14px 32px;
  background: linear-gradient(135deg, #66BB6A, #43A047);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1.1em;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.3s ease;
  display: inline-block;
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(67, 160, 71, 0.4);
}

.btn-success-secondary {
  padding: 14px 32px;
  background: white;
  color: #43A047;
  border: 2px solid #43A047;
  border-radius: 10px;
  font-size: 1.1em;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.3s ease;
  display: inline-block;
}

.btn-success-secondary:hover {
  background: #E8F5E9;
  transform: translateY(-2px);
}

@media (max-width: 768px) {
  .success-modal-content {
    padding: 40px 30px;
    margin: 20px;
  }
  
  .success-buttons {
    flex-direction: column;
    width: 100%;
  }
  
  .btn-success,
  .btn-success-secondary {
    width: 100%;
  }
}
/* ========== ä»Šæ—¥ã®æ—¥ä»˜è¡¨ç¤ºï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ ========== */
.today-date-card {
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  overflow: hidden;
  width: fit-content;
  margin: 0 auto 25px auto;
}

.date-header {
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  padding: 12px 40px;
  text-align: center;
  font-size: 1em;
  font-weight: 600;
  letter-spacing: 1px;
}

.date-body {
  padding: 25px 40px;
  text-align: center;
}

.date-day {
  font-size: 3.5em;
  font-weight: 800;
  color: #F57C00;
  line-height: 1;
  margin-bottom: 8px;
}

.date-month-year {
  font-size: 1.1em;
  color: #616161;
  font-weight: 600;
  margin-bottom: 5px;
}

.date-weekday {
  font-size: 1em;
  color: #9E9E9E;
  font-weight: 500;
}

/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
@media (max-width: 768px) {
  .date-header {
    padding: 10px 30px;
    font-size: 0.95em;
  }
  
  .date-body {
    padding: 20px 30px;
  }
  
  .date-day {
    font-size: 2.8em;
  }
  
  .date-month-year {
    font-size: 1em;
  }
  
  .date-weekday {
    font-size: 0.9em;
  }
}

/* ========== é”æˆåº¦ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆNEWï¼‰ ========== */
.achievement-card {
  background: linear-gradient(145deg, #E8F5E9, #FFFFFF);
  border: 2px solid #66BB6A;
}

.achievement-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 2px solid #66BB6A;
}

.achievement-title {
  font-size: 1.4em;
  font-weight: 600;
  color: #212121;
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 0;
}

.settings-btn {
  background: linear-gradient(135deg, #42A5F5, #64B5F6);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 6px rgba(66, 165, 245, 0.3);
  display: flex;
  align-items: center;
  gap: 6px;
}

.settings-btn:hover {
  background: linear-gradient(135deg, #1976D2, #42A5F5);
  box-shadow: 0 3px 8px rgba(66, 165, 245, 0.4);
  transform: translateY(-1px);
}

/* åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
.encouragement-message {
  background: linear-gradient(145deg, #FFF9C4, #FFFFFF);
  border-left: 4px solid #66BB6A;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 15px;
}

.encouragement-message.warning {
  border-left-color: #FFB300;
}

.encouragement-message.alert {
  border-left-color: #EF5350;
}

.encouragement-icon {
  font-size: 1.5em;
  margin-bottom: 8px;
}

.encouragement-text {
  color: #424242;
  font-size: 0.95em;
  line-height: 1.6;
}

.encouragement-text strong {
  color: #2E7D32;
}

.encouragement-message.warning .encouragement-text strong {
  color: #E65100;
}

.encouragement-message.alert .encouragement-text strong {
  color: #C62828;
}

/* é”æˆåº¦ã‚°ãƒªãƒƒãƒ‰ */
.achievement-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

.achievement-item {
  background: white;
  border: 2px solid #E0E0E0;
  border-radius: 12px;
  padding: 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  transition: all 0.3s ease;
}

.achievement-item.hidden {
  display: none;
}

.achievement-item.good {
  border-color: #66BB6A;
  background: linear-gradient(145deg, #E8F5E9, #FFFFFF);
}

.achievement-item.warning {
  border-color: #FFB300;
  background: linear-gradient(145deg, #FFF9C4, #FFFFFF);
}

.achievement-item.alert {
  border-color: #EF5350;
  background: linear-gradient(145deg, #FFEBEE, #FFFFFF);
}

.achievement-icon {
  font-size: 2em;
  margin-bottom: 8px;
}

.achievement-label {
  font-size: 0.85em;
  color: #616161;
  margin-bottom: 8px;
}

.achievement-value {
  font-size: 1.3em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 8px;
}

.achievement-status {
  font-size: 0.8em;
  font-weight: 600;
  padding: 4px 12px;
  border-radius: 12px;
}

.achievement-status.good {
  background: #66BB6A;
  color: white;
}

.achievement-status.warning {
  background: #FFB300;
  color: white;
}

.achievement-status.alert {
  background: #EF5350;
  color: white;
}

/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
.progress-bar-container {
  width: 100%;
  height: 8px;
  background: #E0E0E0;
  border-radius: 4px;
  overflow: hidden;
  margin-top: 8px;
}

.progress-bar {
  height: 100%;
  transition: width 0.5s ease;
  border-radius: 4px;
}

.progress-bar.low {
  background: linear-gradient(90deg, #EF5350, #E57373);
}

.progress-bar.medium {
  background: linear-gradient(90deg, #FFB300, #FFD54F);
}

.progress-bar.high {
  background: linear-gradient(90deg, #66BB6A, #81C784);
}

/* ========== æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ ========== */
.collapsible-header {
  cursor: pointer;
  user-select: none;
  transition: background 0.3s ease;
}

.collapsible-header:hover {
  background: #F5F5F5;
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: 15px;
  border-bottom: 2px solid #FFD54F;
}

.toggle-icon {
  font-size: 1.2em;
  color: #9E9E9E;
  transition: transform 0.3s ease;
}

.toggle-icon.expanded {
  transform: rotate(180deg);
}

.card-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.card-content.expanded {
  max-height: 1000px;
  padding-top: 20px;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒãƒƒã‚¸ */
.profile-badge {
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.9em;
  font-weight: 600;
}

/* æœˆé–“ç›®æ¨™ãƒãƒƒã‚¸ */
.goal-badge {
  background: linear-gradient(135deg, #1976D2, #42A5F5);
  color: white;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
}

/* ========== è¡¨ç¤ºé …ç›®è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« ========== */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.modal-overlay.show {
  display: flex;
}

.display-settings-modal .modal-content {
  background: white;
  border-radius: 16px;
  padding: 30px;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.display-settings-modal .modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid #E0E0E0;
}

.display-settings-modal .modal-title {
  font-size: 1.5em;
  font-weight: 600;
  color: #212121;
}

.display-settings-modal .modal-close {
  background: none;
  border: none;
  font-size: 1.5em;
  color: #9E9E9E;
  cursor: pointer;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.display-settings-modal .modal-close:hover {
  background: #F5F5F5;
  color: #212121;
}

.display-options {
  list-style: none;
  padding: 0;
  margin: 0;
}

.display-option-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px;
  border-bottom: 1px solid #E0E0E0;
  transition: background 0.3s ease;
}

.display-option-item:hover {
  background: #F5F5F5;
}

.display-option-item:last-child {
  border-bottom: none;
}

.display-option-label {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1em;
  color: #424242;
}

.display-option-icon {
  font-size: 1.5em;
}

.toggle-switch {
  position: relative;
  width: 50px;
  height: 26px;
  background: #BDBDBD;
  border-radius: 13px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.toggle-switch.active {
  background: #66BB6A;
}

.toggle-slider {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  transition: transform 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.toggle-switch.active .toggle-slider {
  transform: translateX(24px);
}

.display-settings-modal .modal-footer {
  margin-top: 25px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.display-settings-modal .btn-modal {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.display-settings-modal .btn-cancel {
  background: #F5F5F5;
  color: #616161;
}

.display-settings-modal .btn-cancel:hover {
  background: #E0E0E0;
}

.display-settings-modal .btn-save {
  background: linear-gradient(135deg, #66BB6A, #81C784);
  color: white;
  box-shadow: 0 2px 6px rgba(102, 187, 106, 0.3);
}

.display-settings-modal .btn-save:hover {
  background: linear-gradient(135deg, #4CAF50, #66BB6A);
  box-shadow: 0 3px 8px rgba(102, 187, 106, 0.4);
}

/* ========== ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆNEWï¼‰ ========== */
.profile-edit-modal .modal-content {
  background: white;
  border-radius: 16px;
  padding: 30px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.profile-edit-modal .modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid #E0E0E0;
}

.profile-edit-modal .modal-title {
  font-size: 1.5em;
  font-weight: 600;
  color: #212121;
}

.profile-edit-modal .modal-close {
  background: none;
  border: none;
  font-size: 1.5em;
  color: #9E9E9E;
  cursor: pointer;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.profile-edit-modal .modal-close:hover {
  background: #F5F5F5;
  color: #212121;
}

.modal-form .form-group {
  margin-bottom: 20px;
}

.modal-form .form-label {
  display: block;
  font-size: 0.95em;
  font-weight: 600;
  color: #424242;
  margin-bottom: 8px;
}

.modal-form .form-input {
  width: 100%;
  padding: 10px 12px;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  font-size: 1em;
  color: #212121;
  transition: all 0.3s ease;
}

.modal-form .form-input:focus {
  outline: none;
  border-color: #F57C00;
  box-shadow: 0 0 0 3px rgba(245, 124, 0, 0.1);
}

.modal-form .form-input.error {
  border-color: #EF5350;
}

.modal-form .input-with-unit {
  display: flex;
  align-items: center;
  gap: 8px;
}

.modal-form .input-with-unit .form-input {
  flex: 1;
}

.modal-form .unit {
  font-size: 0.9em;
  color: #616161;
  font-weight: 600;
  white-space: nowrap;
}

.modal-form .form-hint {
  font-size: 0.85em;
  color: #9E9E9E;
  margin-top: 4px;
}

.modal-form .radio-group {
  display: flex;
  gap: 12px;
}

.modal-form .radio-group.vertical {
  flex-direction: column;
}

.modal-form .radio-group.horizontal {
  flex-direction: row;
  flex-wrap: wrap;
}

.modal-form .radio-option {
  display: flex;
  align-items: center;
}

.modal-form .radio-option input[type="radio"] {
  margin-right: 8px;
  cursor: pointer;
}

.modal-form .radio-option label {
  font-size: 0.95em;
  color: #424242;
  cursor: pointer;
}

.modal-form .error-message {
  display: none;
  font-size: 0.85em;
  color: #EF5350;
  margin-top: 4px;
}

.modal-form .error-message.show {
  display: block;
}

.profile-edit-modal .modal-footer {
  margin-top: 25px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.profile-edit-modal .btn-modal {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.profile-edit-modal .btn-cancel {
  background: #F5F5F5;
  color: #616161;
}

.profile-edit-modal .btn-cancel:hover {
  background: #E0E0E0;
}

.profile-edit-modal .btn-save {
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  box-shadow: 0 2px 6px rgba(245, 124, 0, 0.3);
}

.profile-edit-modal .btn-save:hover {
  background: linear-gradient(135deg, #E65100, #F57C00);
  box-shadow: 0 3px 8px rgba(245, 124, 0, 0.4);
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
  .achievement-grid {
    grid-template-columns: 1fr;
  }
}

/* ===== ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æœªè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ¡ˆ1: ãƒ¢ãƒ¼ãƒ€ãƒ«å‹ï¼‰ ===== */
.profile-prompt-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  animation: fadeIn 0.3s ease;
}

.profile-prompt-modal.show {
  display: flex;
}

.profile-prompt-content {
  background: white;
  border-radius: 24px;
  padding: 40px;
  max-width: 500px;
  width: 90%;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  animation: modalSlideUp 0.4s ease;
}

.profile-prompt-icon {
  font-size: 80px;
  margin-bottom: 20px;
  animation: bounce 1s infinite;
}

.profile-prompt-title {
  font-size: 1.8em;
  font-weight: 700;
  color: #333;
  margin-bottom: 15px;
}

.profile-prompt-text {
  color: #666;
  font-size: 1em;
  line-height: 1.6;
  margin-bottom: 30px;
}

.profile-prompt-buttons {
  display: flex;
  gap: 12px;
}

.profile-prompt-btn-primary {
  flex: 1;
  padding: 16px;
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1.05em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.profile-prompt-btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(245, 124, 0, 0.4);
}

.profile-prompt-btn-secondary {
  flex: 1;
  padding: 16px;
  background: transparent;
  color: #999;
  border: 2px solid #E0E0E0;
  border-radius: 12px;
  font-size: 1.05em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.profile-prompt-btn-secondary:hover {
  border-color: #999;
  color: #666;
}

/* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ */
.profile-floating-button {
  position: fixed;
  bottom: 100px; /* ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸Š */
  right: 30px;
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  padding: 16px 24px;
  border-radius: 50px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 6px 20px rgba(245, 124, 0, 0.4);
  display: none;
  align-items: center;
  gap: 8px;
  animation: floatBounce 2s ease-in-out infinite;
  z-index: 9999;
}

.profile-floating-button.show {
  display: flex;
}

.profile-floating-badge {
  background: #EF5350;
  color: white;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75em;
  font-weight: 700;
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes modalSlideUp {
  from {
    opacity: 0;
    transform: translateY(50px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

@keyframes floatBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media (max-width: 768px) {
  .profile-prompt-content {
    padding: 30px 20px;
  }
  
  .profile-floating-button {
    bottom: 90px;
    right: 20px;
    padding: 12px 20px;
    font-size: 0.9em;
  }
}

</style>
</head>
<body>

<div class="container">
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="hero-section">
    <div class="hero-icon">ğŸ</div>
    <h1 class="hero-title">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
    <p class="hero-subtitle">å¥åº·çš„ãªæ¯æ—¥ã‚’ã‚µãƒãƒ¼ãƒˆ</p>
  </section>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æœªè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ¡ˆ1: ãƒ¢ãƒ¼ãƒ€ãƒ«å‹ï¼‰ -->
  <div class="profile-prompt-modal" id="profile-prompt-modal">
    <div class="profile-prompt-content">
      <div class="profile-prompt-icon">ğŸ””</div>
      <h2 class="profile-prompt-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
      <p class="profile-prompt-text">
        ã‚ãªãŸã®å¥åº·ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã™ã‚‹å‰ã«ã€åŸºæœ¬æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹ã¨ã€<br>
        ã‚ˆã‚Šæ­£ç¢ºãªã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ã‚„BMIè¡¨ç¤ºãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
      </p>
      <div class="profile-prompt-buttons">
        <button class="profile-prompt-btn-primary" onclick="setupProfileNow()">ä»Šã™ãè¨­å®šã™ã‚‹</button>
        <button class="profile-prompt-btn-secondary" onclick="setupProfileLater()">å¾Œã§è¨­å®šã™ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ -->
  <div class="profile-floating-button" id="profile-floating-btn" onclick="showProfilePrompt()">
    <span>ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</span>
    <span class="profile-floating-badge">1</span>
  </div>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šï¼ˆåˆå›ã®ã¿è¡¨ç¤ºï¼‰ - å‰Šé™¤ã—ã¦å¸¸ã«éè¡¨ç¤º -->
  <div class="card profile-setup-card fade-in hidden" id="profile-setup">
    <div class="setup-header">
      <h2 class="setup-title">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h2>
      <p class="setup-subtitle">ã‚ãªãŸã®åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    </div>

    <form id="profile-form">
      <div class="form-group">
        <label class="form-label">æ€§åˆ¥</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="gender-male" name="gender" value="male">
            <label for="gender-male">ç”·æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="gender-female" name="gender" value="female">
            <label for="gender-female">å¥³æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="gender-other" name="gender" value="other">
            <label for="gender-other">ãã®ä»–</label>
          </div>
        </div>
        <div class="error-message" id="error-gender"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="age">å¹´é½¢</label>
        <div class="input-with-unit">
          <input type="number" id="age" class="form-input" placeholder="30" min="10" max="120">
          <span class="unit">æ­³</span>
        </div>
        <div class="error-message" id="error-age"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="height">èº«é•·ï¼ˆä»»æ„ï¼‰</label>
        <div class="input-with-unit">
          <input type="number" id="height" class="form-input" placeholder="170" min="100" max="250">
          <span class="unit">cm</span>
        </div>
        <p class="form-hint">BMIè¨ˆç®—ã«ä½¿ç”¨ã•ã‚Œã¾ã™</p>
        <div class="error-message" id="error-height"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="weight">ä½“é‡</label>
        <div class="input-with-unit">
          <input type="number" id="weight" class="form-input" placeholder="65" min="30" max="200" step="0.1">
          <span class="unit">kg</span>
        </div>
        <div class="error-message" id="error-weight"></div>
      </div>

      <button type="submit" class="btn btn-primary">âœ… å®Œäº†ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸</button>
    </form>
  </div>

  <!-- ä»Šæ—¥ã®æ—¥ä»˜è¡¨ç¤ºï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ -->
  <div class="today-date-card fade-in hidden" id="today-date-display">
    <div class="date-header" id="date-header-text">2025å¹´ 1æœˆ</div>
    <div class="date-body">
      <div class="date-day" id="date-day-value">21</div>
      <div class="date-month-year" id="date-month-year-text">January</div>
      <div class="date-weekday" id="date-weekday-text">æ°´æ›œæ—¥</div>
    </div>
  </div>

  <!-- é”æˆåº¦ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆNEWï¼‰ -->
  <div class="card achievement-card fade-in hidden" id="achievement-display">
    <div class="achievement-header">
      <div class="card-title achievement-title">ğŸ“Š ä»Šæœˆã®é”æˆåº¦</div>
      <button class="settings-btn" onclick="openDisplaySettings()">
        âš™ï¸ è¡¨ç¤ºé …ç›®
      </button>
    </div>

    <!-- åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="encouragement-message" id="encouragement-message">
      <div class="encouragement-icon">ğŸ‰</div>
      <div class="encouragement-text" id="encouragement-text">
        <strong>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</strong>
      </div>
    </div>

    <!-- é”æˆåº¦ã‚°ãƒªãƒƒãƒ‰ -->
    <div class="achievement-grid">
      <!-- è¡€åœ§ -->
      <div class="achievement-item" data-item="bloodPressure" id="achievement-bp">
        <div class="achievement-icon">ğŸ«€</div>
        <div class="achievement-label">è¡€åœ§</div>
        <div class="achievement-value" id="achievement-bp-value">--/--</div>
        <div class="achievement-status" id="achievement-bp-status">-</div>
      </div>

      <!-- ä½“é‡ -->
      <div class="achievement-item" data-item="weight" id="achievement-weight">
        <div class="achievement-icon">âš–ï¸</div>
        <div class="achievement-label">ä½“é‡</div>
        <div class="achievement-value" id="achievement-weight-value">-- kg</div>
        <div class="achievement-status" id="achievement-weight-status">-</div>
      </div>

      <!-- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•° -->
      <div class="achievement-item" data-item="trainingDays" id="achievement-days">
        <div class="achievement-icon">ğŸƒ</div>
        <div class="achievement-label">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°</div>
        <div class="achievement-value" id="achievement-days-value">0/0 æ—¥</div>
        <div class="achievement-status" id="achievement-days-status">0%</div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="achievement-days-bar" style="width: 0%"></div>
        </div>
      </div>

      <!-- é‹å‹•æ™‚é–“ -->
      <div class="achievement-item" data-item="totalTime" id="achievement-time">
        <div class="achievement-icon">â±ï¸</div>
        <div class="achievement-label">é‹å‹•æ™‚é–“</div>
        <div class="achievement-value" id="achievement-time-value">0/0 åˆ†</div>
        <div class="achievement-status" id="achievement-time-status">0%</div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="achievement-time-bar" style="width: 0%"></div>
        </div>
      </div>

      <!-- æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ -->
      <div class="achievement-item" data-item="totalCalories" id="achievement-calories">
        <div class="achievement-icon">ğŸ”¥</div>
        <div class="achievement-label">æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</div>
        <div class="achievement-value" id="achievement-calories-value">0/0</div>
        <div class="achievement-status" id="achievement-calories-status">0%</div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="achievement-calories-bar" style="width: 0%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- æœˆé–“ç›®æ¨™ã‚«ãƒ¼ãƒ‰ï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <div class="card goal-display-card fade-in hidden" id="goal-display">
    <div class="card-header goal-display-header collapsible-header" onclick="toggleCard('goal-content')">
      <div class="card-title">ğŸ¯ æœˆé–“ç›®æ¨™</div>
      <div style="display: flex; align-items: center; gap: 15px;">
        <div class="goal-badge">
          <span id="goal-display-month">11æœˆ</span>
        </div>
        <div class="toggle-icon" id="goal-toggle">â–¼</div>
      </div>
    </div>

    <div class="card-content" id="goal-content">

    <ul class="goal-display-grid" id="goal-display-content">
      <li class="goal-display-item">
        <div class="goal-display-content">
          <span class="goal-display-label">
            <span class="goal-display-label-icon">ğŸ«€</span>
            è¡€åœ§ç›®æ¨™
          </span>
          <span class="goal-display-value" id="display-goal-bp">120/80 mmHg</span>
        </div>
      </li>

      <li class="goal-display-item">
        <div class="goal-display-content">
          <span class="goal-display-label">
            <span class="goal-display-label-icon">âš–ï¸</span>
            ä½“é‡ç›®æ¨™
          </span>
          <span class="goal-display-value" id="display-goal-weight">65.0 kg</span>
        </div>
      </li>

      <li class="goal-display-item">
        <div class="goal-display-content">
          <span class="goal-display-label">
            <span class="goal-display-label-icon">ğŸ“…</span>
            ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°
          </span>
          <span class="goal-display-value" id="display-goal-days">12 æ—¥</span>
        </div>
      </li>

      <li class="goal-display-item">
        <div class="goal-display-content">
          <span class="goal-display-label">
            <span class="goal-display-label-icon">â±ï¸</span>
            é‹å‹•æ™‚é–“
          </span>
          <span class="goal-display-value" id="display-goal-time">600 åˆ†</span>
        </div>
      </li>

      <li class="goal-display-item">
        <div class="goal-display-content">
          <span class="goal-display-label">
            <span class="goal-display-label-icon">ğŸ”¥</span>
            æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼
          </span>
          <span class="goal-display-value" id="display-goal-calories">3,000 kcal</span>
        </div>
      </li>
    </ul>

    </div>

    <button class="btn btn-edit" onclick="openGoalModal()">âœï¸ ç·¨é›†</button>
  </div>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <div class="card profile-display-card fade-in hidden" id="profile-display">
    <div class="card-header profile-header collapsible-header" onclick="toggleCard('profile-content')">
      <div class="card-title">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
      <div style="display: flex; align-items: center; gap: 15px;">
        <div class="profile-name profile-badge" id="profile-name">30æ­³ãƒ»ç”·æ€§</div>
        <div class="toggle-icon" id="profile-toggle">â–¼</div>
      </div>
    </div>

    <div class="card-content" id="profile-content">

    <ul class="profile-info-grid">
      <li class="profile-info-item">
        <span class="profile-info-label">
          <span class="profile-info-label-icon">ğŸ“</span>
          èº«é•·
        </span>
        <span class="profile-info-value" id="display-height">170 cm</span>
      </li>

      <li class="profile-info-item">
        <span class="profile-info-label">
          <span class="profile-info-label-icon">âš–ï¸</span>
          ä½“é‡
        </span>
        <span class="profile-info-value" id="display-weight">65 kg</span>
      </li>

      <li class="profile-info-item">
        <span class="profile-info-label">
          <span class="profile-info-label-icon">ğŸ‘¤</span>
          æ€§åˆ¥
        </span>
        <span class="profile-info-value" id="display-gender">ç”·æ€§</span>
      </li>

      <li class="profile-info-item">
        <span class="profile-info-label">
          <span class="profile-info-label-icon">ğŸ“Š</span>
          BMI
        </span>
        <span class="profile-info-value" id="display-bmi">22.5 (æ¨™æº–)</span>
      </li>

      <li class="profile-info-item">
        <span class="profile-info-label">
          <span class="profile-info-label-icon">ğŸ”¥</span>
          åŸºç¤ä»£è¬
        </span>
        <span class="profile-info-value" id="display-bmr">ç´„1,650 kcal/æ—¥</span>
      </li>
    </ul>

    </div>

    <button class="btn btn-edit" onclick="editProfile()">âœï¸ ç·¨é›†</button>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <section class="fade-in hidden" id="main-navigation">
    <a href="calendar.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“…</div>
        <div class="nav-card-text">
          <div class="nav-card-title">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ã</div>
          <div class="nav-card-subtitle">æœˆåˆ¥ã®è¨˜éŒ²ã‚’ç¢ºèªãƒ»å…¥åŠ›</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="timeline.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“‹</div>
        <div class="nav-card-text">
          <div class="nav-card-title">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’è¦‹ã‚‹</div>
          <div class="nav-card-subtitle">éå»ã®è¨˜éŒ²ã‚’æ™‚ç³»åˆ—ã§ç¢ºèª</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="yearly-summary.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“Š</div>
        <div class="nav-card-text">
          <div class="nav-card-title">å¹´é–“ã‚µãƒãƒªãƒ¼ã‚’è¦‹ã‚‹</div>
          <div class="nav-card-subtitle">1å¹´é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="features.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“–</div>
        <div class="nav-card-text">
          <div class="nav-card-title">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</div>
          <div class="nav-card-subtitle">æ©Ÿèƒ½ã®è©³ã—ã„èª¬æ˜</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="#settings" class="nav-card" onclick="alert('è¨­å®šç”»é¢ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™'); return false;">
      <div class="nav-card-content">
        <div class="nav-card-icon">âš™ï¸</div>
        <div class="nav-card-text">
          <div class="nav-card-title">è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
          <div class="nav-card-subtitle">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ç›®æ¨™è¨­å®š</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>
  </section>
</div>

<!-- æœˆé–“ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="goal-modal" id="goalModal">
  <div class="goal-modal-content">
    <div class="goal-modal-header">
      <h2>ğŸ¯ æœˆé–“ç›®æ¨™è¨­å®š</h2>
      <button class="goal-close-btn" onclick="closeGoalModal()">&times;</button>
    </div>
    <div class="goal-modal-body">
      
      <!-- æœˆé¸æŠ -->
      <div class="goal-month-selector">
        <label for="goal-month-select">è¡¨ç¤ºæœˆ:</label>
        <select id="goal-month-select" class="goal-month-dropdown" onchange="onGoalMonthChange()">
          <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
        </select>
      </div>
      
      <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
      <div class="goal-mode-selector" id="goal-mode-selector">
        <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
      </div>
      
      <!-- è¡€åœ§ç›®æ¨™ -->
      <div class="goal-section" id="goal-section-bp">
        <div class="goal-section-header" onclick="toggleGoalSection('bloodPressure')">
          <div class="goal-section-checkbox">
            <div class="checkbox-custom" id="checkbox-bp"></div>
          </div>
          <h3 class="goal-section-title">ğŸ«€ è¡€åœ§ç›®æ¨™</h3>
        </div>
        <div class="goal-section-content" id="content-bp">
        <div class="goal-current-info" id="current-bp-info" style="display: none;">
          <div class="goal-current-title">ğŸ“Š ç¾åœ¨ã®å¹³å‡è¡€åœ§</div>
          <div class="goal-current-value" id="current-bp-value">--/-- mmHg</div>
        </div>
        <div class="goal-input-row">
          <div class="goal-input-group">
            <div class="goal-input-wrapper">
              <label>åç¸®æœŸè¡€åœ§ï¼ˆæœ€é«˜ï¼‰</label>
              <input type="number" id="goal-systolic" min="100" max="139" placeholder="120">
              <div class="goal-error-message" id="error-systolic"></div>
            </div>
            <div class="previous-month-goal" id="prev-systolic">
              <span class="label">å‰æœˆ:</span>
              <span class="value" id="prev-systolic-value">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
          </div>
          <div class="goal-input-group">
            <div class="goal-input-wrapper">
              <label>æ‹¡å¼µæœŸè¡€åœ§ï¼ˆæœ€ä½ï¼‰</label>
              <input type="number" id="goal-diastolic" min="70" max="89" placeholder="80">
              <div class="goal-error-message" id="error-diastolic"></div>
            </div>
            <div class="previous-month-goal" id="prev-diastolic">
              <span class="label">å‰æœˆ:</span>
              <span class="value" id="prev-diastolic-value">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span>å¥åº·ç®¡ç†ã®ãŸã‚ã€100-139 / 70-89 mmHgã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„</span>
        </div>
        </div>
      </div>

      <!-- ä½“é‡ç›®æ¨™ -->
      <div class="goal-section" id="goal-section-weight">
        <div class="goal-section-header" onclick="toggleGoalSection('weight')">
          <div class="goal-section-checkbox">
            <div class="checkbox-custom" id="checkbox-weight"></div>
          </div>
          <h3 class="goal-section-title">âš–ï¸ ä½“é‡ç›®æ¨™</h3>
        </div>
        <div class="goal-section-content" id="content-weight">
        <div class="goal-current-info" id="current-weight-info" style="display: none;">
          <div class="goal-current-title">ğŸ“Š ç¾åœ¨ã®å¹³å‡ä½“é‡</div>
          <div class="goal-current-value" id="current-weight-value">-- kg (BMI: --)</div>
        </div>
        <div class="goal-input-row">
          <div class="goal-input-group">
            <div class="goal-input-wrapper">
              <label>ç›®æ¨™ä½“é‡ï¼ˆkgï¼‰</label>
              <input type="number" id="goal-weight" step="0.1" placeholder="65.0">
              <div class="goal-error-message" id="error-goal-weight"></div>
            </div>
            <div class="previous-month-goal" id="prev-weight">
              <span class="label">å‰æœˆ:</span>
              <span class="value" id="prev-weight-value">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
          </div>
          <div class="goal-input-group">
            <label>ç›®æ¨™BMI</label>
            <input type="text" id="goal-bmi" readonly style="background: #F5F5F5; cursor: default; text-align: center; border: 2px solid #E0E0E0; padding: 12px; border-radius: 8px; font-size: 1em; font-weight: 600;">
            <div class="goal-bmi-status" id="goal-bmi-status" style="margin-top: 8px; text-align: center; font-size: 0.9em; font-weight: 600;"></div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span id="weight-hint">å¥åº·ç®¡ç†ã®ãŸã‚ã€<strong>BMI 18.5-25ï¼ˆæ¨™æº–ä½“é‡ï¼‰</strong>ã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚ä½ä½“é‡ï¼ˆ18.5æœªæº€ï¼‰ãƒ»è‚¥æº€ï¼ˆ30ä»¥ä¸Šï¼‰ã¯è¨­å®šã§ãã¾ã›ã‚“ã€‚</span>
        </div>
        </div>
      </div>

      <!-- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•° -->
      <div class="goal-section" id="goal-section-days">
        <div class="goal-section-header" onclick="toggleGoalSection('trainingDays')">
          <div class="goal-section-checkbox">
            <div class="checkbox-custom" id="checkbox-days"></div>
          </div>
          <h3 class="goal-section-title">ğŸ“… ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°</h3>
        </div>
        <div class="goal-section-content" id="content-days">
        <div class="goal-current-info" id="current-training-info" style="display: none;">
          <div class="goal-current-title">ğŸ“Š ä»Šæœˆã®å®Ÿç¸¾</div>
          <div class="goal-current-value" id="current-training-value">
            -- æ—¥ / -- åˆ† / -- kcal
          </div>
        </div>
        <div class="goal-input-row">
          <div class="goal-input-group">
            <div class="goal-input-wrapper">
              <label>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ï¼ˆæ—¥ï¼‰</label>
              <input type="number" id="goal-days" min="1" max="25" placeholder="12">
              <div class="goal-error-message" id="error-days"></div>
            </div>
            <div class="previous-month-goal" id="prev-days">
              <span class="label">å‰æœˆ:</span>
              <span class="value" id="prev-days-value">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span><strong>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ã¯1-25æ—¥</strong>ã®ç¯„å›²ã§è¨­å®šã§ãã¾ã™ã€‚é€±6æ—¥ãƒšãƒ¼ã‚¹ï¼ˆæœˆ25æ—¥ï¼‰ãŒå¥åº·çš„ãªä¸Šé™ã§ã™ã€‚</span>
        </div>
        </div>
      </div>

      <!-- é‹å‹•æ™‚é–“ -->
      <div class="goal-section" id="goal-section-time">
        <div class="goal-section-header" onclick="toggleGoalSection('totalTime')">
          <div class="goal-section-checkbox">
            <div class="checkbox-custom" id="checkbox-time"></div>
          </div>
          <h3 class="goal-section-title">â±ï¸ é‹å‹•æ™‚é–“</h3>
        </div>
        <div class="goal-section-content" id="content-time">
        <div class="goal-input-row">
          <div class="goal-input-group">
            <div class="goal-input-wrapper">
              <label>é‹å‹•æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
              <input type="number" id="goal-time" min="30" max="3000" placeholder="600">
              <div class="goal-error-message" id="error-time"></div>
            </div>
            <div class="previous-month-goal" id="prev-time">
              <span class="label">å‰æœˆ:</span>
              <span class="value" id="prev-time-value">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span>æœˆé–“ã®ç·é‹å‹•æ™‚é–“ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</span>
        </div>
        </div>
      </div>

      <!-- æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ -->
      <div class="goal-section" id="goal-section-calories">
        <div class="goal-section-header" onclick="toggleGoalSection('totalCalories')">
          <div class="goal-section-checkbox">
            <div class="checkbox-custom" id="checkbox-calories"></div>
          </div>
          <h3 class="goal-section-title">ğŸ”¥ æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</h3>
        </div>
        <div class="goal-section-content" id="content-calories">
        <div class="goal-input-row">
          <div class="goal-input-group">
            <div class="goal-input-wrapper">
              <label>æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ï¼ˆkcalï¼‰</label>
              <input type="number" id="goal-calories" min="100" max="15000" placeholder="3000">
              <div class="goal-error-message" id="error-calories"></div>
            </div>
            <div class="previous-month-goal" id="prev-calories">
              <span class="label">å‰æœˆ:</span>
              <span class="value" id="prev-calories-value">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span>æœˆé–“ã®ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</span>
        </div>
        </div>
      </div>

      <!-- ãƒœã‚¿ãƒ³ -->
      <div class="goal-buttons">
        <button class="btn-goal-save" onclick="saveGoals()">ğŸ’¾ ç›®æ¨™ã‚’ä¿å­˜</button>
        <button class="btn-goal-cancel" onclick="closeGoalModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>
</div>

<!-- å‰æœˆç·¨é›†ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="confirm-modal" id="confirmEditPreviousMonth" style="display: none;">
  <div class="confirm-modal-content">
    <div class="confirm-modal-header">
      <h3>âš ï¸ å‰æœˆã®ç›®æ¨™ã‚’ç·¨é›†ã—ã¾ã™ã‹ï¼Ÿ</h3>
    </div>
    <div class="confirm-modal-body">
      <p>å‰æœˆï¼ˆ<span id="confirm-month-name"></span>ï¼‰ã®ç›®æ¨™ã‚’ç·¨é›†ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚</p>
      <p><strong>ç·¨é›†ã—ãŸå†…å®¹ã¯ä¿å­˜ã•ã‚Œã¾ã™ãŒã€éå»ã®å®Ÿç¸¾ã¨ã®æ•´åˆæ€§ãŒå–ã‚Œãªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</strong></p>
      <p>æœ¬å½“ã«ç·¨é›†ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
    </div>
    <div class="confirm-modal-buttons">
      <button class="btn-confirm-yes" onclick="confirmEditPreviousMonth(true)">âœ… ç·¨é›†ã™ã‚‹</button>
      <button class="btn-confirm-no" onclick="confirmEditPreviousMonth(false)">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </div>
</div>

<script>
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼
const PROFILE_KEY = 'user_profile';

// é¸æŠä¸­ã®å¹´æœˆï¼ˆç›®æ¨™è¨­å®šç”¨ï¼‰
let selectedGoalYear = new Date().getFullYear();
let selectedGoalMonth = new Date().getMonth() + 1; // 1-12

// ãƒ›ãƒ¼ãƒ ç”»é¢ã§é¸æŠä¸­ã®å¹´æœˆï¼ˆè¡¨ç¤ºç”¨ï¼‰
let homeDisplayYear = new Date().getFullYear();
let homeDisplayMonth = new Date().getMonth() + 1; // 1-12

// ç›®æ¨™é …ç›®ã®æœ‰åŠ¹/ç„¡åŠ¹çŠ¶æ…‹
let goalItemsEnabled = {
  bloodPressure: true,
  weight: true,
  trainingDays: true,
  totalTime: true,
  totalCalories: true
};

// ãƒ¢ãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«å®šç¾©ï¼ˆå‰æœˆãƒ‡ãƒ¼ã‚¿ã‚ã‚Šï¼‰
const modeLabelsHistory = {
  maintain: { icon: 'ğŸŸ¢', title: 'ã„ã¤ã‚‚é€šã‚Š', desc: 'å‰æœˆã¨åŒã˜ãƒšãƒ¼ã‚¹ã§ç¶™ç¶š' },
  light: { icon: 'ğŸŸ¡', title: 'å°‘ã—ãŒã‚“ã°ã‚‹', desc: 'ç„¡ç†ãªãå°‘ã—ãšã¤å‘ä¸Š', badge: 'æ¨å¥¨' },
  aggressive: { icon: 'ğŸ”´', title: 'ã—ã£ã‹ã‚ŠãŒã‚“ã°ã‚‹', desc: 'ç©æ¥µçš„ã«æ”¹å–„' },
  custom: { icon: 'âœï¸', title: 'è‡ªåˆ†ã§æ±ºã‚ã‚‹', desc: 'ã™ã¹ã¦æ‰‹å‹•ã§å…¥åŠ›' }
};

// ãƒ¢ãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«å®šç¾©ï¼ˆå‰æœˆãƒ‡ãƒ¼ã‚¿ãªã—ãƒ»åˆå›ï¼‰
const modeLabelsPreset = {
  beginner: { icon: 'ğŸŒ±', title: 'é€±1å›ãƒšãƒ¼ã‚¹', desc: 'ã¾ãšã¯ç¿’æ…£ã¥ãã‚Šã‹ã‚‰' },
  moderate: { icon: 'ğŸ’ª', title: 'é€±2-3å›ãƒšãƒ¼ã‚¹', desc: 'å¥åº·çš„ãªç”Ÿæ´»ç¿’æ…£ã‚’ç›®æŒ‡ã™', badge: 'æ¨å¥¨' },
  active: { icon: 'ğŸƒ', title: 'é€±4å›ä»¥ä¸Šãƒšãƒ¼ã‚¹', desc: 'ç©æ¥µçš„ã«å¥åº·æ”¹å–„' },
  custom: { icon: 'âœï¸', title: 'è‡ªåˆ†ã§æ±ºã‚ã‚‹', desc: 'ã™ã¹ã¦æ‰‹å‹•ã§å…¥åŠ›' }
};

// å‰æœˆãƒ‡ãƒ¼ã‚¿ã®æœ‰ç„¡ã‚’åˆ¤å®š
function hasPreviousMonthData() {
  const today = new Date();
  const currentYear = today.getFullYear();
  const currentMonth = today.getMonth() + 1; // 1-12
  
  // å‰æœˆã‚’è¨ˆç®—
  let lastMonth = currentMonth - 1;
  let lastMonthYear = currentYear;
  
  if (lastMonth === 0) {
    lastMonth = 12;
    lastMonthYear = currentYear - 1;
  }
  
  // å‰æœˆã®ç›®æ¨™ã‚­ãƒ¼ã‚’å–å¾—
  const lastMonthGoalsKey = `monthly_goals_${lastMonthYear}_${lastMonth}`;
  const lastMonthGoals = localStorage.getItem(lastMonthGoalsKey);
  
  return lastMonthGoals !== null;
}

// ãƒ—ãƒªã‚»ãƒƒãƒˆç›®æ¨™ã‚’ç”Ÿæˆï¼ˆåˆå›è¨ªå•æ™‚ç”¨ï¼‰
function getPresetGoals(mode) {
  const profile = loadProfile();
  const userWeight = profile?.weight || 65;
  
  const presets = {
    beginner: {
      mode: 'beginner',
      bloodPressure: { systolic: 120, diastolic: 80 },
      weight: userWeight,
      trainingDays: 4,    // é€±1å› Ã— 4é€±
      totalTime: 80,      // 1å›20åˆ† Ã— 4æ—¥
      totalCalories: 400  // æƒ³å®š100kcal/å›
    },
    moderate: {
      mode: 'moderate',
      bloodPressure: { systolic: 120, diastolic: 80 },
      weight: userWeight,
      trainingDays: 10,   // é€±2.5å› Ã— 4é€±
      totalTime: 300,     // 1å›30åˆ† Ã— 10æ—¥
      totalCalories: 1500 // æƒ³å®š150kcal/å›
    },
    active: {
      mode: 'active',
      bloodPressure: { systolic: 115, diastolic: 75 },
      weight: Math.max(userWeight - 2, 45), // 2kgæ¸›ï¼ˆæœ€ä½45kgï¼‰
      trainingDays: 16,   // é€±4å› Ã— 4é€±
      totalTime: 640,     // 1å›40åˆ† Ã— 16æ—¥
      totalCalories: 3200 // æƒ³å®š200kcal/å›
    }
  };
  
  return presets[mode] || null;
}

// æœˆé–“ç›®æ¨™ã®ã‚­ãƒ¼ï¼ˆæœˆåˆ¥ã«ä¿å­˜ï¼‰
function getGoalsKey(year = null, month = null) {
  const targetYear = year || new Date().getFullYear();
  // monthãŒnullã®å ´åˆã¯ç¾åœ¨ã®æœˆï¼ˆ1-12ï¼‰ã‚’ä½¿ç”¨
  // monthãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨ï¼ˆæ—¢ã«1-12å½¢å¼ã‚’æƒ³å®šï¼‰
  const targetMonth = month !== null ? month : (new Date().getMonth() + 1);
  // ã‚¼ãƒ­ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãªã—ï¼ˆmonthly_goals_2026_1 å½¢å¼ï¼‰
  return `monthly_goals_${targetYear}_${targetMonth}`;
}

// é¸æŠä¸­ã®æœˆã®ç›®æ¨™ã‚­ãƒ¼ã‚’å–å¾—
function getSelectedGoalsKey() {
  return getGoalsKey(selectedGoalYear, selectedGoalMonth);
}

// æœˆåˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²è¨­å®š
const monthThemes = {
  0: { icon: 'â„ï¸', bg: 'linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%)' },
  1: { icon: 'ğŸ’—', bg: 'linear-gradient(135deg, #FCE4EC 0%, #F8BBD0 50%, #F48FB1 100%)' },
  2: { icon: 'ğŸŒ¸', bg: 'linear-gradient(135deg, #F1F8E9 0%, #DCEDC8 50%, #C5E1A5 100%)' },
  3: { icon: 'ğŸŒ·', bg: 'linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 50%, #FFCC80 100%)' },
  4: { icon: 'ğŸŒ¿', bg: 'linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 50%, #A5D6A7 100%)' },
  5: { icon: 'ğŸŒˆ', bg: 'linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 50%, #CE93D8 100%)' },
  6: { icon: 'ğŸŒŠ', bg: 'linear-gradient(135deg, #E1F5FE 0%, #B3E5FC 50%, #81D4FA 100%)' },
  7: { icon: 'ğŸŒ»', bg: 'linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 50%, #EF9A9A 100%)' },
  8: { icon: 'ğŸ‚', bg: 'linear-gradient(135deg, #E0F2F1 0%, #B2DFDB 50%, #80CBC4 100%)' },
  9: { icon: 'ğŸ', bg: 'linear-gradient(135deg, #FFF9C4 0%, #FFECB3 50%, #FFE082 100%)' },
  10: { icon: 'ğŸ„', bg: 'linear-gradient(135deg, #EFEBE9 0%, #D7CCC8 50%, #BCAAA4 100%)' },
  11: { icon: 'â›„', bg: 'linear-gradient(135deg, #ECEFF1 0%, #CFD8DC 50%, #B0BEC5 100%)' }
};

// ç¾åœ¨ã®æœˆã‚’å–å¾—
function getCurrentMonth() {
  return new Date().getMonth();
}

// æœˆåˆ¥ãƒ†ãƒ¼ãƒã®é©ç”¨
function applyMonthTheme() {
  const currentMonth = getCurrentMonth();
  const theme = monthThemes[currentMonth];
  document.body.style.background = theme.bg;
  document.querySelector('.hero-icon').textContent = theme.icon;
}

// æ´»å‹•ãƒ¬ãƒ™ãƒ«ã®è¡¨ç¤ºå
// æ€§åˆ¥ã®è¡¨ç¤ºå
const genderLabels = {
  male: 'ç”·æ€§',
  female: 'å¥³æ€§',
  other: 'ãã®ä»–'
};

// BMIè¨ˆç®—
function calculateBMI(weight, height) {
  if (!height || height === 0) return null;
  const heightM = height / 100;
  return (weight / (heightM * heightM)).toFixed(1);
}

// BMIåˆ¤å®š
function getBMIStatus(bmi) {
  if (!bmi) return { class: '', text: '' };
  if (bmi < 18.5) return { class: 'bmi-low', text: 'ä½ä½“é‡' };
  if (bmi < 25) return { class: 'bmi-normal', text: 'æ¨™æº–' };
  if (bmi < 30) return { class: 'bmi-high', text: 'è‚¥æº€ï¼ˆ1åº¦ï¼‰' };
  return { class: 'bmi-very-high', text: 'è‚¥æº€ï¼ˆ2åº¦ä»¥ä¸Šï¼‰' };
}

// åŸºç¤ä»£è¬è¨ˆç®—
function calculateBMR(gender, weight, height, age) {
  if (!weight || !age) return null;
  if (gender === 'male') {
    if (!height) {
      return Math.round(66.47 + (13.75 * weight) - (6.76 * age));
    }
    return Math.round(66.47 + (13.75 * weight) + (5.00 * height) - (6.76 * age));
  } else if (gender === 'female') {
    if (!height) {
      return Math.round(655.10 + (9.56 * weight) - (4.68 * age));
    }
    return Math.round(655.10 + (9.56 * weight) + (1.85 * height) - (4.68 * age));
  } else {
    if (!height) {
      const male = 66.47 + (13.75 * weight) - (6.76 * age);
      const female = 655.10 + (9.56 * weight) - (4.68 * age);
      return Math.round((male + female) / 2);
    }
    const male = 66.47 + (13.75 * weight) + (5.00 * height) - (6.76 * age);
    const female = 655.10 + (9.56 * weight) + (1.85 * height) - (4.68 * age);
    return Math.round((male + female) / 2);
  }
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
function loadProfile() {
  const profileStr = localStorage.getItem(PROFILE_KEY);
  if (profileStr) {
    return JSON.parse(profileStr);
  }
  return null;
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
function saveProfile(profile) {
  profile.updatedAt = new Date().toISOString();
  if (!profile.createdAt) {
    profile.createdAt = profile.updatedAt;
  }
  localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã®æ›´æ–°
function updateProfileDisplay(profile) {
  const genderText = genderLabels[profile.gender] || 'æœªè¨­å®š';
  const ageText = profile.age ? `${profile.age}æ­³` : 'æœªè¨­å®š';
  
  document.getElementById('profile-name').textContent = 
    `${ageText}ãƒ»${genderText}`;
  document.getElementById('display-height').textContent = 
    profile.height ? `${profile.height} cm` : 'æœªè¨­å®š';
  document.getElementById('display-weight').textContent = 
    profile.weight ? `${profile.weight} kg` : 'æœªè¨­å®š';
  document.getElementById('display-gender').textContent = genderText;
  
  const bmi = calculateBMI(profile.weight, profile.height);
  const bmiDisplay = document.getElementById('display-bmi');
  if (bmi) {
    const status = getBMIStatus(parseFloat(bmi));
    bmiDisplay.innerHTML = `<span class="${status.class}">${bmi}</span> <span style="font-size: 0.8em;">(${status.text})</span>`;
  } else {
    bmiDisplay.innerHTML = '<span style="color: #9E9E9E;">èº«é•·ãƒ»ä½“é‡ã‚’å…¥åŠ›ã™ã‚‹ã¨<br>è¨ˆç®—ã•ã‚Œã¾ã™</span>';
  }
  
  const bmr = calculateBMR(profile.gender, profile.weight, profile.height, profile.age);
  const bmrDisplay = document.getElementById('display-bmr');
  if (bmr) {
    bmrDisplay.textContent = `ç´„${bmr.toLocaleString()} kcal/æ—¥`;
  } else {
    bmrDisplay.textContent = 'æœªè¨­å®š';
  }
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateProfile(profile) {
  const errors = [];
  if (!profile.gender) {
    errors.push({ field: 'gender', message: 'æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„' });
  }
  if (!profile.age || profile.age < 10 || profile.age > 120) {
    errors.push({ field: 'age', message: '10æ­³ã‹ã‚‰120æ­³ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  if (!profile.weight || profile.weight < 30 || profile.weight > 200) {
    errors.push({ field: 'weight', message: '30kgã‹ã‚‰200kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  if (profile.height && (profile.height < 100 || profile.height > 250)) {
    errors.push({ field: 'height', message: '100cmã‹ã‚‰250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  return errors;
}

// ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
function showErrors(errors) {
  document.querySelectorAll('.error-message').forEach(el => {
    el.classList.remove('show');
  });
  document.querySelectorAll('.form-input').forEach(el => {
    el.classList.remove('error');
  });
  errors.forEach(error => {
    const errorEl = document.getElementById(`error-${error.field}`);
    const inputEl = document.getElementById(error.field);
    if (errorEl) {
      errorEl.classList.add('show');
      errorEl.textContent = error.message;
    }
    if (inputEl) {
      inputEl.classList.add('error');
    }
  });
}

// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
document.getElementById('profile-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const profile = {
    gender: document.querySelector('input[name="gender"]:checked')?.value,
    age: parseInt(document.getElementById('age').value) || null,
    height: parseInt(document.getElementById('height').value) || null,
    weight: parseFloat(document.getElementById('weight').value) || null
  };
  const errors = validateProfile(profile);
  if (errors.length > 0) {
    showErrors(errors);
    return;
  }
  saveProfile(profile);
  window.location.href = 'calendar.html';
});

// ç·¨é›†ãƒœã‚¿ãƒ³
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã«å¤‰æ›´ï¼‰
function editProfile() {
  const profile = loadProfile();
  
  // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ç¾åœ¨ã®å€¤ã‚’è¨­å®š
  if (profile) {
    if (profile.gender) {
      document.getElementById(`edit-gender-${profile.gender}`).checked = true;
    }
    if (profile.age) {
      document.getElementById('edit-age').value = profile.age;
    }
    if (profile.height) {
      document.getElementById('edit-height').value = profile.height;
    }
    if (profile.weight) {
      document.getElementById('edit-weight').value = profile.weight;
    }
  }
  
  // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
  document.querySelectorAll('.profile-edit-modal .error-message').forEach(el => {
    el.classList.remove('show');
  });
  document.querySelectorAll('.profile-edit-modal .form-input').forEach(el => {
    el.classList.remove('error');
  });
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  document.getElementById('profileEditModal').classList.add('show');
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeProfileEditModal() {
  document.getElementById('profileEditModal').classList.remove('show');
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†
document.addEventListener('DOMContentLoaded', function() {
  const editForm = document.getElementById('profile-edit-form');
  if (editForm) {
    editForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const profile = {
        gender: document.querySelector('input[name="editGender"]:checked')?.value,
        age: parseInt(document.getElementById('edit-age').value) || null,
        height: parseInt(document.getElementById('edit-height').value) || null,
        weight: parseFloat(document.getElementById('edit-weight').value) || null
      };
      
      const errors = validateProfileEdit(profile);
      if (errors.length > 0) {
        showEditErrors(errors);
        return;
      }
      
      saveProfile(profile);
      updateProfileDisplay(profile);
      closeProfileEditModal();
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
      closeProfilePrompt();
      document.getElementById('profile-floating-btn').classList.remove('show');
      
      // é”æˆåº¦ã‚µãƒãƒªãƒ¼ã‚‚æ›´æ–°ï¼ˆä½“é‡ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰
      updateAchievementSummary();
    });
  }
});

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateProfileEdit(profile) {
  const errors = [];
  if (!profile.gender) {
    errors.push({ field: 'edit-gender', message: 'æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„' });
  }
  if (!profile.age || profile.age < 10 || profile.age > 120) {
    errors.push({ field: 'edit-age', message: '10æ­³ã‹ã‚‰120æ­³ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  if (!profile.weight || profile.weight < 30 || profile.weight > 200) {
    errors.push({ field: 'edit-weight', message: '30kgã‹ã‚‰200kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  if (profile.height && (profile.height < 100 || profile.height > 250)) {
    errors.push({ field: 'edit-height', message: '100cmã‹ã‚‰250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  return errors;
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
function showEditErrors(errors) {
  document.querySelectorAll('.profile-edit-modal .error-message').forEach(el => {
    el.classList.remove('show');
  });
  document.querySelectorAll('.profile-edit-modal .form-input').forEach(el => {
    el.classList.remove('error');
  });
  errors.forEach(error => {
    const errorEl = document.getElementById(`error-${error.field}`);
    const inputEl = document.getElementById(error.field);
    if (errorEl) {
      errorEl.classList.add('show');
      errorEl.textContent = error.message;
    }
    if (inputEl) {
      inputEl.classList.add('error');
    }
  });
}

// æœˆé–“ç›®æ¨™ã®èª­ã¿è¾¼ã¿
function loadGoals() {
  const goalsStr = localStorage.getItem(getGoalsKey());
  if (goalsStr) {
    return JSON.parse(goalsStr);
  }
  return null;
}

// æœˆé–“ç›®æ¨™ã®ä¿å­˜
function saveGoalsData(goals) {
  goals.updatedAt = new Date().toISOString();
  if (!goals.createdAt) {
    goals.createdAt = goals.updatedAt;
  }
  
  // é¸æŠä¸­ã®å¹´æœˆæƒ…å ±ã‚’ä¿å­˜
  goals.year = selectedGoalYear;
  goals.month = selectedGoalMonth;
  
  // é¸æŠä¸­ã®æœˆã®ã‚­ãƒ¼ã§ä¿å­˜
  localStorage.setItem(getSelectedGoalsKey(), JSON.stringify(goals));
}

// ç›®æ¨™è¡¨ç¤ºã®æ›´æ–°
// ãƒ›ãƒ¼ãƒ ç”»é¢ã®æœˆé¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
function initializeHomeMonthSelector() {
  const selector = document.getElementById('home-month-select');
  if (!selector) return;
  
  selector.innerHTML = '';
  
  const now = new Date();
  const currentYear = now.getFullYear();
  const currentMonth = now.getMonth() + 1;
  
  // æœªæ¥2ãƒ¶æœˆ + ç¾åœ¨æœˆ + éå»12ãƒ¶æœˆ = åˆè¨ˆ15ãƒ¶æœˆåˆ†
  for (let i = 2; i >= -12; i--) {
    let year = currentYear;
    let month = currentMonth + i;
    
    // æœˆã®æ­£è¦åŒ–
    while (month > 12) {
      month -= 12;
      year += 1;
    }
    while (month < 1) {
      month += 12;
      year -= 1;
    }
    
    const option = document.createElement('option');
    option.value = `${year}-${month}`;
    option.textContent = `${year}å¹´${month}æœˆ`;
    
    // ç¾åœ¨é¸æŠä¸­ã®æœˆã‚’é¸æŠçŠ¶æ…‹ã«
    if (year === homeDisplayYear && month === homeDisplayMonth) {
      option.selected = true;
    }
    
    selector.appendChild(option);
  }
}

// ãƒ›ãƒ¼ãƒ ç”»é¢ã§æœˆå¤‰æ›´æ™‚
function onHomeMonthChange() {
  const selector = document.getElementById('home-month-select');
  const selected = selector.value.split('-');
  homeDisplayYear = parseInt(selected[0]);
  homeDisplayMonth = parseInt(selected[1]);
  
  // è¡¨ç¤ºã‚’æ›´æ–°
  updateGoalDisplay();
}

function updateGoalDisplay() {
  // ç¾åœ¨æœˆã‚’è¡¨ç¤ºï¼ˆNEWï¼‰
  const now = new Date();
  const currentMonth = now.getMonth() + 1;
  document.getElementById('goal-display-month').textContent = `${currentMonth}æœˆ`;
  
  // ç¾åœ¨æœˆã®ç›®æ¨™ã‚’å–å¾—ï¼ˆæœˆé¸æŠæ©Ÿèƒ½ã¯å»ƒæ­¢ï¼‰
  const currentYear = now.getFullYear();
  const goalsKey = getGoalsKey(currentYear, now.getMonth());
  const goalsStr = localStorage.getItem(goalsKey);
  const goals = goalsStr ? JSON.parse(goalsStr) : null;
  
  // ä»Šæœˆã®ç›®æ¨™ã‚’è¡¨ç¤º
  if (goals) {
    if (goals.bloodPressure) {
      document.getElementById('display-goal-bp').textContent = 
        `${goals.bloodPressure.systolic}/${goals.bloodPressure.diastolic} mmHg`;
    } else {
      document.getElementById('display-goal-bp').textContent = 'æœªè¨­å®š';
    }
    if (goals.weight) {
      document.getElementById('display-goal-weight').textContent = `${goals.weight} kg`;
    } else {
      document.getElementById('display-goal-weight').textContent = 'æœªè¨­å®š';
    }
    if (goals.trainingDays) {
      document.getElementById('display-goal-days').textContent = `${goals.trainingDays} æ—¥`;
    } else {
      document.getElementById('display-goal-days').textContent = 'æœªè¨­å®š';
    }
    if (goals.totalTime) {
      document.getElementById('display-goal-time').textContent = `${goals.totalTime} åˆ†`;
    } else {
      document.getElementById('display-goal-time').textContent = 'æœªè¨­å®š';
    }
    if (goals.totalCalories) {
      document.getElementById('display-goal-calories').textContent = 
        `${goals.totalCalories.toLocaleString()} kcal`;
    } else {
      document.getElementById('display-goal-calories').textContent = 'æœªè¨­å®š';
    }
  } else {
    // ç›®æ¨™ãŒæœªè¨­å®šã®æœˆã®å ´åˆã€ã™ã¹ã¦ã€Œæœªè¨­å®šã€ã¨è¡¨ç¤º
    document.getElementById('display-goal-bp').textContent = 'æœªè¨­å®š';
    document.getElementById('display-goal-weight').textContent = 'æœªè¨­å®š';
    document.getElementById('display-goal-days').textContent = 'æœªè¨­å®š';
    document.getElementById('display-goal-time').textContent = 'æœªè¨­å®š';
    document.getElementById('display-goal-calories').textContent = 'æœªè¨­å®š';
  }
}

// ç›®æ¨™ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
function openGoalModal() {
  // é¸æŠä¸­ã®å¹´æœˆã‚’ç¾åœ¨ã«ãƒªã‚»ãƒƒãƒˆ
  const now = new Date();
  selectedGoalYear = now.getFullYear();
  selectedGoalMonth = now.getMonth() + 1;
  
  // æœˆé¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–
  initializeGoalMonthSelector();
  
  // ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’å‹•çš„ç”Ÿæˆ
  renderGoalModeButtons();
  
  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’åˆæœŸåŒ–
  initializeGoalCheckboxes();
  
  document.getElementById('goalModal').classList.add('active');
  loadGoalsToModal();
}

// ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’å‹•çš„ã«ç”Ÿæˆï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³é¢¨ï¼‰
function renderGoalModeButtons() {
  const hasHistory = hasPreviousMonthData();
  const container = document.getElementById('goal-mode-selector');
  
  if (!container) return;
  
  container.innerHTML = ''; // ã‚¯ãƒªã‚¢
  
  const labels = hasHistory ? modeLabelsHistory : modeLabelsPreset;
  const modes = hasHistory ? ['maintain', 'light', 'aggressive', 'custom'] : ['beginner', 'moderate', 'active', 'custom'];
  
  // èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
  if (!hasHistory) {
    const introText = document.createElement('div');
    introText.style.cssText = 'text-align: center; margin-bottom: 20px; color: #333; font-size: 1.1em; font-weight: 500;';
    introText.innerHTML = 'ğŸ‘‹ ã¯ã˜ã‚ã¾ã—ã¦ï¼';
    container.appendChild(introText);
  } else {
    const introText = document.createElement('div');
    introText.style.cssText = 'text-align: center; margin-bottom: 15px; color: #666; font-size: 0.95em;';
    introText.textContent = 'å‰æœˆã®å®Ÿç¸¾ã‚’ãƒ™ãƒ¼ã‚¹ã«ç›®æ¨™ã‚’è¨­å®š';
    container.appendChild(introText);
  }
  
  // ãƒ—ãƒªã‚»ãƒƒãƒˆç›®æ¨™ã®è©³ç´°æƒ…å ±
  const presetDetails = {
    beginner: {
      desc: 'ã¾ãšã¯ç¿’æ…£ã¥ãã‚Šã‹ã‚‰',
      details: [
        'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°: æœˆ4æ—¥',
        'é‹å‹•æ™‚é–“: 80åˆ†',
        'æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼: 400kcal',
        'è¡€åœ§: 120/80 mmHg'
      ]
    },
    moderate: {
      desc: 'å¥åº·çš„ãªç”Ÿæ´»ç¿’æ…£ã‚’ç›®æŒ‡ã™',
      details: [
        'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°: æœˆ10æ—¥',
        'é‹å‹•æ™‚é–“: 300åˆ†',
        'æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼: 1500kcal',
        'è¡€åœ§: 120/80 mmHg'
      ]
    },
    active: {
      desc: 'ç©æ¥µçš„ã«å¥åº·æ”¹å–„',
      details: [
        'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°: æœˆ16æ—¥',
        'é‹å‹•æ™‚é–“: 640åˆ†',
        'æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼: 3200kcal',
        'è¡€åœ§: 115/75 mmHg',
        'ä½“é‡: ç¾åœ¨-2kg'
      ]
    },
    custom: {
      desc: 'ã™ã¹ã¦æ‰‹å‹•ã§å…¥åŠ›',
      details: [
        'è‡ªç”±ã«ç›®æ¨™ã‚’è¨­å®šã§ãã¾ã™'
      ]
    }
  };
  
  // ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ
  modes.forEach((mode, index) => {
    const label = labels[mode];
    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'goal-mode-btn';
    button.setAttribute('data-mode', mode);
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ¨å¥¨ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
    if (label.badge === 'æ¨å¥¨') {
      button.classList.add('active');
      currentGoalMode = mode;
    }
    
    // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼
    const header = document.createElement('div');
    header.className = 'goal-mode-header';
    header.innerHTML = `
      <span class="goal-mode-icon">${label.icon}</span>
      <span class="goal-mode-title">${label.title}</span>
      ${label.badge ? `<span class="goal-mode-badge">${label.badge}</span>` : ''}
      <span class="goal-mode-arrow">â–¶</span>
    `;
    
    // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    const content = document.createElement('div');
    content.className = 'goal-mode-content';
    
    // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
    if (!hasHistory && presetDetails[mode]) {
      const detail = presetDetails[mode];
      content.innerHTML = `
        <div class="goal-mode-content-desc">${detail.desc}</div>
        <div class="goal-mode-content-details">
          <div class="goal-mode-detail-title">ğŸ“Š ç›®æ¨™</div>
          ${detail.details.map(item => `<div class="goal-mode-detail-item">â€¢ ${item}</div>`).join('')}
        </div>
      `;
    } else if (hasHistory && mode !== 'custom') {
      // å‰æœˆãƒ™ãƒ¼ã‚¹ã®å ´åˆã¯èª¬æ˜æ–‡ã‚’è¡¨ç¤º
      content.innerHTML = `
        <div class="goal-mode-content-desc">${label.desc}</div>
        <div class="goal-mode-change" id="change-${mode}" style="display: none;"></div>
      `;
    } else {
      // ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰
      content.innerHTML = `
        <div class="goal-mode-content-desc">${label.desc}</div>
      `;
    }
    
    button.appendChild(header);
    button.appendChild(content);
    
    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    button.onclick = () => selectGoalMode(mode);
    
    container.appendChild(button);
  });
}

// æœˆé¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–ï¼ˆéå»12ãƒ¶æœˆ+æœªæ¥2ãƒ¶æœˆï¼‰
function initializeGoalMonthSelector() {
  const selector = document.getElementById('goal-month-select');
  selector.innerHTML = '';
  
  const now = new Date();
  const currentYear = now.getFullYear();
  const currentMonth = now.getMonth() + 1; // 1-12
  
  // æœªæ¥2ãƒ¶æœˆ + ç¾åœ¨æœˆ + éå»12ãƒ¶æœˆ = åˆè¨ˆ15ãƒ¶æœˆåˆ†
  for (let i = 2; i >= -12; i--) {
    let year = currentYear;
    let month = currentMonth + i;
    
    // æœˆã®æ­£è¦åŒ–
    while (month > 12) {
      month -= 12;
      year += 1;
    }
    while (month < 1) {
      month += 12;
      year -= 1;
    }
    
    const option = document.createElement('option');
    option.value = `${year}-${month}`;
    
    // ãƒ©ãƒ™ãƒ«ã‚’ä»˜ã‘ã‚‹
    if (i === 2) {
      option.textContent = `${year}å¹´${month}æœˆï¼ˆå†æ¥æœˆï¼‰`;
    } else if (i === 1) {
      option.textContent = `${year}å¹´${month}æœˆï¼ˆæ¥æœˆï¼‰`;
    } else if (i === 0) {
      option.textContent = `${year}å¹´${month}æœˆï¼ˆä»Šæœˆï¼‰`;
      option.selected = true;
    } else if (i === -1) {
      option.textContent = `${year}å¹´${month}æœˆï¼ˆå…ˆæœˆï¼‰`;
    } else {
      option.textContent = `${year}å¹´${month}æœˆ`;
    }
    
    selector.appendChild(option);
  }
}

// æœˆå¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
function onGoalMonthChange() {
  const selector = document.getElementById('goal-month-select');
  const selected = selector.value.split('-');
  const newYear = parseInt(selected[0]);
  const newMonth = parseInt(selected[1]);
  
  // éå»æœˆã‚’é¸æŠã—ãŸå ´åˆã¯ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  const now = new Date();
  const currentYear = now.getFullYear();
  const currentMonth = now.getMonth() + 1;
  
  // é¸æŠã—ãŸå¹´æœˆãŒéå»ã‹ã©ã†ã‹åˆ¤å®š
  const isPastMonth = (newYear < currentYear) || (newYear === currentYear && newMonth < currentMonth);
  
  if (isPastMonth) {
    // éå»æœˆã‚’é¸æŠ
    showConfirmEditPreviousMonth(newYear, newMonth);
  } else {
    // ä»Šæœˆã¾ãŸã¯æœªæ¥æœˆã‚’é¸æŠï¼ˆé€šå¸¸ãƒ•ãƒ­ãƒ¼ï¼‰
    selectedGoalYear = newYear;
    selectedGoalMonth = newMonth;
    loadGoalsToModal();
  }
}

// å‰æœˆç·¨é›†ã®ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
function showConfirmEditPreviousMonth(year, month) {
  const monthName = `${year}å¹´${month}æœˆ`;
  document.getElementById('confirm-month-name').textContent = monthName;
  document.getElementById('confirmEditPreviousMonth').style.display = 'flex';
  
  // ä¸€æ™‚çš„ã«é¸æŠã‚’ä¿æŒ
  window.tempSelectedYear = year;
  window.tempSelectedMonth = month;
}

// å‰æœˆç·¨é›†ã®ç¢ºèªçµæœ
function confirmEditPreviousMonth(confirmed) {
  document.getElementById('confirmEditPreviousMonth').style.display = 'none';
  
  if (confirmed) {
    // ç·¨é›†ã‚’è¨±å¯
    selectedGoalYear = window.tempSelectedYear;
    selectedGoalMonth = window.tempSelectedMonth;
    loadGoalsToModal();
  } else {
    // ã‚­ãƒ£ãƒ³ã‚»ãƒ« â†’ ä»Šæœˆã«æˆ»ã™
    const now = new Date();
    selectedGoalYear = now.getFullYear();
    selectedGoalMonth = now.getMonth() + 1;
    
    const selector = document.getElementById('goal-month-select');
    selector.value = `${selectedGoalYear}-${selectedGoalMonth}`;
  }
  
  // ä¸€æ™‚å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢
  delete window.tempSelectedYear;
  delete window.tempSelectedMonth;
}

// ========== ç›®æ¨™é …ç›®é¸æŠæ©Ÿèƒ½ ==========

// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®åˆæœŸåŒ–
function initializeGoalCheckboxes() {
  // ã™ã¹ã¦ã®é …ç›®ã‚’æœ‰åŠ¹ã«ã—ã¦è¡¨ç¤º
  const items = ['bloodPressure', 'weight', 'trainingDays', 'totalTime', 'totalCalories'];
  items.forEach(item => {
    goalItemsEnabled[item] = true;
    updateGoalSectionUI(item);
  });
}

// ç›®æ¨™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒˆã‚°ãƒ«
function toggleGoalSection(itemKey) {
  goalItemsEnabled[itemKey] = !goalItemsEnabled[itemKey];
  updateGoalSectionUI(itemKey);
}

// UIã®æ›´æ–°
function updateGoalSectionUI(itemKey) {
  const keyToId = {
    bloodPressure: 'bp',
    weight: 'weight',
    trainingDays: 'days',
    totalTime: 'time',
    totalCalories: 'calories'
  };
  
  const id = keyToId[itemKey];
  const section = document.getElementById(`goal-section-${id}`);
  const checkbox = document.getElementById(`checkbox-${id}`);
  const content = document.getElementById(`content-${id}`);
  
  if (goalItemsEnabled[itemKey]) {
    section.classList.remove('disabled');
    checkbox.classList.add('checked');
    if (content) content.style.display = 'block';
  } else {
    section.classList.add('disabled');
    checkbox.classList.remove('checked');
    if (content) content.style.display = 'none';
  }
}

// ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®UIã‚’æ›´æ–°
function updateAllGoalSectionsUI() {
  const items = ['bloodPressure', 'weight', 'trainingDays', 'totalTime', 'totalCalories'];
  items.forEach(item => {
    updateGoalSectionUI(item);
  });
}


// ç›®æ¨™ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeGoalModal() {
  document.getElementById('goalModal').classList.remove('active');
}

// ç›®æ¨™ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ
let currentGoalMode = 'light';
let previousGoalData = null; // å‰å›ã®ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ

function selectGoalMode(mode) {
  const clickedButton = document.querySelector(`[data-mode="${mode}"]`);
  const wasActive = clickedButton.classList.contains('active');
  
  // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
  document.querySelectorAll('.goal-mode-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼ˆæ—¢ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã ã£ãŸå ´åˆã¯é–‰ã˜ã‚‹ï¼‰
  if (!wasActive) {
    clickedButton.classList.add('active');
    currentGoalMode = mode;
    
    if (mode === 'custom') {
      // ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰ã§ã¯å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ‰åŠ¹åŒ–
      enableCustomInput();
    } else {
      // è‡ªå‹•è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ã§ã¯å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç„¡åŠ¹åŒ–
      disableCustomInput();
      calculateGoalsFromMode(mode);
    }
  } else {
    // é–‰ã˜ãŸå ´åˆã¯currentGoalModeã‚’ã‚¯ãƒªã‚¢
    currentGoalMode = null;
  }
}

// ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚’æœ‰åŠ¹åŒ–
function enableCustomInput() {
  const inputs = [
    'goal-systolic', 'goal-diastolic', 'goal-weight',
    'goal-days', 'goal-time', 'goal-calories'
  ];
  inputs.forEach(id => {
    const input = document.getElementById(id);
    input.removeAttribute('readonly');
    input.style.background = 'white';
    input.style.cursor = 'text';
  });
}

// ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚’ç„¡åŠ¹åŒ–
function disableCustomInput() {
  const inputs = [
    'goal-systolic', 'goal-diastolic', 'goal-weight',
    'goal-days', 'goal-time', 'goal-calories'
  ];
  inputs.forEach(id => {
    const input = document.getElementById(id);
    input.setAttribute('readonly', 'readonly');
    input.style.background = '#F5F5F5';
    input.style.cursor = 'default';
  });
}

// ãƒ¢ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ç›®æ¨™ã‚’è¨ˆç®—
function calculateGoalsFromMode(mode) {
  const profile = loadProfile();
  if (!profile) return;
  
  // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
  if (['beginner', 'moderate', 'active'].includes(mode)) {
    const preset = getPresetGoals(mode);
    if (preset) {
      document.getElementById('goal-systolic').value = preset.bloodPressure.systolic;
      document.getElementById('goal-diastolic').value = preset.bloodPressure.diastolic;
      document.getElementById('goal-weight').value = preset.weight;
      document.getElementById('goal-days').value = preset.trainingDays;
      document.getElementById('goal-time').value = preset.totalTime;
      document.getElementById('goal-calories').value = preset.totalCalories;
      
      // BMIã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
      updateGoalBMI();
      
      // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã¯å¤‰åŒ–é‡è¡¨ç¤ºãªã—
      displayChanges(mode, {});
      return;
    }
  }
  
  // ä»¥ä¸‹ã€æ—¢å­˜ã®å‡¦ç†ï¼ˆå‰æœˆãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—ï¼‰
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆé¸æŠä¸­ã®æœˆã®ç›®æ¨™ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  const goalsStr = localStorage.getItem(getSelectedGoalsKey());
  const currentGoals = goalsStr ? JSON.parse(goalsStr) : null;
  
  let baseSystolic = currentGoals?.bloodPressure?.systolic || 120;
  let baseDiastolic = currentGoals?.bloodPressure?.diastolic || 80;
  let baseWeight = currentGoals?.weight || (profile.height ? (22 * Math.pow(profile.height / 100, 2)).toFixed(1) : 65);
  let baseDays = currentGoals?.trainingDays || 12;
  let baseTime = currentGoals?.totalTime || 600;
  let baseCalories = currentGoals?.totalCalories || 3000;
  
  // å‰å›ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆå¤‰åŒ–é‡è¨ˆç®—ç”¨ï¼‰
  previousGoalData = {
    systolic: baseSystolic,
    diastolic: baseDiastolic,
    weight: parseFloat(baseWeight),
    days: baseDays,
    time: baseTime,
    calories: baseCalories
  };
  
  let newSystolic, newDiastolic, newWeight, newDays, newTime, newCalories;
  let changes = {}; // å¤‰åŒ–é‡ã‚’è¨˜éŒ²
  
  switch(mode) {
    case 'maintain':
      // ç¾çŠ¶ç¶­æŒ: ãã®ã¾ã¾
      newSystolic = baseSystolic;
      newDiastolic = baseDiastolic;
      newWeight = baseWeight;
      newDays = baseDays;
      newTime = baseTime;
      newCalories = baseCalories;
      changes = {
        systolic: 0,
        diastolic: 0,
        weight: 0,
        days: 0,
        time: 0,
        calories: 0
      };
      break;
      
    case 'light':
      // è»½ã„æ”¹å–„
      newSystolic = Math.max(Math.round(baseSystolic - 2.5), 110);
      newDiastolic = Math.max(Math.round(baseDiastolic - 1.5), 70);
      newWeight = (parseFloat(baseWeight) * 0.99).toFixed(1);
      newDays = Math.min(baseDays + 1, 25);
      newTime = Math.ceil(baseTime * 1.075);
      newCalories = Math.ceil(baseCalories * 1.075);
      
      changes = {
        systolic: newSystolic - baseSystolic,
        diastolic: newDiastolic - baseDiastolic,
        weight: (parseFloat(newWeight) - parseFloat(baseWeight)).toFixed(1),
        days: newDays - baseDays,
        time: newTime - baseTime,
        calories: newCalories - baseCalories
      };
      break;
      
    case 'aggressive':
      // ç©æ¥µçš„æ”¹å–„
      newSystolic = Math.max(Math.round(baseSystolic - 5), 110);
      newDiastolic = Math.max(Math.round(baseDiastolic - 3), 70);
      newWeight = (parseFloat(baseWeight) * 0.98).toFixed(1);
      newDays = Math.min(baseDays + 3, 25);
      newTime = Math.ceil(baseTime * 1.175);
      newCalories = Math.ceil(baseCalories * 1.175);
      
      changes = {
        systolic: newSystolic - baseSystolic,
        diastolic: newDiastolic - baseDiastolic,
        weight: (parseFloat(newWeight) - parseFloat(baseWeight)).toFixed(1),
        days: newDays - baseDays,
        time: newTime - baseTime,
        calories: newCalories - baseCalories
      };
      break;
  }
  
  // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
  document.getElementById('goal-systolic').value = newSystolic;
  document.getElementById('goal-diastolic').value = newDiastolic;
  document.getElementById('goal-weight').value = newWeight;
  document.getElementById('goal-days').value = newDays;
  document.getElementById('goal-time').value = newTime;
  document.getElementById('goal-calories').value = newCalories;
  
  // BMIã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
  updateGoalBMI();
  
  // å¤‰åŒ–é‡ã‚’è¡¨ç¤º
  displayChanges(mode, changes);
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ç›®æ¨™ã‚’èª­ã¿è¾¼ã¿
// BMIã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
function updateGoalBMI() {
  const weight = parseFloat(document.getElementById('goal-weight').value);
  const profile = loadProfile();
  
  if (!weight || !profile || !profile.height) {
    document.getElementById('goal-bmi').value = 'èº«é•·ãŒæœªè¨­å®š';
    document.getElementById('goal-bmi-status').textContent = '';
    return;
  }
  
  const bmi = calculateBMI(weight, profile.height);
  document.getElementById('goal-bmi').value = bmi;
  
  // BMIã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ç¤º
  const statusEl = document.getElementById('goal-bmi-status');
  if (bmi < 18.5) {
    statusEl.textContent = 'âš ï¸ ä½ä½“é‡';
    statusEl.style.color = '#1976D2';
  } else if (bmi < 25) {
    statusEl.textContent = 'âœ… æ¨™æº–ä½“é‡';
    statusEl.style.color = '#388E3C';
  } else if (bmi < 30) {
    statusEl.textContent = 'âš ï¸ è‚¥æº€ï¼ˆ1åº¦ï¼‰';
    statusEl.style.color = '#F57C00';
  } else {
    statusEl.textContent = 'âš ï¸ è‚¥æº€ï¼ˆ2åº¦ä»¥ä¸Šï¼‰';
    statusEl.style.color = '#D32F2F';
  }
}

// ä½“é‡å…¥åŠ›æ™‚ã«BMIã‚’æ›´æ–°
document.addEventListener('DOMContentLoaded', function() {
  const weightInput = document.getElementById('goal-weight');
  if (weightInput) {
    weightInput.addEventListener('input', updateGoalBMI);
  }
});

// å¤‰åŒ–é‡ã‚’è¡¨ç¤º
function displayChanges(mode, changes) {
  const changeElement = document.getElementById(`change-${mode}`);
  if (!changeElement) return;
  
  // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã€maintainã€customã¯å¤‰åŒ–é‡è¡¨ç¤ºãªã—
  if (mode === 'maintain' || mode === 'custom' || mode === 'beginner' || mode === 'moderate' || mode === 'active') {
    changeElement.style.display = 'none';
    return;
  }
  
  changeElement.style.display = 'block';
  
  const formatChange = (value, unit) => {
    if (value === 0) return 'Â±0';
    const sign = value > 0 ? '+' : '';
    return `${sign}${value}${unit}`;
  };
  
  let html = '<div style="font-size: 0.75em; line-height: 1.8;">';
  
  // è¡€åœ§ã®å¤‰åŒ–
  if (changes.systolic !== 0 || changes.diastolic !== 0) {
    html += `<div class="change-item">è¡€åœ§: ${formatChange(changes.systolic, '')}/${formatChange(changes.diastolic, '')} mmHg</div>`;
  }
  
  // ä½“é‡ã®å¤‰åŒ–
  if (parseFloat(changes.weight) !== 0) {
    html += `<div class="change-item">ä½“é‡: ${formatChange(parseFloat(changes.weight), ' kg')}</div>`;
  }
  
  // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ã®å¤‰åŒ–
  if (changes.days !== 0) {
    html += `<div class="change-item">æ—¥æ•°: ${formatChange(changes.days, 'æ—¥')}</div>`;
  }
  
  // é‹å‹•æ™‚é–“ã®å¤‰åŒ–
  if (changes.time !== 0) {
    html += `<div class="change-item">æ™‚é–“: ${formatChange(changes.time, 'åˆ†')}</div>`;
  }
  
  // æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ã®å¤‰åŒ–
  if (changes.calories !== 0) {
    html += `<div class="change-item">ã‚«ãƒ­ãƒªãƒ¼: ${formatChange(changes.calories, ' kcal')}</div>`;
  }
  
  html += '</div>';
  changeElement.innerHTML = html;
}

function loadGoalsToModal() {
  // é¸æŠä¸­ã®æœˆã®ç›®æ¨™ã‚’èª­ã¿è¾¼ã¿
  const goalsStr = localStorage.getItem(getSelectedGoalsKey());
  const goals = goalsStr ? JSON.parse(goalsStr) : null;
  
  // å‰æœˆã®ç›®æ¨™ã‚’èª­ã¿è¾¼ã¿
  loadPreviousMonthGoals();
  
  if (goals) {
    // æœ‰åŠ¹ãªé …ç›®ã®æƒ…å ±ã‚’å¾©å…ƒ
    if (goals.enabledItems) {
      goalItemsEnabled = { ...goals.enabledItems };
    } else {
      // å¤ã„ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯ã™ã¹ã¦æœ‰åŠ¹
      goalItemsEnabled = {
        bloodPressure: true,
        weight: true,
        trainingDays: true,
        totalTime: true,
        totalCalories: true
      };
    }
    
    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®UIã‚’æ›´æ–°
    updateAllGoalSectionsUI();
    
    if (goals.bloodPressure) {
      document.getElementById('goal-systolic').value = goals.bloodPressure.systolic;
      document.getElementById('goal-diastolic').value = goals.bloodPressure.diastolic;
    }
    if (goals.weight) {
      document.getElementById('goal-weight').value = goals.weight;
    }
    if (goals.trainingDays) {
      document.getElementById('goal-days').value = goals.trainingDays;
    }
    if (goals.totalTime) {
      document.getElementById('goal-time').value = goals.totalTime;
    }
    if (goals.totalCalories) {
      document.getElementById('goal-calories').value = goals.totalCalories;
    }
    
    // ä¿å­˜ã•ã‚ŒãŸãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Œã°é¸æŠ
    if (goals.mode) {
      selectGoalMode(goals.mode);
    } else {
      selectGoalMode('light');
    }
    
    // BMIã‚’æ›´æ–°
    updateGoalBMI();
  } else {
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
    selectGoalMode('light');
  }
}

// å‰æœˆã®ç›®æ¨™ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
function loadPreviousMonthGoals() {
  // å‰æœˆã®å¹´æœˆã‚’è¨ˆç®—
  let prevYear = selectedGoalYear;
  let prevMonth = selectedGoalMonth - 1;
  
  if (prevMonth === 0) {
    prevMonth = 12;
    prevYear = selectedGoalYear - 1;
  }
  
  // å‰æœˆã®ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const prevGoalsKey = getGoalsKey(prevYear, prevMonth);
  const prevGoalsStr = localStorage.getItem(prevGoalsKey);
  const prevGoals = prevGoalsStr ? JSON.parse(prevGoalsStr) : null;
  
  // å‰æœˆãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã€Œæœªè¨­å®šã€ã¨è¡¨ç¤ºï¼‰
  
  // è¡€åœ§ - åç¸®æœŸ
  if (prevGoals?.bloodPressure?.systolic) {
    document.getElementById('prev-systolic-value').textContent = 
      `${prevGoals.bloodPressure.systolic} mmHg`;
  } else {
    document.getElementById('prev-systolic-value').textContent = 'æœªè¨­å®š';
  }
  
  // è¡€åœ§ - æ‹¡å¼µæœŸ
  if (prevGoals?.bloodPressure?.diastolic) {
    document.getElementById('prev-diastolic-value').textContent = 
      `${prevGoals.bloodPressure.diastolic} mmHg`;
  } else {
    document.getElementById('prev-diastolic-value').textContent = 'æœªè¨­å®š';
  }
  
  // ä½“é‡
  if (prevGoals?.weight) {
    document.getElementById('prev-weight-value').textContent = `${prevGoals.weight} kg`;
  } else {
    document.getElementById('prev-weight-value').textContent = 'æœªè¨­å®š';
  }
  
  // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°
  if (prevGoals?.trainingDays) {
    document.getElementById('prev-days-value').textContent = `${prevGoals.trainingDays} æ—¥`;
  } else {
    document.getElementById('prev-days-value').textContent = 'æœªè¨­å®š';
  }
  
  // é‹å‹•æ™‚é–“
  if (prevGoals?.totalTime) {
    document.getElementById('prev-time-value').textContent = `${prevGoals.totalTime} åˆ†`;
  } else {
    document.getElementById('prev-time-value').textContent = 'æœªè¨­å®š';
  }
  
  // æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼
  if (prevGoals?.totalCalories) {
    document.getElementById('prev-calories-value').textContent = 
      `${prevGoals.totalCalories.toLocaleString()} kcal`;
  } else {
    document.getElementById('prev-calories-value').textContent = 'æœªè¨­å®š';
  }
}


// ç›®æ¨™ã‚’ä¿å­˜
function saveGoals() {
  const systolic = parseInt(document.getElementById('goal-systolic').value);
  const diastolic = parseInt(document.getElementById('goal-diastolic').value);
  const weight = parseFloat(document.getElementById('goal-weight').value);
  const days = parseInt(document.getElementById('goal-days').value);
  const time = parseInt(document.getElementById('goal-time').value);
  const calories = parseInt(document.getElementById('goal-calories').value);
  
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ‰åŠ¹ãªé …ç›®ã®ã¿ï¼‰
  const errors = [];
  
  if (goalItemsEnabled.bloodPressure) {
    if (!systolic || systolic < 100 || systolic > 139) {
      errors.push('åç¸®æœŸè¡€åœ§ã¯100-139ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
    }
    if (!diastolic || diastolic < 70 || diastolic > 89) {
      errors.push('æ‹¡å¼µæœŸè¡€åœ§ã¯70-89ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
    }
  }
  
  if (goalItemsEnabled.weight) {
    const profile = loadProfile();
    if (profile && profile.height) {
      const bmi = calculateBMI(weight, profile.height);
      if (bmi < 18.5 || bmi > 25) {
        errors.push('ä½“é‡ã¯BMI 18.5-25ï¼ˆæ¨™æº–ä½“é‡ï¼‰ã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„');
      }
    }
  }
  
  if (goalItemsEnabled.trainingDays) {
    if (!days || days < 1 || days > 25) {
      errors.push('ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ã¯1-25æ—¥ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆé€±6æ—¥ãƒšãƒ¼ã‚¹ãŒä¸Šé™ï¼‰');
    }
  }
  
  if (goalItemsEnabled.totalTime) {
    if (!time || time < 30 || time > 3000) {
      errors.push('é‹å‹•æ™‚é–“ã¯30-3000åˆ†ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
    }
  }
  
  if (goalItemsEnabled.totalCalories) {
    if (!calories || calories < 100 || calories > 15000) {
      errors.push('æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ã¯100-15000kcalã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
    }
  }
  
  if (errors.length > 0) {
    alert('å…¥åŠ›ã‚¨ãƒ©ãƒ¼:\n\n' + errors.join('\n'));
    return;
  }
  
  // ä¿å­˜ï¼ˆæœ‰åŠ¹ãªé …ç›®ã®ã¿ï¼‰
  const goals = {
    mode: currentGoalMode,
    enabledItems: { ...goalItemsEnabled }
  };
  
  if (goalItemsEnabled.bloodPressure) {
    goals.bloodPressure = {
      systolic: systolic,
      diastolic: diastolic
    };
  }
  
  if (goalItemsEnabled.weight) {
    goals.weight = weight;
  }
  
  if (goalItemsEnabled.trainingDays) {
    goals.trainingDays = days;
  }
  
  if (goalItemsEnabled.totalTime) {
    goals.totalTime = time;
  }
  
  if (goalItemsEnabled.totalCalories) {
    goals.totalCalories = calories;
  }
  
  saveGoalsData(goals);
  updateGoalDisplay();
  closeGoalModal();
  
  // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  showSuccessModal();
}

// æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
function showSuccessModal() {
  document.getElementById('success-modal').classList.add('active');
}

// æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeSuccessModal() {
  document.getElementById('success-modal').classList.remove('active');
}

// ========== ä»Šæ—¥ã®æ—¥ä»˜è¡¨ç¤ºï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ ==========

// ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ›´æ–°
function updateTodayDate() {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth() + 1;
  const day = now.getDate();
  
  // æ›œæ—¥ã®é…åˆ—
  const weekdays = ['æ—¥æ›œæ—¥', 'æœˆæ›œæ—¥', 'ç«æ›œæ—¥', 'æ°´æ›œæ—¥', 'æœ¨æ›œæ—¥', 'é‡‘æ›œæ—¥', 'åœŸæ›œæ—¥'];
  const weekday = weekdays[now.getDay()];
  
  // è‹±èªã®æœˆå
  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                      'July', 'August', 'September', 'October', 'November', 'December'];
  const monthNameEn = monthNames[now.getMonth()];
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼: "2025å¹´ 1æœˆ"
  document.getElementById('date-header-text').textContent = `${year}å¹´ ${month}æœˆ`;
  
  // æ—¥ä»˜ï¼ˆå¤§ããè¡¨ç¤ºï¼‰
  document.getElementById('date-day-value').textContent = day;
  
  // è‹±èªã®æœˆå
  document.getElementById('date-month-year-text').textContent = monthNameEn;
  
  // æ›œæ—¥
  document.getElementById('date-weekday-text').textContent = weekday;
}

// ========== é”æˆåº¦ã‚µãƒãƒªãƒ¼é–¢é€£ï¼ˆNEWï¼‰ ==========

// é”æˆåº¦ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°
function updateAchievementSummary() {
  const now = new Date();
  const currentYear = now.getFullYear();
  const currentMonth = now.getMonth();
  
  console.log('=== updateAchievementSummary é–‹å§‹ ===');
  console.log(`ç¾åœ¨æ—¥æ™‚: ${now}`);
  console.log(`currentYear: ${currentYear}, currentMonth: ${currentMonth} (${currentMonth + 1}æœˆ)`);
  
  // LocalStorageã®ã™ã¹ã¦ã®trainingã‚­ãƒ¼ã‚’è¡¨ç¤º
  const allKeys = Object.keys(localStorage).filter(key => key.startsWith('training_'));
  console.log('LocalStorageã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹trainingã‚­ãƒ¼:', allKeys);
  
  // ä»Šæœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
  const monthData = calculateMonthlyData(currentYear, currentMonth);
  
  // ä»Šæœˆã®ç›®æ¨™ã‚’å–å¾—ï¼ˆgetGoalsKeyé–¢æ•°ã‚’ä½¿ç”¨ã€currentMonthã¯0-11ï¼‰
  const goalsKey = getGoalsKey(currentYear, currentMonth);
  const goalsStr = localStorage.getItem(goalsKey);
  const goals = goalsStr ? JSON.parse(goalsStr) : null;
  console.log('ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼:', goalsKey);
  console.log('ç›®æ¨™ãƒ‡ãƒ¼ã‚¿:', goals);
  
  // é”æˆåº¦ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
  displayAchievementData(monthData, goals);
  
  // åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
  generateEncouragementMessage(monthData, goals);
  
  console.log('=== updateAchievementSummary å®Œäº† ===');
}

// æœˆé–“ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
function calculateMonthlyData(year, month) {
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  let totalSystolic = 0, totalDiastolic = 0, bpCount = 0;
  let totalWeight = 0, weightCount = 0;
  let latestWeight = null;
  let trainingDays = 0, totalTime = 0, totalCalories = 0;
  
  // monthã¯0-11ãªã®ã§ã€LocalStorageã‚­ãƒ¼ã«ã¯+1ãŒå¿…è¦
  const storageMonth = month + 1;
  
  console.log('=== calculateMonthlyData ãƒ‡ãƒãƒƒã‚° ===');
  console.log(`æ¤œç´¢å¯¾è±¡: ${year}å¹´${storageMonth}æœˆ (${daysInMonth}æ—¥ã¾ã§)`);
  console.log(`æ¤œç´¢ã‚­ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³: training_${year}_${storageMonth}_[1-${daysInMonth}]`);
  
  for (let day = 1; day <= daysInMonth; day++) {
    const key = `training_${year}_${storageMonth}_${day}`;
    const dataStr = localStorage.getItem(key);
    
    if (dataStr) {
      console.log(`âœ“ ãƒ‡ãƒ¼ã‚¿ç™ºè¦‹: ${key}`);
      const data = JSON.parse(dataStr);
      console.log('  å†…å®¹:', data);
      
      // è¡€åœ§
      if (data.bloodPressure && data.bloodPressure.systolic && data.bloodPressure.diastolic) {
        totalSystolic += data.bloodPressure.systolic;
        totalDiastolic += data.bloodPressure.diastolic;
        bpCount++;
      }
      
      // ä½“é‡
      if (data.weight) {
        totalWeight += data.weight;
        weightCount++;
        latestWeight = { value: data.weight, date: day };
      }
      
      // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆcalendar.htmlã§ã¯exercisesã§ä¿å­˜ï¼‰
      if (data.exercises && data.exercises.length > 0) {
        trainingDays++;
        data.exercises.forEach(ex => {
          totalTime += ex.duration || 0;
          totalCalories += ex.calories || 0;
        });
      }
      // ã‚‚ã—ãã¯ã€totalTime/totalCaloriesãŒç›´æ¥ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å ´åˆ
      else if (data.totalTime || data.totalCalories) {
        trainingDays++;
        totalTime += data.totalTime || 0;
        totalCalories += data.totalCalories || 0;
      }
    }
  }
  
  console.log('=== é›†è¨ˆçµæœ ===');
  console.log(`ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°: ${trainingDays}`);
  console.log(`é‹å‹•æ™‚é–“: ${totalTime}åˆ†`);
  console.log(`æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼: ${totalCalories}kcal`);
  console.log(`è¡€åœ§ãƒ‡ãƒ¼ã‚¿æ•°: ${bpCount}`);
  console.log('================');
  
  return {
    avgSystolic: bpCount > 0 ? Math.round(totalSystolic / bpCount) : 0,
    avgDiastolic: bpCount > 0 ? Math.round(totalDiastolic / bpCount) : 0,
    latestWeight: latestWeight ? latestWeight.value : 0,
    trainingDays,
    totalTime,
    totalCalories
  };
}

// é”æˆåº¦ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
function displayAchievementData(data, goals) {
  console.log('=== displayAchievementData é–‹å§‹ ===');
  console.log('å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿:', data);
  console.log('å—ã‘å–ã£ãŸç›®æ¨™:', goals);
  
  // è¦ç´ ã®å­˜åœ¨ç¢ºèª
  const bpValueEl = document.getElementById('achievement-bp-value');
  console.log('achievement-bp-valueè¦ç´ :', bpValueEl);
  
  if (!goals) {
    console.log('âš ï¸ ç›®æ¨™ãŒæœªè¨­å®šã®ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º');
    // ç›®æ¨™æœªè¨­å®šã®å ´åˆ
    document.getElementById('achievement-bp-value').textContent = data.avgSystolic > 0 ? `${data.avgSystolic}/${data.avgDiastolic}` : '--/--';
    document.getElementById('achievement-bp-status').textContent = '-';
    document.getElementById('achievement-bp-status').className = 'achievement-status';
    
    document.getElementById('achievement-weight-value').textContent = data.latestWeight > 0 ? `${data.latestWeight.toFixed(1)} kg` : '-- kg';
    document.getElementById('achievement-weight-status').textContent = '-';
    document.getElementById('achievement-weight-status').className = 'achievement-status';
    
    document.getElementById('achievement-days-value').textContent = `${data.trainingDays} æ—¥`;
    document.getElementById('achievement-days-status').textContent = '-';
    document.getElementById('achievement-days-status').className = 'achievement-status';
    
    document.getElementById('achievement-time-value').textContent = `${data.totalTime} åˆ†`;
    document.getElementById('achievement-time-status').textContent = '-';
    document.getElementById('achievement-time-status').className = 'achievement-status';
    
    document.getElementById('achievement-calories-value').textContent = `${data.totalCalories} kcal`;
    document.getElementById('achievement-calories-status').textContent = '-';
    document.getElementById('achievement-calories-status').className = 'achievement-status';
    
    console.log('âœ“ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºå®Œäº†');
    console.log('=== displayAchievementData å®Œäº† ===');
    return;
  }
  
  console.log('âœ“ ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€é”æˆåº¦ã‚’è¨ˆç®—');
  
  // è¡€åœ§ã®é”æˆåº¦
  const bpItem = document.getElementById('achievement-bp');
  if (data.avgSystolic > 0 && goals.bloodPressure) {
    document.getElementById('achievement-bp-value').textContent = `${data.avgSystolic}/${data.avgDiastolic}`;
    
    if (data.avgSystolic <= goals.bloodPressure.systolic && data.avgDiastolic <= goals.bloodPressure.diastolic) {
      document.getElementById('achievement-bp-status').textContent = 'é”æˆ âœ“';
      document.getElementById('achievement-bp-status').className = 'achievement-status good';
      bpItem.className = 'achievement-item good';
    } else {
      document.getElementById('achievement-bp-status').textContent = 'æœªé”æˆ';
      document.getElementById('achievement-bp-status').className = 'achievement-status alert';
      bpItem.className = 'achievement-item alert';
    }
  }
  
  // ä½“é‡ã®é”æˆåº¦
  const weightItem = document.getElementById('achievement-weight');
  if (data.latestWeight > 0 && goals.weight) {
    document.getElementById('achievement-weight-value').textContent = `${data.latestWeight.toFixed(1)} kg`;
    
    if (data.latestWeight <= goals.weight) {
      document.getElementById('achievement-weight-status').textContent = 'é”æˆ âœ“';
      document.getElementById('achievement-weight-status').className = 'achievement-status good';
      weightItem.className = 'achievement-item good';
    } else {
      document.getElementById('achievement-weight-status').textContent = 'æœªé”æˆ';
      document.getElementById('achievement-weight-status').className = 'achievement-status alert';
      weightItem.className = 'achievement-item alert';
    }
  }
  
  // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ã®é”æˆåº¦
  const daysItem = document.getElementById('achievement-days');
  if (goals.trainingDays > 0) {
    const percentage = Math.round((data.trainingDays / goals.trainingDays) * 100);
    document.getElementById('achievement-days-value').textContent = `${data.trainingDays}/${goals.trainingDays} æ—¥`;
    document.getElementById('achievement-days-status').textContent = `${percentage}%`;
    
    const bar = document.getElementById('achievement-days-bar');
    bar.style.width = `${Math.min(percentage, 100)}%`;
    
    if (percentage >= 80) {
      document.getElementById('achievement-days-status').className = 'achievement-status good';
      bar.className = 'progress-bar high';
      daysItem.className = 'achievement-item good';
    } else if (percentage >= 50) {
      document.getElementById('achievement-days-status').className = 'achievement-status warning';
      bar.className = 'progress-bar medium';
      daysItem.className = 'achievement-item warning';
    } else {
      document.getElementById('achievement-days-status').className = 'achievement-status alert';
      bar.className = 'progress-bar low';
      daysItem.className = 'achievement-item alert';
    }
  }
  
  // é‹å‹•æ™‚é–“ã®é”æˆåº¦
  const timeItem = document.getElementById('achievement-time');
  if (goals.totalTime > 0) {
    const percentage = Math.round((data.totalTime / goals.totalTime) * 100);
    document.getElementById('achievement-time-value').textContent = `${data.totalTime}/${goals.totalTime} åˆ†`;
    document.getElementById('achievement-time-status').textContent = `${percentage}%`;
    
    const bar = document.getElementById('achievement-time-bar');
    bar.style.width = `${Math.min(percentage, 100)}%`;
    
    if (percentage >= 80) {
      document.getElementById('achievement-time-status').className = 'achievement-status good';
      bar.className = 'progress-bar high';
      timeItem.className = 'achievement-item good';
    } else if (percentage >= 50) {
      document.getElementById('achievement-time-status').className = 'achievement-status warning';
      bar.className = 'progress-bar medium';
      timeItem.className = 'achievement-item warning';
    } else {
      document.getElementById('achievement-time-status').className = 'achievement-status alert';
      bar.className = 'progress-bar low';
      timeItem.className = 'achievement-item alert';
    }
  }
  
  // æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ã®é”æˆåº¦
  const caloriesItem = document.getElementById('achievement-calories');
  if (goals.totalCalories > 0) {
    const percentage = Math.round((data.totalCalories / goals.totalCalories) * 100);
    document.getElementById('achievement-calories-value').textContent = `${data.totalCalories}/${goals.totalCalories}`;
    document.getElementById('achievement-calories-status').textContent = `${percentage}%`;
    
    const bar = document.getElementById('achievement-calories-bar');
    bar.style.width = `${Math.min(percentage, 100)}%`;
    
    if (percentage >= 80) {
      document.getElementById('achievement-calories-status').className = 'achievement-status good';
      bar.className = 'progress-bar high';
      caloriesItem.className = 'achievement-item good';
    } else if (percentage >= 50) {
      document.getElementById('achievement-calories-status').className = 'achievement-status warning';
      bar.className = 'progress-bar medium';
      caloriesItem.className = 'achievement-item warning';
    } else {
      document.getElementById('achievement-calories-status').className = 'achievement-status alert';
      bar.className = 'progress-bar low';
      caloriesItem.className = 'achievement-item alert';
    }
  }
}

// åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
function generateEncouragementMessage(data, goals) {
  const messageEl = document.getElementById('encouragement-message');
  const textEl = document.getElementById('encouragement-text');
  
  if (!goals) {
    messageEl.className = 'encouragement-message';
    textEl.innerHTML = '<strong>ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ï¼</strong><br>æœˆé–“ç›®æ¨™ã‚’è¨­å®šã™ã‚‹ã¨ã€é”æˆåº¦ã‚’ç¢ºèªã§ãã¾ã™ã€‚';
    return;
  }
  
  // é”æˆåº¦ã‚’è¨ˆç®—
  let achievedCount = 0;
  let totalCount = 0;
  
  // è¡€åœ§
  if (data.avgSystolic > 0 && goals.bloodPressure) {
    totalCount++;
    if (data.avgSystolic <= goals.bloodPressure.systolic && data.avgDiastolic <= goals.bloodPressure.diastolic) {
      achievedCount++;
    }
  }
  
  // ä½“é‡
  if (data.latestWeight > 0 && goals.weight) {
    totalCount++;
    if (data.latestWeight <= goals.weight) {
      achievedCount++;
    }
  }
  
  // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
  const daysPercentage = goals.trainingDays > 0 ? (data.trainingDays / goals.trainingDays) * 100 : 0;
  const timePercentage = goals.totalTime > 0 ? (data.totalTime / goals.totalTime) * 100 : 0;
  const caloriesPercentage = goals.totalCalories > 0 ? (data.totalCalories / goals.totalCalories) * 100 : 0;
  
  const avgPercentage = (daysPercentage + timePercentage + caloriesPercentage) / 3;
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
  if (achievedCount === totalCount && avgPercentage >= 80) {
    messageEl.className = 'encouragement-message';
    textEl.innerHTML = '<strong>ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼ğŸ‰</strong><br>å…¨ã¦ã®ç›®æ¨™ã‚’é”æˆã—ã¦ã„ã¾ã™ã€‚ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
  } else if (avgPercentage >= 70) {
    messageEl.className = 'encouragement-message';
    textEl.innerHTML = `<strong>é †èª¿ã§ã™ï¼</strong><br>ä»Šæœˆã®é€²æ—ã¯${Math.round(avgPercentage)}%ã§ã™ã€‚ç›®æ¨™é”æˆã¾ã§ã‚ã¨å°‘ã—ã§ã™ã€‚`;
  } else if (avgPercentage >= 40) {
    messageEl.className = 'encouragement-message warning';
    textEl.innerHTML = `<strong>ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†</strong><br>ç¾åœ¨ã®é€²æ—ã¯${Math.round(avgPercentage)}%ã§ã™ã€‚å°‘ã—ãšã¤é‹å‹•é‡ã‚’å¢—ã‚„ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚`;
  } else {
    messageEl.className = 'encouragement-message alert';
    textEl.innerHTML = '<strong>ä¸€ç·’ã«é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼</strong><br>ç›®æ¨™é”æˆã«ã¯ã‚‚ã†ä¸€æ­©ã§ã™ã€‚ä»Šæ—¥ã‹ã‚‰å°‘ã—ãšã¤å§‹ã‚ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ';
  }
}

// ========== æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ï¼ˆNEWï¼‰ ==========

function toggleCard(contentId) {
  const content = document.getElementById(contentId);
  const toggleIcon = document.getElementById(contentId.replace('-content', '-toggle'));
  
  if (content.classList.contains('expanded')) {
    content.classList.remove('expanded');
    toggleIcon.classList.remove('expanded');
  } else {
    content.classList.add('expanded');
    toggleIcon.classList.add('expanded');
  }
}

// ========== è¡¨ç¤ºé …ç›®è¨­å®šï¼ˆNEWï¼‰ ==========

// è¡¨ç¤ºé …ç›®è¨­å®šã®ä¸€æ™‚ä¿å­˜ç”¨
let tempDisplaySettings = {
  bloodPressure: true,
  weight: true,
  trainingDays: true,
  totalTime: true,
  totalCalories: true
};

// è¡¨ç¤ºé …ç›®è¨­å®šã‚’èª­ã¿è¾¼ã¿
function loadDisplaySettings() {
  const saved = localStorage.getItem('achievement_display_settings');
  if (saved) {
    tempDisplaySettings = JSON.parse(saved);
  }
  updateAchievementDisplay();
}

// è¡¨ç¤ºé …ç›®è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
function openDisplaySettings() {
  // LocalStorageã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
  const saved = localStorage.getItem('achievement_display_settings');
  if (saved) {
    tempDisplaySettings = JSON.parse(saved);
  }
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã‚’è¨­å®šã«åˆã‚ã›ã¦æ›´æ–°
  updateModalToggles();
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  document.getElementById('displaySettingsModal').classList.add('show');
}

// è¡¨ç¤ºé …ç›®è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeDisplaySettings() {
  document.getElementById('displaySettingsModal').classList.remove('show');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã‚’æ›´æ–°
function updateModalToggles() {
  const items = document.querySelectorAll('.display-option-item');
  const keys = ['bloodPressure', 'weight', 'trainingDays', 'totalTime', 'totalCalories'];
  
  items.forEach((item, index) => {
    const toggle = item.querySelector('.toggle-switch');
    const key = keys[index];
    
    if (tempDisplaySettings[key]) {
      toggle.classList.add('active');
    } else {
      toggle.classList.remove('active');
    }
  });
}

// è¡¨ç¤ºé …ç›®ã®ãƒˆã‚°ãƒ«åˆ‡ã‚Šæ›¿ãˆ
function toggleDisplayOption(element, key) {
  element.classList.toggle('active');
  tempDisplaySettings[key] = element.classList.contains('active');
}

// è¡¨ç¤ºé …ç›®è¨­å®šã‚’ä¿å­˜
function saveDisplaySettings() {
  // LocalStorageã«ä¿å­˜
  localStorage.setItem('achievement_display_settings', JSON.stringify(tempDisplaySettings));
  
  // é”æˆåº¦ã‚«ãƒ¼ãƒ‰ã®è¡¨ç¤ºã‚’æ›´æ–°
  updateAchievementDisplay();
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  closeDisplaySettings();
}

// é”æˆåº¦ã‚«ãƒ¼ãƒ‰ã®è¡¨ç¤ºã‚’æ›´æ–°
function updateAchievementDisplay() {
  const items = document.querySelectorAll('.achievement-item');
  
  items.forEach(item => {
    const dataItem = item.getAttribute('data-item');
    if (tempDisplaySettings[dataItem]) {
      item.classList.remove('hidden');
    } else {
      item.classList.add('hidden');
    }
  });
}

// åˆæœŸåŒ–
window.addEventListener('DOMContentLoaded', function() {
  applyMonthTheme();
  const profile = loadProfile();
  
  if (profile) {
    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šæ¸ˆã¿: ãƒ¢ãƒ¼ãƒ€ãƒ«ã¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã€å…¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
    document.getElementById('profile-setup').classList.add('hidden');
    document.getElementById('profile-display').classList.remove('hidden');
    document.getElementById('goal-display').classList.remove('hidden');
    document.getElementById('achievement-display').classList.remove('hidden');
    document.getElementById('today-date-display').classList.remove('hidden');
    document.getElementById('main-navigation').classList.remove('hidden');
    updateProfileDisplay(profile);
    
    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ›´æ–°
    updateTodayDate();
    
    updateGoalDisplay();
    
    // é”æˆåº¦ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°
    updateAchievementSummary();
    
    // è¡¨ç¤ºé …ç›®è¨­å®šã‚’èª­ã¿è¾¼ã¿
    loadDisplaySettings();
    
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('openGoals') === 'true') {
      // å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãï¼ˆã‚¹ãƒ ãƒ¼ã‚ºãªè¡¨ç¤ºã®ãŸã‚ï¼‰
      setTimeout(() => {
        openGoalModal();
      }, 100);
    }
  } else {
    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æœªè¨­å®š: å…¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã—ã€2ç§’å¾Œã«ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    document.getElementById('profile-setup').classList.add('hidden');
    document.getElementById('profile-display').classList.remove('hidden');
    document.getElementById('goal-display').classList.remove('hidden');
    document.getElementById('achievement-display').classList.remove('hidden');
    document.getElementById('today-date-display').classList.remove('hidden');
    document.getElementById('main-navigation').classList.remove('hidden');
    
    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ›´æ–°
    updateTodayDate();
    
    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã‚’ç©ºã®çŠ¶æ…‹ã§åˆæœŸåŒ–
    updateProfileDisplay({
      gender: null,
      age: null,
      height: null,
      weight: null
    });
    
    updateGoalDisplay();
    updateAchievementSummary();
    loadDisplaySettings();
    
    // 2ç§’å¾Œã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    setTimeout(() => {
      showProfilePrompt();
    }, 2000);
  }
});

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
function showProfilePrompt() {
  document.getElementById('profile-prompt-modal').classList.add('show');
  document.getElementById('profile-floating-btn').classList.remove('show');
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeProfilePrompt() {
  document.getElementById('profile-prompt-modal').classList.remove('show');
}

// ã€Œä»Šã™ãè¨­å®šã™ã‚‹ã€ãƒœã‚¿ãƒ³
function setupProfileNow() {
  closeProfilePrompt();
  
  // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã‚«ãƒ¼ãƒ‰ã¾ã§ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  const profileCard = document.getElementById('profile-display');
  if (profileCard) {
    // å¼·èª¿è¡¨ç¤ºã‚’è¿½åŠ 
    profileCard.classList.add('highlight');
    
    // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    profileCard.scrollIntoView({ 
      behavior: 'smooth', 
      block: 'center' 
    });
    
    // 1ç§’å¾Œã«è‡ªå‹•çš„ã«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    setTimeout(() => {
      editProfile();
      // å¼·èª¿è¡¨ç¤ºã‚’è§£é™¤ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œï¼‰
      setTimeout(() => {
        profileCard.classList.remove('highlight');
      }, 6000); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³3å› Ã— 2ç§’
    }, 1000);
  }
}

// ã€Œå¾Œã§è¨­å®šã™ã‚‹ã€ãƒœã‚¿ãƒ³
function setupProfileLater() {
  closeProfilePrompt();
  // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
  document.getElementById('profile-floating-btn').classList.add('show');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.addEventListener('DOMContentLoaded', function() {
  const modal = document.getElementById('profile-prompt-modal');
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        setupProfileLater();
      }
    });
  }
});
</script>

<!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="success-modal" id="success-modal">
  <div class="success-modal-content">
    <div class="success-icon">âœ…</div>
    <h2 class="success-title">ç›®æ¨™ã‚’ä¿å­˜ã—ã¾ã—ãŸ!</h2>
    <p class="success-message">
      ä»Šæœˆã®ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¾ã—ãŸã€‚<br>
      ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§å®Ÿç¸¾ã‚’è¨˜éŒ²ã—ã¦ã€é”æˆåº¦ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
    </p>
    <div class="success-buttons">
      <a href="calendar.html" class="btn-success">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§è¨˜éŒ²ã™ã‚‹</a>
      <button class="btn-success-secondary" onclick="closeSuccessModal()">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
    </div>
  </div>
</div>

<!-- ========== ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ ========== -->
<div class="bottom-nav-bar">
  <a href="home.html" class="bottom-nav-item active" title="ãƒ›ãƒ¼ãƒ ">
    <span class="bottom-nav-icon">ğŸ </span>
    <span class="bottom-nav-label">ãƒ›ãƒ¼ãƒ </span>
  </a>
  
  <a href="calendar.html" class="bottom-nav-item" title="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼">
    <span class="bottom-nav-icon">ğŸ“…</span>
    <span class="bottom-nav-label">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</span>
  </a>
  
  <a href="timeline.html" class="bottom-nav-item" title="ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³">
    <span class="bottom-nav-icon">ğŸ“‹</span>
    <span class="bottom-nav-label">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</span>
  </a>
  
  <a href="yearly-summary.html" class="bottom-nav-item" title="å¹´é–“ã‚µãƒãƒªãƒ¼">
    <span class="bottom-nav-icon">ğŸ“Š</span>
    <span class="bottom-nav-label">ã‚µãƒãƒªãƒ¼</span>
  </a>
  
  <a href="features.html" class="bottom-nav-item" title="ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰">
    <span class="bottom-nav-icon">ğŸ“–</span>
    <span class="bottom-nav-label">ã‚¬ã‚¤ãƒ‰</span>
  </a>
</div>

<!-- è¡¨ç¤ºé …ç›®è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆNEWï¼‰ -->
<div class="modal-overlay display-settings-modal" id="displaySettingsModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">âš™ï¸ è¡¨ç¤ºé …ç›®ã®è¨­å®š</div>
      <button class="modal-close" onclick="closeDisplaySettings()">âœ•</button>
    </div>

    <p style="color: #616161; margin-bottom: 20px; font-size: 0.95em;">
      é”æˆåº¦ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã™ã‚‹é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
    </p>

    <ul class="display-options">
      <li class="display-option-item">
        <label class="display-option-label">
          <span class="display-option-icon">ğŸ«€</span>
          <span>è¡€åœ§</span>
        </label>
        <div class="toggle-switch active" onclick="toggleDisplayOption(this, 'bloodPressure')">
          <div class="toggle-slider"></div>
        </div>
      </li>

      <li class="display-option-item">
        <label class="display-option-label">
          <span class="display-option-icon">âš–ï¸</span>
          <span>ä½“é‡</span>
        </label>
        <div class="toggle-switch active" onclick="toggleDisplayOption(this, 'weight')">
          <div class="toggle-slider"></div>
        </div>
      </li>

      <li class="display-option-item">
        <label class="display-option-label">
          <span class="display-option-icon">ğŸ“…</span>
          <span>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°</span>
        </label>
        <div class="toggle-switch active" onclick="toggleDisplayOption(this, 'trainingDays')">
          <div class="toggle-slider"></div>
        </div>
      </li>

      <li class="display-option-item">
        <label class="display-option-label">
          <span class="display-option-icon">â±ï¸</span>
          <span>é‹å‹•æ™‚é–“</span>
        </label>
        <div class="toggle-switch active" onclick="toggleDisplayOption(this, 'totalTime')">
          <div class="toggle-slider"></div>
        </div>
      </li>

      <li class="display-option-item">
        <label class="display-option-label">
          <span class="display-option-icon">ğŸ”¥</span>
          <span>æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</span>
        </label>
        <div class="toggle-switch active" onclick="toggleDisplayOption(this, 'totalCalories')">
          <div class="toggle-slider"></div>
        </div>
      </li>
    </ul>

    <div class="modal-footer">
      <button class="btn-modal btn-cancel" onclick="closeDisplaySettings()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn-modal btn-save" onclick="saveDisplaySettings()">ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆNEWï¼‰ -->
<div class="modal-overlay profile-edit-modal" id="profileEditModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</div>
      <button class="modal-close" onclick="closeProfileEditModal()">âœ•</button>
    </div>

    <form id="profile-edit-form" class="modal-form">
      <div class="form-group">
        <label class="form-label">æ€§åˆ¥</label>
        <div class="radio-group horizontal">
          <div class="radio-option">
            <input type="radio" id="edit-gender-male" name="editGender" value="male">
            <label for="edit-gender-male">ç”·æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="edit-gender-female" name="editGender" value="female">
            <label for="edit-gender-female">å¥³æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="edit-gender-other" name="editGender" value="other">
            <label for="edit-gender-other">ãã®ä»–</label>
          </div>
        </div>
        <div class="error-message" id="error-edit-gender"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="edit-age">å¹´é½¢</label>
        <div class="input-with-unit">
          <input type="number" id="edit-age" class="form-input" placeholder="30" min="10" max="120">
          <span class="unit">æ­³</span>
        </div>
        <div class="error-message" id="error-edit-age"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="edit-height">èº«é•·ï¼ˆä»»æ„ï¼‰</label>
        <div class="input-with-unit">
          <input type="number" id="edit-height" class="form-input" placeholder="170" min="100" max="250">
          <span class="unit">cm</span>
        </div>
        <p class="form-hint">BMIè¨ˆç®—ã«ä½¿ç”¨ã•ã‚Œã¾ã™</p>
        <div class="error-message" id="error-edit-height"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="edit-weight">ä½“é‡</label>
        <div class="input-with-unit">
          <input type="number" id="edit-weight" class="form-input" placeholder="65" min="30" max="200" step="0.1">
          <span class="unit">kg</span>
        </div>
        <div class="error-message" id="error-edit-weight"></div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-modal btn-cancel" onclick="closeProfileEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button type="submit" class="btn-modal btn-save">ä¿å­˜</button>
      </div>
    </form>
  </div>
</div>

</body>
</html>