<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ 2025</title>
<style>
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #FFF9C4 0%, #FFECB3 50%, #FFE082 100%);
  min-height: 100vh;
  padding: 20px;
  color: #212121;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.hero-section {
  text-align: center;
  padding: 60px 20px;
  margin-bottom: 40px;
}

.hero-icon {
  font-size: 80px;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.hero-title {
  font-size: 2.5em;
  font-weight: bold;
  background: linear-gradient(135deg, #F57C00 0%, #FFB300 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 10px;
}

.hero-subtitle {
  font-size: 1.2em;
  color: #616161;
  margin-bottom: 30px;
}

.hero-cta {
  display: inline-block;
  padding: 16px 48px;
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  font-size: 1.2em;
  font-weight: 600;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(245, 124, 0, 0.3);
}

.hero-cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(245, 124, 0, 0.4);
}

/* ã‚«ãƒ¼ãƒ‰å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
.card {
  background: white;
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.card-title {
  font-size: 1.5em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã‚«ãƒ¼ãƒ‰ */
.profile-setup-card {
  background: linear-gradient(145deg, #FFFFFF, #FFFBF5);
}

.setup-header {
  text-align: center;
  margin-bottom: 30px;
}

.setup-title {
  font-size: 1.8em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 10px;
}

.setup-subtitle {
  color: #616161;
  font-size: 1em;
}

.form-group {
  margin-bottom: 24px;
  text-align: center;
}

.form-label {
  display: block;
  font-size: 0.95em;
  font-weight: 600;
  color: #424242;
  margin-bottom: 8px;
  text-align: center;
}

.form-hint {
  font-size: 0.85em;
  color: #9E9E9E;
  margin-top: 4px;
  text-align: center;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  font-size: 1em;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: #FFB300;
  box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.1);
}

.form-input.error {
  border-color: #EF5350;
}

.error-message {
  color: #EF5350;
  font-size: 0.85em;
  margin-top: 4px;
  display: none;
  text-align: center;
}

.error-message.show {
  display: block;
}

/* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
.radio-group {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
}

.radio-group.vertical {
  flex-direction: column;
  align-items: flex-start;
}

.radio-option {
  display: flex;
  align-items: center;
  cursor: pointer;
}

.radio-option input[type="radio"] {
  width: 20px;
  height: 20px;
  margin-right: 8px;
  cursor: pointer;
  accent-color: #F57C00;
}

.radio-option label {
  font-size: 0.95em;
  cursor: pointer;
  user-select: none;
}

/* æ•°å€¤å…¥åŠ›ã‚°ãƒ«ãƒ¼ãƒ— */
.input-with-unit {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  max-width: 200px;
  margin: 0 auto;
}

.input-with-unit .form-input {
  flex: 1;
  text-align: center;
}

.unit {
  font-size: 0.95em;
  color: #616161;
  font-weight: 500;
}

/* ãƒœã‚¿ãƒ³ */
.btn {
  padding: 14px 32px;
  font-size: 1.1em;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  display: inline-block;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  width: 100%;
  box-shadow: 0 4px 12px rgba(245, 124, 0, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(245, 124, 0, 0.4);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.skip-link {
  display: block;
  text-align: center;
  margin-top: 16px;
  color: #9E9E9E;
  text-decoration: none;
  font-size: 0.95em;
  transition: color 0.3s ease;
}

.skip-link:hover {
  color: #616161;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã‚«ãƒ¼ãƒ‰ */
.profile-display-card {
  background: linear-gradient(145deg, #FFF9C4, #FFFFFF);
  border: 2px solid #FFD54F;
}

.profile-header {
  text-align: center;
  margin-bottom: 24px;
}

.profile-name {
  font-size: 1.5em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 8px;
}

.profile-info-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.profile-info-item {
  display: flex;
  flex-direction: column;
}

.profile-info-label {
  font-size: 0.85em;
  color: #616161;
  margin-bottom: 4px;
}

.profile-info-value {
  font-size: 1.1em;
  font-weight: 600;
  color: #212121;
}

.bmi-low {
  color: #42A5F5;
}

.bmi-normal {
  color: #66BB6A;
}

.bmi-high {
  color: #FFA726;
}

.bmi-very-high {
  color: #EF5350;
}

.btn-edit {
  background: white;
  color: #F57C00;
  border: 2px solid #F57C00;
  width: 100%;
}

.btn-edit:hover {
  background: #F57C00;
  color: white;
}

/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ */
.nav-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  text-decoration: none;
  color: inherit;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.nav-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  border-color: #FFD54F;
}

.nav-card-content {
  display: flex;
  align-items: center;
  gap: 20px;
}

.nav-card-icon {
  font-size: 2.5em;
}

.nav-card-text {
  display: flex;
  flex-direction: column;
}

.nav-card-title {
  font-size: 1.2em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 4px;
}

.nav-card-subtitle {
  font-size: 0.9em;
  color: #616161;
}

.nav-card-arrow {
  font-size: 1.5em;
  color: #FFB300;
  font-weight: bold;
}

/* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ */
.hidden {
  display: none;
}

.fade-in {
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
  .hero-title {
    font-size: 2em;
  }

  .hero-subtitle {
    font-size: 1em;
  }

  .profile-info-grid {
    grid-template-columns: 1fr;
  }

  .nav-card-content {
    gap: 15px;
  }

  .nav-card-icon {
    font-size: 2em;
  }

  .nav-card-title {
    font-size: 1em;
  }

  .nav-card-subtitle {
    font-size: 0.85em;
  }
}
</style>
</head>
<body>

<div class="container">
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="hero-section">
    <div class="hero-icon">ğŸ</div>
    <h1 class="hero-title">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
    <p class="hero-subtitle">å¥åº·çš„ãªæ¯æ—¥ã‚’ã‚µãƒãƒ¼ãƒˆ</p>
    <a href="calendar.html" class="hero-cta hidden" id="hero-cta">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ã</a>
  </section>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šï¼ˆåˆå›ã®ã¿è¡¨ç¤ºï¼‰ -->
  <div class="card profile-setup-card fade-in" id="profile-setup">
    <div class="setup-header">
      <h2 class="setup-title">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h2>
      <p class="setup-subtitle">ã‚ãªãŸã®åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    </div>

    <form id="profile-form">
      <div class="form-group">
        <label class="form-label">æ€§åˆ¥</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="gender-male" name="gender" value="male">
            <label for="gender-male">ç”·æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="gender-female" name="gender" value="female">
            <label for="gender-female">å¥³æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="gender-other" name="gender" value="other">
            <label for="gender-other">ãã®ä»–</label>
          </div>
        </div>
        <div class="error-message" id="error-gender"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="age">å¹´é½¢</label>
        <div class="input-with-unit">
          <input type="number" id="age" class="form-input" placeholder="30" min="10" max="120">
          <span class="unit">æ­³</span>
        </div>
        <div class="error-message" id="error-age"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="height">èº«é•·ï¼ˆä»»æ„ï¼‰</label>
        <div class="input-with-unit">
          <input type="number" id="height" class="form-input" placeholder="170" min="100" max="250">
          <span class="unit">cm</span>
        </div>
        <p class="form-hint">BMIè¨ˆç®—ã«ä½¿ç”¨ã•ã‚Œã¾ã™</p>
        <div class="error-message" id="error-height"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="weight">ä½“é‡</label>
        <div class="input-with-unit">
          <input type="number" id="weight" class="form-input" placeholder="65" min="30" max="200" step="0.1">
          <span class="unit">kg</span>
        </div>
        <div class="error-message" id="error-weight"></div>
      </div>

      <div class="form-group">
        <label class="form-label">æ´»å‹•ãƒ¬ãƒ™ãƒ«</label>
        <div class="radio-group vertical">
          <div class="radio-option">
            <input type="radio" id="activity-sedentary" name="activityLevel" value="sedentary">
            <label for="activity-sedentary">ã»ã¨ã‚“ã©é‹å‹•ã—ãªã„</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="activity-light" name="activityLevel" value="light">
            <label for="activity-light">è»½ã„é‹å‹•ï¼ˆé€±1-2å›ï¼‰</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="activity-moderate" name="activityLevel" value="moderate" checked>
            <label for="activity-moderate">ä¸­ç¨‹åº¦ã®é‹å‹•ï¼ˆé€±3-5å›ï¼‰</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="activity-intense" name="activityLevel" value="intense">
            <label for="activity-intense">æ¿€ã—ã„é‹å‹•ï¼ˆé€±6-7å›ï¼‰</label>
          </div>
        </div>
      </div>

      <button type="submit" class="btn btn-primary">âœ… å®Œäº†ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸</button>
      <a href="calendar.html" class="skip-link">ã‚¹ã‚­ãƒƒãƒ— â†’</a>
    </form>
  </div>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <div class="card profile-display-card fade-in hidden" id="profile-display">
    <div class="profile-header">
      <div class="card-title">ğŸ‘¤ ã‚ãªãŸã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
      <div class="profile-name" id="profile-name">30æ­³ãƒ»ç”·æ€§</div>
    </div>

    <div class="profile-info-grid">
      <div class="profile-info-item">
        <span class="profile-info-label">èº«é•·</span>
        <span class="profile-info-value" id="display-height">170 cm</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">ä½“é‡</span>
        <span class="profile-info-value" id="display-weight">65 kg</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">æ´»å‹•ãƒ¬ãƒ™ãƒ«</span>
        <span class="profile-info-value" id="display-activity">ä¸­ç¨‹åº¦ã®é‹å‹•</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">æ€§åˆ¥</span>
        <span class="profile-info-value" id="display-gender">ç”·æ€§</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">BMI</span>
        <span class="profile-info-value" id="display-bmi">22.5 (æ¨™æº–)</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">åŸºç¤ä»£è¬</span>
        <span class="profile-info-value" id="display-bmr">ç´„1,650 kcal/æ—¥</span>
      </div>
    </div>

    <button class="btn btn-edit" onclick="editProfile()">âœï¸ ç·¨é›†</button>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <section class="fade-in hidden" id="main-navigation">
    <a href="calendar.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“…</div>
        <div class="nav-card-text">
          <div class="nav-card-title">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ã</div>
          <div class="nav-card-subtitle">æœˆåˆ¥ã®è¨˜éŒ²ã‚’ç¢ºèªãƒ»å…¥åŠ›</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="yearly-summary.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“Š</div>
        <div class="nav-card-text">
          <div class="nav-card-title">å¹´é–“ã‚µãƒãƒªãƒ¼ã‚’è¦‹ã‚‹</div>
          <div class="nav-card-subtitle">1å¹´é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="features.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“–</div>
        <div class="nav-card-text">
          <div class="nav-card-title">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</div>
          <div class="nav-card-subtitle">æ©Ÿèƒ½ã®è©³ã—ã„èª¬æ˜</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="#settings" class="nav-card" onclick="alert('è¨­å®šç”»é¢ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™'); return false;">
      <div class="nav-card-content">
        <div class="nav-card-icon">âš™ï¸</div>
        <div class="nav-card-text">
          <div class="nav-card-title">è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
          <div class="nav-card-subtitle">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ç›®æ¨™è¨­å®š</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>
  </section>
</div>

<script>
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼
const PROFILE_KEY = 'user_profile';

// æœˆåˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²è¨­å®š
const monthThemes = {
  0: { icon: 'â„ï¸', bg: 'linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%)' },  // 1æœˆ: é›ª
  1: { icon: 'ğŸ’—', bg: 'linear-gradient(135deg, #FCE4EC 0%, #F8BBD0 50%, #F48FB1 100%)' },  // 2æœˆ: ãƒãƒ¼ãƒˆ
  2: { icon: 'ğŸŒ¸', bg: 'linear-gradient(135deg, #F1F8E9 0%, #DCEDC8 50%, #C5E1A5 100%)' },  // 3æœˆ: æ¡œ
  3: { icon: 'ğŸŒ·', bg: 'linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 50%, #FFCC80 100%)' },  // 4æœˆ: ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ—
  4: { icon: 'ğŸŒ¿', bg: 'linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 50%, #A5D6A7 100%)' },  // 5æœˆ: æ–°ç·‘
  5: { icon: 'ğŸŒˆ', bg: 'linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 50%, #CE93D8 100%)' },  // 6æœˆ: è™¹ï¼ˆæ¢…é›¨ï¼‰
  6: { icon: 'ğŸŒŠ', bg: 'linear-gradient(135deg, #E1F5FE 0%, #B3E5FC 50%, #81D4FA 100%)' },  // 7æœˆ: æµ·
  7: { icon: 'ğŸŒ»', bg: 'linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 50%, #EF9A9A 100%)' },  // 8æœˆ: ã²ã¾ã‚ã‚Š
  8: { icon: 'ğŸ‚', bg: 'linear-gradient(135deg, #E0F2F1 0%, #B2DFDB 50%, #80CBC4 100%)' },  // 9æœˆ: ç´…è‘‰å§‹ã¾ã‚Š
  9: { icon: 'ğŸ', bg: 'linear-gradient(135deg, #FFF9C4 0%, #FFECB3 50%, #FFE082 100%)' },  // 10æœˆ: ç´…è‘‰
  10: { icon: 'ğŸ„', bg: 'linear-gradient(135deg, #EFEBE9 0%, #D7CCC8 50%, #BCAAA4 100%)' }, // 11æœˆ: ãã®ã“
  11: { icon: 'â›„', bg: 'linear-gradient(135deg, #ECEFF1 0%, #CFD8DC 50%, #B0BEC5 100%)' }  // 12æœˆ: é›ªã ã‚‹ã¾
};

// ç¾åœ¨ã®æœˆã‚’å–å¾—
function getCurrentMonth() {
  return new Date().getMonth();
}

// æœˆåˆ¥ãƒ†ãƒ¼ãƒã®é©ç”¨
function applyMonthTheme() {
  const currentMonth = getCurrentMonth();
  const theme = monthThemes[currentMonth];
  
  // èƒŒæ™¯è‰²ã®å¤‰æ›´
  document.body.style.background = theme.bg;
  
  // ã‚¢ã‚¤ã‚³ãƒ³ã®å¤‰æ›´
  document.querySelector('.hero-icon').textContent = theme.icon;
}

// æ´»å‹•ãƒ¬ãƒ™ãƒ«ã®è¡¨ç¤ºå
const activityLabels = {
  sedentary: 'ã»ã¨ã‚“ã©é‹å‹•ã—ãªã„',
  light: 'è»½ã„é‹å‹•ï¼ˆé€±1-2å›ï¼‰',
  moderate: 'ä¸­ç¨‹åº¦ã®é‹å‹•ï¼ˆé€±3-5å›ï¼‰',
  intense: 'æ¿€ã—ã„é‹å‹•ï¼ˆé€±6-7å›ï¼‰'
};

// æ€§åˆ¥ã®è¡¨ç¤ºå
const genderLabels = {
  male: 'ç”·æ€§',
  female: 'å¥³æ€§',
  other: 'ãã®ä»–'
};

// æ´»å‹•ãƒ¬ãƒ™ãƒ«ã®ä¿‚æ•°
const activityMultipliers = {
  sedentary: 1.2,
  light: 1.375,
  moderate: 1.55,
  intense: 1.725
};

// BMIè¨ˆç®—
function calculateBMI(weight, height) {
  if (!height || height === 0) return null;
  const heightM = height / 100;
  return (weight / (heightM * heightM)).toFixed(1);
}

// BMIåˆ¤å®š
function getBMIStatus(bmi) {
  if (!bmi) return { class: '', text: '' };
  if (bmi < 18.5) return { class: 'bmi-low', text: 'ä½ä½“é‡' };
  if (bmi < 25) return { class: 'bmi-normal', text: 'æ¨™æº–' };
  if (bmi < 30) return { class: 'bmi-high', text: 'è‚¥æº€ï¼ˆ1åº¦ï¼‰' };
  return { class: 'bmi-very-high', text: 'è‚¥æº€ï¼ˆ2åº¦ä»¥ä¸Šï¼‰' };
}

// åŸºç¤ä»£è¬è¨ˆç®—ï¼ˆHarris-Benedictå¼ï¼‰
function calculateBMR(gender, weight, height, age) {
  if (!weight || !age) return null;
  
  if (gender === 'male') {
    if (!height) {
      // èº«é•·ãŒãªã„å ´åˆã®ç°¡æ˜“è¨ˆç®—
      return Math.round(66.47 + (13.75 * weight) - (6.76 * age));
    }
    return Math.round(66.47 + (13.75 * weight) + (5.00 * height) - (6.76 * age));
  } else if (gender === 'female') {
    if (!height) {
      return Math.round(655.10 + (9.56 * weight) - (4.68 * age));
    }
    return Math.round(655.10 + (9.56 * weight) + (1.85 * height) - (4.68 * age));
  } else {
    // ãã®ä»–ã®æ€§åˆ¥ã®å ´åˆã¯å¹³å‡ã‚’ä½¿ç”¨
    if (!height) {
      const male = 66.47 + (13.75 * weight) - (6.76 * age);
      const female = 655.10 + (9.56 * weight) - (4.68 * age);
      return Math.round((male + female) / 2);
    }
    const male = 66.47 + (13.75 * weight) + (5.00 * height) - (6.76 * age);
    const female = 655.10 + (9.56 * weight) + (1.85 * height) - (4.68 * age);
    return Math.round((male + female) / 2);
  }
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
function loadProfile() {
  const profileStr = localStorage.getItem(PROFILE_KEY);
  if (profileStr) {
    return JSON.parse(profileStr);
  }
  return null;
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
function saveProfile(profile) {
  profile.updatedAt = new Date().toISOString();
  if (!profile.createdAt) {
    profile.createdAt = profile.updatedAt;
  }
  localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã®æ›´æ–°
function updateProfileDisplay(profile) {
  // åå‰è¡¨ç¤ºï¼ˆå¹´é½¢ã¨æ€§åˆ¥ï¼‰
  const genderText = genderLabels[profile.gender] || '---';
  document.getElementById('profile-name').textContent = 
    `${profile.age}æ­³ãƒ»${genderText}`;

  // åŸºæœ¬æƒ…å ±
  document.getElementById('display-height').textContent = 
    profile.height ? `${profile.height} cm` : 'æœªå…¥åŠ›';
  document.getElementById('display-weight').textContent = 
    profile.weight ? `${profile.weight} kg` : '---';
  document.getElementById('display-activity').textContent = 
    activityLabels[profile.activityLevel] || 'æœªè¨­å®š';
  document.getElementById('display-gender').textContent = genderText;

  // BMIè¨ˆç®—ã¨è¡¨ç¤º
  const bmi = calculateBMI(profile.weight, profile.height);
  const bmiDisplay = document.getElementById('display-bmi');
  if (bmi) {
    const status = getBMIStatus(parseFloat(bmi));
    bmiDisplay.innerHTML = `<span class="${status.class}">${bmi}</span> <span style="font-size: 0.8em;">(${status.text})</span>`;
  } else {
    bmiDisplay.innerHTML = '<span style="color: #9E9E9E;">èº«é•·ã‚’å…¥åŠ›ã™ã‚‹ã¨<br>è¨ˆç®—ã•ã‚Œã¾ã™</span>';
  }

  // åŸºç¤ä»£è¬è¨ˆç®—ã¨è¡¨ç¤º
  const bmr = calculateBMR(profile.gender, profile.weight, profile.height, profile.age);
  const bmrDisplay = document.getElementById('display-bmr');
  if (bmr) {
    bmrDisplay.textContent = `ç´„${bmr.toLocaleString()} kcal/æ—¥`;
  } else {
    bmrDisplay.textContent = '---';
  }
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateProfile(profile) {
  const errors = [];
  
  // æ€§åˆ¥
  if (!profile.gender) {
    errors.push({ field: 'gender', message: 'æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„' });
  }
  
  // å¹´é½¢
  if (!profile.age || profile.age < 10 || profile.age > 120) {
    errors.push({ field: 'age', message: '10æ­³ã‹ã‚‰120æ­³ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  
  // ä½“é‡
  if (!profile.weight || profile.weight < 30 || profile.weight > 200) {
    errors.push({ field: 'weight', message: '30kgã‹ã‚‰200kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  
  // èº«é•·ï¼ˆå…¥åŠ›ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
  if (profile.height && (profile.height < 100 || profile.height > 250)) {
    errors.push({ field: 'height', message: '100cmã‹ã‚‰250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  
  return errors;
}

// ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
function showErrors(errors) {
  // ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢
  document.querySelectorAll('.error-message').forEach(el => {
    el.classList.remove('show');
  });
  document.querySelectorAll('.form-input').forEach(el => {
    el.classList.remove('error');
  });
  
  // ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
  errors.forEach(error => {
    const errorEl = document.getElementById(`error-${error.field}`);
    const inputEl = document.getElementById(error.field);
    
    if (errorEl) {
      errorEl.classList.add('show');
      errorEl.textContent = error.message;
    }
    
    if (inputEl) {
      inputEl.classList.add('error');
    }
  });
}

// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
document.getElementById('profile-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // ãƒ‡ãƒ¼ã‚¿å–å¾—
  const profile = {
    gender: document.querySelector('input[name="gender"]:checked')?.value,
    age: parseInt(document.getElementById('age').value) || null,
    height: parseInt(document.getElementById('height').value) || null,
    weight: parseFloat(document.getElementById('weight').value) || null,
    activityLevel: document.querySelector('input[name="activityLevel"]:checked')?.value || 'moderate'
  };
  
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const errors = validateProfile(profile);
  
  if (errors.length > 0) {
    showErrors(errors);
    return;
  }
  
  // ä¿å­˜
  saveProfile(profile);
  
  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸ã¸é·ç§»
  window.location.href = 'calendar.html';
});

// ç·¨é›†ãƒœã‚¿ãƒ³
function editProfile() {
  const profile = loadProfile();
  if (!profile) return;
  
  // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
  if (profile.gender) {
    document.getElementById(`gender-${profile.gender}`).checked = true;
  }
  if (profile.age) {
    document.getElementById('age').value = profile.age;
  }
  if (profile.height) {
    document.getElementById('height').value = profile.height;
  }
  if (profile.weight) {
    document.getElementById('weight').value = profile.weight;
  }
  if (profile.activityLevel) {
    document.getElementById(`activity-${profile.activityLevel}`).checked = true;
  }
  
  // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  document.getElementById('profile-display').classList.add('hidden');
  document.getElementById('main-navigation').classList.add('hidden');
  document.getElementById('profile-setup').classList.remove('hidden');
  document.getElementById('hero-cta').classList.add('hidden');
  
  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  document.getElementById('profile-setup').scrollIntoView({ behavior: 'smooth' });
}

// åˆæœŸåŒ–
window.addEventListener('DOMContentLoaded', function() {
  // æœˆåˆ¥ãƒ†ãƒ¼ãƒã®é©ç”¨
  applyMonthTheme();
  
  const profile = loadProfile();
  
  if (profile) {
    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç™»éŒ²æ¸ˆã¿
    document.getElementById('hero-cta').classList.remove('hidden');
    document.getElementById('profile-setup').classList.add('hidden');
    document.getElementById('profile-display').classList.remove('hidden');
    document.getElementById('main-navigation').classList.remove('hidden');
    
    updateProfileDisplay(profile);
  } else {
    // åˆå›è¨ªå•
    document.getElementById('hero-cta').classList.add('hidden');
    document.getElementById('profile-setup').classList.remove('hidden');
    document.getElementById('profile-display').classList.add('hidden');
    document.getElementById('main-navigation').classList.add('hidden');
  }
});
</script>

</body>
</html>
