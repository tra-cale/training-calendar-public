<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ 2025</title>
<style>
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #FFF9C4 0%, #FFECB3 50%, #FFE082 100%);
  min-height: 100vh;
  padding: 20px;
  color: #212121;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

/* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.hero-section {
  text-align: center;
  padding: 60px 20px;
  margin-bottom: 40px;
}

.hero-icon {
  font-size: 80px;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.hero-title {
  font-size: 2.5em;
  font-weight: bold;
  background: linear-gradient(135deg, #F57C00 0%, #FFB300 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 10px;
}

.hero-subtitle {
  font-size: 1.2em;
  color: #616161;
  margin-bottom: 30px;
}

.hero-cta {
  display: inline-block;
  padding: 16px 48px;
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  font-size: 1.2em;
  font-weight: 600;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(245, 124, 0, 0.3);
}

.hero-cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(245, 124, 0, 0.4);
}

/* ã‚«ãƒ¼ãƒ‰å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
.card {
  background: white;
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.card-title {
  font-size: 1.5em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã‚«ãƒ¼ãƒ‰ */
.profile-setup-card {
  background: linear-gradient(145deg, #FFFFFF, #FFFBF5);
}

.setup-header {
  text-align: center;
  margin-bottom: 30px;
}

.setup-title {
  font-size: 1.8em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 10px;
}

.setup-subtitle {
  color: #616161;
  font-size: 1em;
}

.form-group {
  margin-bottom: 24px;
  text-align: center;
}

.form-label {
  display: block;
  font-size: 0.95em;
  font-weight: 600;
  color: #424242;
  margin-bottom: 8px;
  text-align: center;
}

.form-hint {
  font-size: 0.85em;
  color: #9E9E9E;
  margin-top: 4px;
  text-align: center;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  font-size: 1em;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: #FFB300;
  box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.1);
}

.form-input.error {
  border-color: #EF5350;
}

.error-message {
  color: #EF5350;
  font-size: 0.85em;
  margin-top: 4px;
  display: none;
  text-align: center;
}

.error-message.show {
  display: block;
}

/* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
.radio-group {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
}

.radio-group.vertical {
  flex-direction: column;
  align-items: flex-start;
}

.radio-option {
  display: flex;
  align-items: center;
  cursor: pointer;
}

.radio-option input[type="radio"] {
  width: 20px;
  height: 20px;
  margin-right: 8px;
  cursor: pointer;
  accent-color: #F57C00;
}

.radio-option label {
  font-size: 0.95em;
  cursor: pointer;
  user-select: none;
}

/* æ•°å€¤å…¥åŠ›ã‚°ãƒ«ãƒ¼ãƒ— */
.input-with-unit {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  max-width: 200px;
  margin: 0 auto;
}

.input-with-unit .form-input {
  flex: 1;
  text-align: center;
}

.unit {
  font-size: 0.95em;
  color: #616161;
  font-weight: 500;
}

/* ãƒœã‚¿ãƒ³ */
.btn {
  padding: 14px 32px;
  font-size: 1.1em;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  display: inline-block;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(135deg, #F57C00, #FFB300);
  color: white;
  width: 100%;
  box-shadow: 0 4px 12px rgba(245, 124, 0, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(245, 124, 0, 0.4);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.skip-link {
  display: block;
  text-align: center;
  margin-top: 16px;
  color: #9E9E9E;
  text-decoration: none;
  font-size: 0.95em;
  transition: color 0.3s ease;
}

.skip-link:hover {
  color: #616161;
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã‚«ãƒ¼ãƒ‰ */
.profile-display-card {
  background: linear-gradient(145deg, #FFF9C4, #FFFFFF);
  border: 2px solid #FFD54F;
}

.profile-header {
  text-align: center;
  margin-bottom: 24px;
}

.profile-name {
  font-size: 1.5em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 8px;
}

.profile-info-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.profile-info-item {
  display: flex;
  flex-direction: column;
}

.profile-info-label {
  font-size: 0.85em;
  color: #616161;
  margin-bottom: 4px;
}

.profile-info-value {
  font-size: 1.1em;
  font-weight: 600;
  color: #212121;
}

.bmi-low {
  color: #42A5F5;
}

.bmi-normal {
  color: #66BB6A;
}

.bmi-high {
  color: #FFA726;
}

.bmi-very-high {
  color: #EF5350;
}

.btn-edit {
  background: white;
  color: #F57C00;
  border: 2px solid #F57C00;
  width: 100%;
}

.btn-edit:hover {
  background: #F57C00;
  color: white;
}

/* æœˆé–“ç›®æ¨™è¡¨ç¤ºã‚«ãƒ¼ãƒ‰ */
.goal-display-card {
  background: linear-gradient(145deg, #E8F5E9, #FFFFFF);
  border: 2px solid #66BB6A;
}

.goal-display-header {
  text-align: center;
  margin-bottom: 24px;
}

.goal-display-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.goal-display-item {
  display: flex;
  flex-direction: column;
  padding: 12px;
  background: white;
  border-radius: 8px;
  border: 1px solid #E0E0E0;
}

.goal-display-label {
  font-size: 0.85em;
  color: #616161;
  margin-bottom: 4px;
}

.goal-display-value {
  font-size: 1.1em;
  font-weight: 600;
  color: #212121;
}

/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ */
.nav-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  text-decoration: none;
  color: inherit;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.nav-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  border-color: #FFD54F;
}

.nav-card-content {
  display: flex;
  align-items: center;
  gap: 20px;
}

.nav-card-icon {
  font-size: 2.5em;
}

.nav-card-text {
  display: flex;
  flex-direction: column;
}

.nav-card-title {
  font-size: 1.2em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 4px;
}

.nav-card-subtitle {
  font-size: 0.9em;
  color: #616161;
}

.nav-card-arrow {
  font-size: 1.5em;
  color: #FFB300;
  font-weight: bold;
}

/* æœˆé–“ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */
.goal-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
  overflow-y: auto;
}

.goal-modal.active {
  display: flex;
}

.goal-modal-content {
  background: white;
  border-radius: 20px;
  max-width: 800px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.goal-modal-header {
  background: linear-gradient(135deg, #66BB6A, #81C784);
  color: white;
  padding: 24px 30px;
  border-radius: 20px 20px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.goal-modal-header h2 {
  font-size: 1.6em;
  margin: 0;
}

.goal-close-btn {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: white;
  font-size: 2em;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

.goal-close-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(90deg);
}

.goal-modal-body {
  padding: 30px;
}

/* ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒœã‚¿ãƒ³ */
.goal-mode-selector {
  display: flex;
  gap: 12px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.goal-mode-btn {
  flex: 1;
  min-width: 200px;
  padding: 20px;
  background: white;
  border: 3px solid #E0E0E0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.goal-mode-btn:hover {
  border-color: #66BB6A;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 187, 106, 0.2);
}

.goal-mode-btn.active {
  border-color: #66BB6A;
  background: linear-gradient(145deg, #E8F5E9, #FFFFFF);
  box-shadow: 0 4px 12px rgba(102, 187, 106, 0.3);
}

.goal-mode-icon {
  font-size: 2.5em;
  margin-bottom: 10px;
}

.goal-mode-title {
  font-size: 1.1em;
  font-weight: 600;
  color: #212121;
  margin-bottom: 8px;
}

.goal-mode-description {
  font-size: 0.85em;
  color: #616161;
  line-height: 1.4;
}

.goal-mode-badge {
  display: inline-block;
  padding: 4px 12px;
  background: #66BB6A;
  color: white;
  border-radius: 12px;
  font-size: 0.75em;
  font-weight: 600;
  margin-top: 8px;
}

.goal-mode-change {
  margin-top: 12px;
  padding: 8px 12px;
  background: linear-gradient(145deg, #FFF9C4, #FFECB3);
  border-radius: 8px;
  font-size: 0.8em;
  color: #F57C00;
  font-weight: 600;
  line-height: 1.5;
  border: 1px solid #FFD54F;
}

.goal-mode-change .change-item {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  margin: 2px 0;
}

.goal-mode-change .change-value {
  color: #D84315;
  font-weight: 700;
}

/* ç›®æ¨™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.goal-section {
  margin-bottom: 30px;
  padding: 20px;
  background: linear-gradient(145deg, #FAFAFA, #FFFFFF);
  border-radius: 12px;
  border: 2px solid #E0E0E0;
}

.goal-section-title {
  font-size: 1.3em;
  color: #212121;
  margin-bottom: 15px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.goal-current-info {
  background: linear-gradient(145deg, #E3F2FD, #FFFFFF);
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 15px;
  border-left: 4px solid #42A5F5;
}

.goal-current-title {
  font-size: 0.85em;
  color: #1976D2;
  font-weight: 600;
  margin-bottom: 4px;
}

.goal-current-value {
  font-size: 1.2em;
  color: #212121;
  font-weight: 600;
}

.goal-input-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 12px;
}

.goal-input-group {
  display: flex;
  flex-direction: column;
}

.goal-input-group label {
  font-size: 0.9em;
  color: #424242;
  font-weight: 600;
  margin-bottom: 6px;
}

.goal-input-group input {
  padding: 12px;
  border: 2px solid #E0E0E0;
  border-radius: 8px;
  font-size: 1em;
  transition: all 0.3s ease;
}

.goal-input-group input:focus {
  outline: none;
  border-color: #66BB6A;
  box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.1);
}

.goal-error-message {
  color: #EF5350;
  font-size: 0.85em;
  margin-top: 4px;
  display: none;
}

.goal-error-message.show {
  display: block;
}

.goal-hint {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 12px;
  background: #FFF9C4;
  border-radius: 8px;
  border-left: 4px solid #FFB300;
  font-size: 0.85em;
  color: #616161;
  line-height: 1.5;
}

.goal-hint-icon {
  font-size: 1.2em;
  flex-shrink: 0;
}

/* ãƒœã‚¿ãƒ³ */
.goal-buttons {
  display: flex;
  gap: 12px;
  margin-top: 30px;
}

.btn-goal-save {
  flex: 2;
  padding: 16px 32px;
  background: linear-gradient(135deg, #66BB6A, #81C784);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1.1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(102, 187, 106, 0.3);
}

.btn-goal-save:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(102, 187, 106, 0.4);
}

.btn-goal-cancel {
  flex: 1;
  padding: 16px 32px;
  background: white;
  color: #616161;
  border: 2px solid #E0E0E0;
  border-radius: 10px;
  font-size: 1.1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-goal-cancel:hover {
  background: #F5F5F5;
  border-color: #BDBDBD;
}

/* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ */
.hidden {
  display: none;
}

.fade-in {
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
  .hero-title {
    font-size: 2em;
  }

  .hero-subtitle {
    font-size: 1em;
  }

  .profile-info-grid,
  .goal-display-grid {
    grid-template-columns: 1fr;
  }

  .nav-card-content {
    gap: 15px;
  }

  .nav-card-icon {
    font-size: 2em;
  }

  .nav-card-title {
    font-size: 1em;
  }

  .nav-card-subtitle {
    font-size: 0.85em;
  }

  .goal-mode-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .goal-mode-btn {
    min-width: 100%;
  }

  .goal-input-row {
    grid-template-columns: 1fr;
  }

  .goal-buttons {
    flex-direction: column;
  }
}
</style>
</head>
<body>

<div class="container">
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="hero-section">
    <div class="hero-icon">ğŸ</div>
    <h1 class="hero-title">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
    <p class="hero-subtitle">å¥åº·çš„ãªæ¯æ—¥ã‚’ã‚µãƒãƒ¼ãƒˆ</p>
    <a href="calendar.html" class="hero-cta hidden" id="hero-cta">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ã</a>
  </section>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šï¼ˆåˆå›ã®ã¿è¡¨ç¤ºï¼‰ -->
  <div class="card profile-setup-card fade-in" id="profile-setup">
    <div class="setup-header">
      <h2 class="setup-title">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h2>
      <p class="setup-subtitle">ã‚ãªãŸã®åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    </div>

    <form id="profile-form">
      <div class="form-group">
        <label class="form-label">æ€§åˆ¥</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="gender-male" name="gender" value="male">
            <label for="gender-male">ç”·æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="gender-female" name="gender" value="female">
            <label for="gender-female">å¥³æ€§</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="gender-other" name="gender" value="other">
            <label for="gender-other">ãã®ä»–</label>
          </div>
        </div>
        <div class="error-message" id="error-gender"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="age">å¹´é½¢</label>
        <div class="input-with-unit">
          <input type="number" id="age" class="form-input" placeholder="30" min="10" max="120">
          <span class="unit">æ­³</span>
        </div>
        <div class="error-message" id="error-age"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="height">èº«é•·ï¼ˆä»»æ„ï¼‰</label>
        <div class="input-with-unit">
          <input type="number" id="height" class="form-input" placeholder="170" min="100" max="250">
          <span class="unit">cm</span>
        </div>
        <p class="form-hint">BMIè¨ˆç®—ã«ä½¿ç”¨ã•ã‚Œã¾ã™</p>
        <div class="error-message" id="error-height"></div>
      </div>

      <div class="form-group">
        <label class="form-label" for="weight">ä½“é‡</label>
        <div class="input-with-unit">
          <input type="number" id="weight" class="form-input" placeholder="65" min="30" max="200" step="0.1">
          <span class="unit">kg</span>
        </div>
        <div class="error-message" id="error-weight"></div>
      </div>

      <div class="form-group">
        <label class="form-label">æ´»å‹•ãƒ¬ãƒ™ãƒ«</label>
        <div class="radio-group vertical">
          <div class="radio-option">
            <input type="radio" id="activity-sedentary" name="activityLevel" value="sedentary">
            <label for="activity-sedentary">ã»ã¨ã‚“ã©é‹å‹•ã—ãªã„</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="activity-light" name="activityLevel" value="light">
            <label for="activity-light">è»½ã„é‹å‹•ï¼ˆé€±1-2å›ï¼‰</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="activity-moderate" name="activityLevel" value="moderate" checked>
            <label for="activity-moderate">ä¸­ç¨‹åº¦ã®é‹å‹•ï¼ˆé€±3-5å›ï¼‰</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="activity-intense" name="activityLevel" value="intense">
            <label for="activity-intense">æ¿€ã—ã„é‹å‹•ï¼ˆé€±6-7å›ï¼‰</label>
          </div>
        </div>
      </div>

      <button type="submit" class="btn btn-primary">âœ… å®Œäº†ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸</button>
      <a href="calendar.html" class="skip-link">ã‚¹ã‚­ãƒƒãƒ— â†’</a>
    </form>
  </div>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <div class="card profile-display-card fade-in hidden" id="profile-display">
    <div class="profile-header">
      <div class="card-title">ğŸ‘¤ ã‚ãªãŸã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
      <div class="profile-name" id="profile-name">30æ­³ãƒ»ç”·æ€§</div>
    </div>

    <div class="profile-info-grid">
      <div class="profile-info-item">
        <span class="profile-info-label">èº«é•·</span>
        <span class="profile-info-value" id="display-height">170 cm</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">ä½“é‡</span>
        <span class="profile-info-value" id="display-weight">65 kg</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">æ´»å‹•ãƒ¬ãƒ™ãƒ«</span>
        <span class="profile-info-value" id="display-activity">ä¸­ç¨‹åº¦ã®é‹å‹•</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">æ€§åˆ¥</span>
        <span class="profile-info-value" id="display-gender">ç”·æ€§</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">BMI</span>
        <span class="profile-info-value" id="display-bmi">22.5 (æ¨™æº–)</span>
      </div>

      <div class="profile-info-item">
        <span class="profile-info-label">åŸºç¤ä»£è¬</span>
        <span class="profile-info-value" id="display-bmr">ç´„1,650 kcal/æ—¥</span>
      </div>
    </div>

    <button class="btn btn-edit" onclick="editProfile()">âœï¸ ç·¨é›†</button>
  </div>

  <!-- æœˆé–“ç›®æ¨™ã‚«ãƒ¼ãƒ‰ï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <div class="card goal-display-card fade-in hidden" id="goal-display">
    <div class="goal-display-header">
      <div class="card-title">ğŸ¯ ä»Šæœˆã®ç›®æ¨™</div>
    </div>

    <div class="goal-display-grid" id="goal-display-content">
      <div class="goal-display-item">
        <span class="goal-display-label">è¡€åœ§ç›®æ¨™</span>
        <span class="goal-display-value" id="display-goal-bp">120/80 mmHg</span>
      </div>

      <div class="goal-display-item">
        <span class="goal-display-label">ä½“é‡ç›®æ¨™</span>
        <span class="goal-display-value" id="display-goal-weight">65.0 kg</span>
      </div>

      <div class="goal-display-item">
        <span class="goal-display-label">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°</span>
        <span class="goal-display-value" id="display-goal-days">12 æ—¥</span>
      </div>

      <div class="goal-display-item">
        <span class="goal-display-label">ç·é‹å‹•æ™‚é–“</span>
        <span class="goal-display-value" id="display-goal-time">600 åˆ†</span>
      </div>

      <div class="goal-display-item">
        <span class="goal-display-label">ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</span>
        <span class="goal-display-value" id="display-goal-calories">3,000 kcal</span>
      </div>
    </div>

    <button class="btn btn-edit" onclick="openGoalModal()">âœï¸ ç·¨é›†</button>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰ -->
  <section class="fade-in hidden" id="main-navigation">
    <a href="calendar.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“…</div>
        <div class="nav-card-text">
          <div class="nav-card-title">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ã</div>
          <div class="nav-card-subtitle">æœˆåˆ¥ã®è¨˜éŒ²ã‚’ç¢ºèªãƒ»å…¥åŠ›</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="yearly-summary.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“Š</div>
        <div class="nav-card-text">
          <div class="nav-card-title">å¹´é–“ã‚µãƒãƒªãƒ¼ã‚’è¦‹ã‚‹</div>
          <div class="nav-card-subtitle">1å¹´é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="features.html" class="nav-card">
      <div class="nav-card-content">
        <div class="nav-card-icon">ğŸ“–</div>
        <div class="nav-card-text">
          <div class="nav-card-title">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</div>
          <div class="nav-card-subtitle">æ©Ÿèƒ½ã®è©³ã—ã„èª¬æ˜</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>

    <a href="#settings" class="nav-card" onclick="alert('è¨­å®šç”»é¢ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™'); return false;">
      <div class="nav-card-content">
        <div class="nav-card-icon">âš™ï¸</div>
        <div class="nav-card-text">
          <div class="nav-card-title">è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
          <div class="nav-card-subtitle">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ç›®æ¨™è¨­å®š</div>
        </div>
      </div>
      <div class="nav-card-arrow">â†’</div>
    </a>
  </section>
</div>

<!-- æœˆé–“ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="goal-modal" id="goalModal">
  <div class="goal-modal-content">
    <div class="goal-modal-header">
      <h2>ğŸ¯ æœˆé–“ç›®æ¨™è¨­å®š</h2>
      <button class="goal-close-btn" onclick="closeGoalModal()">&times;</button>
    </div>
    <div class="goal-modal-body">
      
      <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
      <div class="goal-mode-selector">
        <button type="button" class="goal-mode-btn" data-mode="maintain" onclick="selectGoalMode('maintain')">
          <div class="goal-mode-icon">ğŸŸ¢</div>
          <div class="goal-mode-title">ç¾çŠ¶ç¶­æŒ</div>
          <div class="goal-mode-description">ä»Šã®ãƒšãƒ¼ã‚¹ã‚’ç¶™ç¶š</div>
          <div class="goal-mode-change" id="change-maintain" style="display: none;"></div>
        </button>
        <button type="button" class="goal-mode-btn active" data-mode="light" onclick="selectGoalMode('light')">
          <div class="goal-mode-icon">ğŸŸ¡</div>
          <div class="goal-mode-title">è»½ã„æ”¹å–„</div>
          <div class="goal-mode-description">ç„¡ç†ãªãå°‘ã—ãšã¤</div>
          <span class="goal-mode-badge">æ¨å¥¨</span>
          <div class="goal-mode-change" id="change-light"></div>
        </button>
        <button type="button" class="goal-mode-btn" data-mode="aggressive" onclick="selectGoalMode('aggressive')">
          <div class="goal-mode-icon">ğŸ”´</div>
          <div class="goal-mode-title">ç©æ¥µçš„æ”¹å–„</div>
          <div class="goal-mode-description">ç›®æ¨™é”æˆã‚’é‡è¦–</div>
          <div class="goal-mode-change" id="change-aggressive"></div>
        </button>
        <button type="button" class="goal-mode-btn" data-mode="custom" onclick="selectGoalMode('custom')">
          <div class="goal-mode-icon">âœï¸</div>
          <div class="goal-mode-title">ã‚«ã‚¹ã‚¿ãƒ </div>
          <div class="goal-mode-description">è‡ªç”±ã«å…¥åŠ›</div>
          <div class="goal-mode-change" id="change-custom" style="display: none;"></div>
        </button>
      </div>
      
      <!-- è¡€åœ§ç›®æ¨™ -->
      <div class="goal-section">
        <h3 class="goal-section-title">ğŸ’‰ è¡€åœ§ç›®æ¨™</h3>
        <div class="goal-current-info" id="current-bp-info" style="display: none;">
          <div class="goal-current-title">ğŸ“Š ç¾åœ¨ã®å¹³å‡è¡€åœ§</div>
          <div class="goal-current-value" id="current-bp-value">--/-- mmHg</div>
        </div>
        <div class="goal-input-row">
          <div class="goal-input-group">
            <label>åç¸®æœŸè¡€åœ§ï¼ˆæœ€é«˜ï¼‰</label>
            <input type="number" id="goal-systolic" min="100" max="139" placeholder="120">
            <div class="goal-error-message" id="error-systolic"></div>
          </div>
          <div class="goal-input-group">
            <label>æ‹¡å¼µæœŸè¡€åœ§ï¼ˆæœ€ä½ï¼‰</label>
            <input type="number" id="goal-diastolic" min="70" max="89" placeholder="80">
            <div class="goal-error-message" id="error-diastolic"></div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span>å¥åº·ç®¡ç†ã®ãŸã‚ã€100-139 / 70-89 mmHgã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„</span>
        </div>
      </div>

      <!-- ä½“é‡ç›®æ¨™ -->
      <div class="goal-section">
        <h3 class="goal-section-title">âš–ï¸ ä½“é‡ç›®æ¨™</h3>
        <div class="goal-current-info" id="current-weight-info" style="display: none;">
          <div class="goal-current-title">ğŸ“Š ç¾åœ¨ã®å¹³å‡ä½“é‡</div>
          <div class="goal-current-value" id="current-weight-value">-- kg (BMI: --)</div>
        </div>
        <div class="goal-input-row">
          <div class="goal-input-group">
            <label>ç›®æ¨™ä½“é‡ï¼ˆkgï¼‰</label>
            <input type="number" id="goal-weight" step="0.1" placeholder="65.0">
            <div class="goal-error-message" id="error-goal-weight"></div>
          </div>
          <div class="goal-input-group">
            <label>ç›®æ¨™BMI</label>
            <input type="text" id="goal-bmi" readonly style="background: #F5F5F5; cursor: default; text-align: center; border: 2px solid #E0E0E0; padding: 12px; border-radius: 8px; font-size: 1em; font-weight: 600;">
            <div class="goal-bmi-status" id="goal-bmi-status" style="margin-top: 8px; text-align: center; font-size: 0.9em; font-weight: 600;"></div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span id="weight-hint">å¥åº·ç®¡ç†ã®ãŸã‚ã€<strong>BMI 18.5-25ï¼ˆæ¨™æº–ä½“é‡ï¼‰</strong>ã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚ä½ä½“é‡ï¼ˆ18.5æœªæº€ï¼‰ãƒ»è‚¥æº€ï¼ˆ30ä»¥ä¸Šï¼‰ã¯è¨­å®šã§ãã¾ã›ã‚“ã€‚</span>
        </div>
      </div>

      <!-- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç›®æ¨™ -->
      <div class="goal-section">
        <h3 class="goal-section-title">ğŸƒ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç›®æ¨™</h3>
        <div class="goal-current-info" id="current-training-info" style="display: none;">
          <div class="goal-current-title">ğŸ“Š ä»Šæœˆã®å®Ÿç¸¾</div>
          <div class="goal-current-value" id="current-training-value">
            -- æ—¥ / -- åˆ† / -- kcal
          </div>
        </div>
        <div class="goal-input-row">
          <div class="goal-input-group">
            <label>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ï¼ˆæ—¥ï¼‰</label>
            <input type="number" id="goal-days" min="1" max="25" placeholder="12">
            <div class="goal-error-message" id="error-days"></div>
          </div>
          <div class="goal-input-group">
            <label>ç·é‹å‹•æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
            <input type="number" id="goal-time" min="30" max="3000" placeholder="600">
            <div class="goal-error-message" id="error-time"></div>
          </div>
          <div class="goal-input-group">
            <label>ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ï¼ˆkcalï¼‰</label>
            <input type="number" id="goal-calories" min="100" max="15000" placeholder="3000">
            <div class="goal-error-message" id="error-calories"></div>
          </div>
        </div>
        <div class="goal-hint">
          <span class="goal-hint-icon">ğŸ’¡</span>
          <span><strong>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ã¯1-25æ—¥</strong>ã®ç¯„å›²ã§è¨­å®šã§ãã¾ã™ã€‚é€±6æ—¥ãƒšãƒ¼ã‚¹ï¼ˆæœˆ25æ—¥ï¼‰ãŒå¥åº·çš„ãªä¸Šé™ã§ã™ã€‚ä¼‘æ¯æ—¥ã‚‚ä½“ã®æˆé•·ã«å¿…è¦ã§ã™ã€‚</span>
        </div>
      </div>

      <!-- ãƒœã‚¿ãƒ³ -->
      <div class="goal-buttons">
        <button class="btn-goal-save" onclick="saveGoals()">ğŸ’¾ ç›®æ¨™ã‚’ä¿å­˜</button>
        <button class="btn-goal-cancel" onclick="closeGoalModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>
</div>

<script>
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼
const PROFILE_KEY = 'user_profile';
// æœˆé–“ç›®æ¨™ã®ã‚­ãƒ¼ï¼ˆæœˆåˆ¥ã«ä¿å­˜ï¼‰
function getGoalsKey() {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  return `monthly_goals_${year}_${month}`;
}

// æœˆåˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²è¨­å®š
const monthThemes = {
  0: { icon: 'â„ï¸', bg: 'linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%)' },
  1: { icon: 'ğŸ’—', bg: 'linear-gradient(135deg, #FCE4EC 0%, #F8BBD0 50%, #F48FB1 100%)' },
  2: { icon: 'ğŸŒ¸', bg: 'linear-gradient(135deg, #F1F8E9 0%, #DCEDC8 50%, #C5E1A5 100%)' },
  3: { icon: 'ğŸŒ·', bg: 'linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 50%, #FFCC80 100%)' },
  4: { icon: 'ğŸŒ¿', bg: 'linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 50%, #A5D6A7 100%)' },
  5: { icon: 'ğŸŒˆ', bg: 'linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 50%, #CE93D8 100%)' },
  6: { icon: 'ğŸŒŠ', bg: 'linear-gradient(135deg, #E1F5FE 0%, #B3E5FC 50%, #81D4FA 100%)' },
  7: { icon: 'ğŸŒ»', bg: 'linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 50%, #EF9A9A 100%)' },
  8: { icon: 'ğŸ‚', bg: 'linear-gradient(135deg, #E0F2F1 0%, #B2DFDB 50%, #80CBC4 100%)' },
  9: { icon: 'ğŸ', bg: 'linear-gradient(135deg, #FFF9C4 0%, #FFECB3 50%, #FFE082 100%)' },
  10: { icon: 'ğŸ„', bg: 'linear-gradient(135deg, #EFEBE9 0%, #D7CCC8 50%, #BCAAA4 100%)' },
  11: { icon: 'â›„', bg: 'linear-gradient(135deg, #ECEFF1 0%, #CFD8DC 50%, #B0BEC5 100%)' }
};

// ç¾åœ¨ã®æœˆã‚’å–å¾—
function getCurrentMonth() {
  return new Date().getMonth();
}

// æœˆåˆ¥ãƒ†ãƒ¼ãƒã®é©ç”¨
function applyMonthTheme() {
  const currentMonth = getCurrentMonth();
  const theme = monthThemes[currentMonth];
  document.body.style.background = theme.bg;
  document.querySelector('.hero-icon').textContent = theme.icon;
}

// æ´»å‹•ãƒ¬ãƒ™ãƒ«ã®è¡¨ç¤ºå
const activityLabels = {
  sedentary: 'ã»ã¨ã‚“ã©é‹å‹•ã—ãªã„',
  light: 'è»½ã„é‹å‹•ï¼ˆé€±1-2å›ï¼‰',
  moderate: 'ä¸­ç¨‹åº¦ã®é‹å‹•ï¼ˆé€±3-5å›ï¼‰',
  intense: 'æ¿€ã—ã„é‹å‹•ï¼ˆé€±6-7å›ï¼‰'
};

// æ€§åˆ¥ã®è¡¨ç¤ºå
const genderLabels = {
  male: 'ç”·æ€§',
  female: 'å¥³æ€§',
  other: 'ãã®ä»–'
};

// BMIè¨ˆç®—
function calculateBMI(weight, height) {
  if (!height || height === 0) return null;
  const heightM = height / 100;
  return (weight / (heightM * heightM)).toFixed(1);
}

// BMIåˆ¤å®š
function getBMIStatus(bmi) {
  if (!bmi) return { class: '', text: '' };
  if (bmi < 18.5) return { class: 'bmi-low', text: 'ä½ä½“é‡' };
  if (bmi < 25) return { class: 'bmi-normal', text: 'æ¨™æº–' };
  if (bmi < 30) return { class: 'bmi-high', text: 'è‚¥æº€ï¼ˆ1åº¦ï¼‰' };
  return { class: 'bmi-very-high', text: 'è‚¥æº€ï¼ˆ2åº¦ä»¥ä¸Šï¼‰' };
}

// åŸºç¤ä»£è¬è¨ˆç®—
function calculateBMR(gender, weight, height, age) {
  if (!weight || !age) return null;
  if (gender === 'male') {
    if (!height) {
      return Math.round(66.47 + (13.75 * weight) - (6.76 * age));
    }
    return Math.round(66.47 + (13.75 * weight) + (5.00 * height) - (6.76 * age));
  } else if (gender === 'female') {
    if (!height) {
      return Math.round(655.10 + (9.56 * weight) - (4.68 * age));
    }
    return Math.round(655.10 + (9.56 * weight) + (1.85 * height) - (4.68 * age));
  } else {
    if (!height) {
      const male = 66.47 + (13.75 * weight) - (6.76 * age);
      const female = 655.10 + (9.56 * weight) - (4.68 * age);
      return Math.round((male + female) / 2);
    }
    const male = 66.47 + (13.75 * weight) + (5.00 * height) - (6.76 * age);
    const female = 655.10 + (9.56 * weight) + (1.85 * height) - (4.68 * age);
    return Math.round((male + female) / 2);
  }
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
function loadProfile() {
  const profileStr = localStorage.getItem(PROFILE_KEY);
  if (profileStr) {
    return JSON.parse(profileStr);
  }
  return null;
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
function saveProfile(profile) {
  profile.updatedAt = new Date().toISOString();
  if (!profile.createdAt) {
    profile.createdAt = profile.updatedAt;
  }
  localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºã®æ›´æ–°
function updateProfileDisplay(profile) {
  const genderText = genderLabels[profile.gender] || '---';
  document.getElementById('profile-name').textContent = 
    `${profile.age}æ­³ãƒ»${genderText}`;
  document.getElementById('display-height').textContent = 
    profile.height ? `${profile.height} cm` : 'æœªå…¥åŠ›';
  document.getElementById('display-weight').textContent = 
    profile.weight ? `${profile.weight} kg` : '---';
  document.getElementById('display-activity').textContent = 
    activityLabels[profile.activityLevel] || 'æœªè¨­å®š';
  document.getElementById('display-gender').textContent = genderText;
  
  const bmi = calculateBMI(profile.weight, profile.height);
  const bmiDisplay = document.getElementById('display-bmi');
  if (bmi) {
    const status = getBMIStatus(parseFloat(bmi));
    bmiDisplay.innerHTML = `<span class="${status.class}">${bmi}</span> <span style="font-size: 0.8em;">(${status.text})</span>`;
  } else {
    bmiDisplay.innerHTML = '<span style="color: #9E9E9E;">èº«é•·ã‚’å…¥åŠ›ã™ã‚‹ã¨<br>è¨ˆç®—ã•ã‚Œã¾ã™</span>';
  }
  
  const bmr = calculateBMR(profile.gender, profile.weight, profile.height, profile.age);
  const bmrDisplay = document.getElementById('display-bmr');
  if (bmr) {
    bmrDisplay.textContent = `ç´„${bmr.toLocaleString()} kcal/æ—¥`;
  } else {
    bmrDisplay.textContent = '---';
  }
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateProfile(profile) {
  const errors = [];
  if (!profile.gender) {
    errors.push({ field: 'gender', message: 'æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„' });
  }
  if (!profile.age || profile.age < 10 || profile.age > 120) {
    errors.push({ field: 'age', message: '10æ­³ã‹ã‚‰120æ­³ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  if (!profile.weight || profile.weight < 30 || profile.weight > 200) {
    errors.push({ field: 'weight', message: '30kgã‹ã‚‰200kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  if (profile.height && (profile.height < 100 || profile.height > 250)) {
    errors.push({ field: 'height', message: '100cmã‹ã‚‰250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„' });
  }
  return errors;
}

// ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
function showErrors(errors) {
  document.querySelectorAll('.error-message').forEach(el => {
    el.classList.remove('show');
  });
  document.querySelectorAll('.form-input').forEach(el => {
    el.classList.remove('error');
  });
  errors.forEach(error => {
    const errorEl = document.getElementById(`error-${error.field}`);
    const inputEl = document.getElementById(error.field);
    if (errorEl) {
      errorEl.classList.add('show');
      errorEl.textContent = error.message;
    }
    if (inputEl) {
      inputEl.classList.add('error');
    }
  });
}

// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
document.getElementById('profile-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const profile = {
    gender: document.querySelector('input[name="gender"]:checked')?.value,
    age: parseInt(document.getElementById('age').value) || null,
    height: parseInt(document.getElementById('height').value) || null,
    weight: parseFloat(document.getElementById('weight').value) || null,
    activityLevel: document.querySelector('input[name="activityLevel"]:checked')?.value || 'moderate'
  };
  const errors = validateProfile(profile);
  if (errors.length > 0) {
    showErrors(errors);
    return;
  }
  saveProfile(profile);
  window.location.href = 'calendar.html';
});

// ç·¨é›†ãƒœã‚¿ãƒ³
function editProfile() {
  const profile = loadProfile();
  if (!profile) return;
  if (profile.gender) {
    document.getElementById(`gender-${profile.gender}`).checked = true;
  }
  if (profile.age) {
    document.getElementById('age').value = profile.age;
  }
  if (profile.height) {
    document.getElementById('height').value = profile.height;
  }
  if (profile.weight) {
    document.getElementById('weight').value = profile.weight;
  }
  if (profile.activityLevel) {
    document.getElementById(`activity-${profile.activityLevel}`).checked = true;
  }
  document.getElementById('profile-display').classList.add('hidden');
  document.getElementById('goal-display').classList.add('hidden');
  document.getElementById('main-navigation').classList.add('hidden');
  document.getElementById('profile-setup').classList.remove('hidden');
  document.getElementById('hero-cta').classList.add('hidden');
  document.getElementById('profile-setup').scrollIntoView({ behavior: 'smooth' });
}

// æœˆé–“ç›®æ¨™ã®èª­ã¿è¾¼ã¿
function loadGoals() {
  const goalsStr = localStorage.getItem(getGoalsKey());
  if (goalsStr) {
    return JSON.parse(goalsStr);
  }
  return null;
}

// æœˆé–“ç›®æ¨™ã®ä¿å­˜
function saveGoalsData(goals) {
  goals.updatedAt = new Date().toISOString();
  if (!goals.createdAt) {
    goals.createdAt = goals.updatedAt;
  }
  
  // å¹´æœˆæƒ…å ±ã‚‚ä¿å­˜
  const now = new Date();
  goals.year = now.getFullYear();
  goals.month = now.getMonth() + 1; // 1-12
  
  localStorage.setItem(getGoalsKey(), JSON.stringify(goals));
}

// ç›®æ¨™è¡¨ç¤ºã®æ›´æ–°
function updateGoalDisplay() {
  const goals = loadGoals();
  if (goals) {
    if (goals.bloodPressure) {
      document.getElementById('display-goal-bp').textContent = 
        `${goals.bloodPressure.systolic}/${goals.bloodPressure.diastolic} mmHg`;
    } else {
      document.getElementById('display-goal-bp').textContent = '120/80 mmHg';
    }
    if (goals.weight) {
      document.getElementById('display-goal-weight').textContent = `${goals.weight} kg`;
    } else {
      document.getElementById('display-goal-weight').textContent = 'æœªè¨­å®š';
    }
    if (goals.trainingDays) {
      document.getElementById('display-goal-days').textContent = `${goals.trainingDays} æ—¥`;
    } else {
      document.getElementById('display-goal-days').textContent = 'æœªè¨­å®š';
    }
    if (goals.totalTime) {
      document.getElementById('display-goal-time').textContent = `${goals.totalTime} åˆ†`;
    } else {
      document.getElementById('display-goal-time').textContent = 'æœªè¨­å®š';
    }
    if (goals.totalCalories) {
      document.getElementById('display-goal-calories').textContent = 
        `${goals.totalCalories.toLocaleString()} kcal`;
    } else {
      document.getElementById('display-goal-calories').textContent = 'æœªè¨­å®š';
    }
  } else {
    document.getElementById('display-goal-bp').textContent = '120/80 mmHg';
    const profile = loadProfile();
    if (profile && profile.height) {
      const targetBMI = 22;
      const heightM = profile.height / 100;
      const targetWeight = (targetBMI * heightM * heightM).toFixed(1);
      document.getElementById('display-goal-weight').textContent = `${targetWeight} kg`;
    } else {
      document.getElementById('display-goal-weight').textContent = '65.0 kg';
    }
    document.getElementById('display-goal-days').textContent = '12 æ—¥';
    document.getElementById('display-goal-time').textContent = '600 åˆ†';
    document.getElementById('display-goal-calories').textContent = '3,000 kcal';
  }
}

// ç›®æ¨™ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
function openGoalModal() {
  document.getElementById('goalModal').classList.add('active');
  loadGoalsToModal();
}

// ç›®æ¨™ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeGoalModal() {
  document.getElementById('goalModal').classList.remove('active');
}

// ç›®æ¨™ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ
let currentGoalMode = 'light';
let previousGoalData = null; // å‰å›ã®ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ

function selectGoalMode(mode) {
  currentGoalMode = mode;
  document.querySelectorAll('.goal-mode-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
  
  if (mode === 'custom') {
    // ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰ã§ã¯å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ‰åŠ¹åŒ–
    enableCustomInput();
  } else {
    // è‡ªå‹•è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ã§ã¯å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç„¡åŠ¹åŒ–
    disableCustomInput();
    calculateGoalsFromMode(mode);
  }
}

// ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚’æœ‰åŠ¹åŒ–
function enableCustomInput() {
  const inputs = [
    'goal-systolic', 'goal-diastolic', 'goal-weight',
    'goal-days', 'goal-time', 'goal-calories'
  ];
  inputs.forEach(id => {
    const input = document.getElementById(id);
    input.removeAttribute('readonly');
    input.style.background = 'white';
    input.style.cursor = 'text';
  });
}

// ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚’ç„¡åŠ¹åŒ–
function disableCustomInput() {
  const inputs = [
    'goal-systolic', 'goal-diastolic', 'goal-weight',
    'goal-days', 'goal-time', 'goal-calories'
  ];
  inputs.forEach(id => {
    const input = document.getElementById(id);
    input.setAttribute('readonly', 'readonly');
    input.style.background = '#F5F5F5';
    input.style.cursor = 'default';
  });
}

// ãƒ¢ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ç›®æ¨™ã‚’è¨ˆç®—
function calculateGoalsFromMode(mode) {
  const profile = loadProfile();
  if (!profile) return;
  
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆå‰å›ç›®æ¨™ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  const currentGoals = loadGoals();
  let baseSystolic = currentGoals?.bloodPressure?.systolic || 120;
  let baseDiastolic = currentGoals?.bloodPressure?.diastolic || 80;
  let baseWeight = currentGoals?.weight || (profile.height ? (22 * Math.pow(profile.height / 100, 2)).toFixed(1) : 65);
  let baseDays = currentGoals?.trainingDays || 12;
  let baseTime = currentGoals?.totalTime || 600;
  let baseCalories = currentGoals?.totalCalories || 3000;
  
  // å‰å›ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆå¤‰åŒ–é‡è¨ˆç®—ç”¨ï¼‰
  previousGoalData = {
    systolic: baseSystolic,
    diastolic: baseDiastolic,
    weight: parseFloat(baseWeight),
    days: baseDays,
    time: baseTime,
    calories: baseCalories
  };
  
  let newSystolic, newDiastolic, newWeight, newDays, newTime, newCalories;
  let changes = {}; // å¤‰åŒ–é‡ã‚’è¨˜éŒ²
  
  switch(mode) {
    case 'maintain':
      // ç¾çŠ¶ç¶­æŒ: ãã®ã¾ã¾
      newSystolic = baseSystolic;
      newDiastolic = baseDiastolic;
      newWeight = baseWeight;
      newDays = baseDays;
      newTime = baseTime;
      newCalories = baseCalories;
      changes = {
        systolic: 0,
        diastolic: 0,
        weight: 0,
        days: 0,
        time: 0,
        calories: 0
      };
      break;
      
    case 'light':
      // è»½ã„æ”¹å–„
      newSystolic = Math.max(Math.round(baseSystolic - 2.5), 110);
      newDiastolic = Math.max(Math.round(baseDiastolic - 1.5), 70);
      newWeight = (parseFloat(baseWeight) * 0.99).toFixed(1);
      newDays = Math.min(baseDays + 1, 25);
      newTime = Math.ceil(baseTime * 1.075);
      newCalories = Math.ceil(baseCalories * 1.075);
      
      changes = {
        systolic: newSystolic - baseSystolic,
        diastolic: newDiastolic - baseDiastolic,
        weight: (parseFloat(newWeight) - parseFloat(baseWeight)).toFixed(1),
        days: newDays - baseDays,
        time: newTime - baseTime,
        calories: newCalories - baseCalories
      };
      break;
      
    case 'aggressive':
      // ç©æ¥µçš„æ”¹å–„
      newSystolic = Math.max(Math.round(baseSystolic - 5), 110);
      newDiastolic = Math.max(Math.round(baseDiastolic - 3), 70);
      newWeight = (parseFloat(baseWeight) * 0.98).toFixed(1);
      newDays = Math.min(baseDays + 3, 25);
      newTime = Math.ceil(baseTime * 1.175);
      newCalories = Math.ceil(baseCalories * 1.175);
      
      changes = {
        systolic: newSystolic - baseSystolic,
        diastolic: newDiastolic - baseDiastolic,
        weight: (parseFloat(newWeight) - parseFloat(baseWeight)).toFixed(1),
        days: newDays - baseDays,
        time: newTime - baseTime,
        calories: newCalories - baseCalories
      };
      break;
  }
  
  // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
  document.getElementById('goal-systolic').value = newSystolic;
  document.getElementById('goal-diastolic').value = newDiastolic;
  document.getElementById('goal-weight').value = newWeight;
  document.getElementById('goal-days').value = newDays;
  document.getElementById('goal-time').value = newTime;
  document.getElementById('goal-calories').value = newCalories;
  
  // BMIã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
  updateGoalBMI();
  
  // å¤‰åŒ–é‡ã‚’è¡¨ç¤º
  displayChanges(mode, changes);
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ç›®æ¨™ã‚’èª­ã¿è¾¼ã¿
// BMIã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
function updateGoalBMI() {
  const weight = parseFloat(document.getElementById('goal-weight').value);
  const profile = loadProfile();
  
  if (!weight || !profile || !profile.height) {
    document.getElementById('goal-bmi').value = 'èº«é•·ãŒæœªè¨­å®š';
    document.getElementById('goal-bmi-status').textContent = '';
    return;
  }
  
  const bmi = calculateBMI(weight, profile.height);
  document.getElementById('goal-bmi').value = bmi;
  
  // BMIã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ç¤º
  const statusEl = document.getElementById('goal-bmi-status');
  if (bmi < 18.5) {
    statusEl.textContent = 'âš ï¸ ä½ä½“é‡';
    statusEl.style.color = '#1976D2';
  } else if (bmi < 25) {
    statusEl.textContent = 'âœ… æ¨™æº–ä½“é‡';
    statusEl.style.color = '#388E3C';
  } else if (bmi < 30) {
    statusEl.textContent = 'âš ï¸ è‚¥æº€ï¼ˆ1åº¦ï¼‰';
    statusEl.style.color = '#F57C00';
  } else {
    statusEl.textContent = 'âš ï¸ è‚¥æº€ï¼ˆ2åº¦ä»¥ä¸Šï¼‰';
    statusEl.style.color = '#D32F2F';
  }
}

// ä½“é‡å…¥åŠ›æ™‚ã«BMIã‚’æ›´æ–°
document.addEventListener('DOMContentLoaded', function() {
  const weightInput = document.getElementById('goal-weight');
  if (weightInput) {
    weightInput.addEventListener('input', updateGoalBMI);
  }
});

// å¤‰åŒ–é‡ã‚’è¡¨ç¤º
function displayChanges(mode, changes) {
  const changeElement = document.getElementById(`change-${mode}`);
  if (!changeElement) return;
  
  if (mode === 'maintain' || mode === 'custom') {
    changeElement.style.display = 'none';
    return;
  }
  
  changeElement.style.display = 'block';
  
  const formatChange = (value, unit) => {
    if (value === 0) return 'Â±0';
    const sign = value > 0 ? '+' : '';
    return `${sign}${value}${unit}`;
  };
  
  let html = '<div style="font-size: 0.75em; line-height: 1.8;">';
  
  // è¡€åœ§ã®å¤‰åŒ–
  if (changes.systolic !== 0 || changes.diastolic !== 0) {
    html += `<div class="change-item">è¡€åœ§: ${formatChange(changes.systolic, '')}/${formatChange(changes.diastolic, '')} mmHg</div>`;
  }
  
  // ä½“é‡ã®å¤‰åŒ–
  if (parseFloat(changes.weight) !== 0) {
    html += `<div class="change-item">ä½“é‡: ${formatChange(parseFloat(changes.weight), ' kg')}</div>`;
  }
  
  // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ã®å¤‰åŒ–
  if (changes.days !== 0) {
    html += `<div class="change-item">æ—¥æ•°: ${formatChange(changes.days, 'æ—¥')}</div>`;
  }
  
  // ç·é‹å‹•æ™‚é–“ã®å¤‰åŒ–
  if (changes.time !== 0) {
    html += `<div class="change-item">æ™‚é–“: ${formatChange(changes.time, 'åˆ†')}</div>`;
  }
  
  // ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ã®å¤‰åŒ–
  if (changes.calories !== 0) {
    html += `<div class="change-item">ã‚«ãƒ­ãƒªãƒ¼: ${formatChange(changes.calories, ' kcal')}</div>`;
  }
  
  html += '</div>';
  changeElement.innerHTML = html;
}

function loadGoalsToModal() {
  const goals = loadGoals();
  if (goals) {
    if (goals.bloodPressure) {
      document.getElementById('goal-systolic').value = goals.bloodPressure.systolic;
      document.getElementById('goal-diastolic').value = goals.bloodPressure.diastolic;
    }
    if (goals.weight) {
      document.getElementById('goal-weight').value = goals.weight;
    }
    if (goals.trainingDays) {
      document.getElementById('goal-days').value = goals.trainingDays;
    }
    if (goals.totalTime) {
      document.getElementById('goal-time').value = goals.totalTime;
    }
    if (goals.totalCalories) {
      document.getElementById('goal-calories').value = goals.totalCalories;
    }
    
    // ä¿å­˜ã•ã‚ŒãŸãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Œã°é¸æŠ
    if (goals.mode) {
      selectGoalMode(goals.mode);
    } else {
      selectGoalMode('light');
    }
    
    // BMIã‚’æ›´æ–°
    updateGoalBMI();
  } else {
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
    selectGoalMode('light');
  }
}

// ç›®æ¨™ã‚’ä¿å­˜
function saveGoals() {
  const systolic = parseInt(document.getElementById('goal-systolic').value);
  const diastolic = parseInt(document.getElementById('goal-diastolic').value);
  const weight = parseFloat(document.getElementById('goal-weight').value);
  const days = parseInt(document.getElementById('goal-days').value);
  const time = parseInt(document.getElementById('goal-time').value);
  const calories = parseInt(document.getElementById('goal-calories').value);
  
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const errors = [];
  
  if (!systolic || systolic < 100 || systolic > 139) {
    errors.push('åç¸®æœŸè¡€åœ§ã¯100-139ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
  }
  if (!diastolic || diastolic < 70 || diastolic > 89) {
    errors.push('æ‹¡å¼µæœŸè¡€åœ§ã¯70-89ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
  }
  
  const profile = loadProfile();
  if (profile && profile.height) {
    const bmi = calculateBMI(weight, profile.height);
    if (bmi < 18.5 || bmi > 25) {
      errors.push('ä½“é‡ã¯BMI 18.5-25ï¼ˆæ¨™æº–ä½“é‡ï¼‰ã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„');
    }
  }
  
  if (!days || days < 1 || days > 25) {
    errors.push('ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°ã¯1-25æ—¥ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆé€±6æ—¥ãƒšãƒ¼ã‚¹ãŒä¸Šé™ï¼‰');
  }
  if (!time || time < 30 || time > 3000) {
    errors.push('ç·é‹å‹•æ™‚é–“ã¯30-3000åˆ†ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
  }
  if (!calories || calories < 100 || calories > 15000) {
    errors.push('ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ã¯100-15000kcalã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
  }
  
  if (errors.length > 0) {
    alert('å…¥åŠ›ã‚¨ãƒ©ãƒ¼:\n\n' + errors.join('\n'));
    return;
  }
  
  // ä¿å­˜
  const goals = {
    mode: currentGoalMode,
    bloodPressure: {
      systolic: systolic,
      diastolic: diastolic
    },
    weight: weight,
    trainingDays: days,
    totalTime: time,
    totalCalories: calories
  };
  
  saveGoalsData(goals);
  updateGoalDisplay();
  closeGoalModal();
  alert('âœ… ç›®æ¨™ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
}

// åˆæœŸåŒ–
window.addEventListener('DOMContentLoaded', function() {
  applyMonthTheme();
  const profile = loadProfile();
  if (profile) {
    document.getElementById('hero-cta').classList.remove('hidden');
    document.getElementById('profile-setup').classList.add('hidden');
    document.getElementById('profile-display').classList.remove('hidden');
    document.getElementById('goal-display').classList.remove('hidden');
    document.getElementById('main-navigation').classList.remove('hidden');
    updateProfileDisplay(profile);
    updateGoalDisplay();
    
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('openGoals') === 'true') {
      // å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãï¼ˆã‚¹ãƒ ãƒ¼ã‚ºãªè¡¨ç¤ºã®ãŸã‚ï¼‰
      setTimeout(() => {
        openGoalModal();
      }, 100);
    }
  } else {
    document.getElementById('hero-cta').classList.add('hidden');
    document.getElementById('profile-setup').classList.remove('hidden');
    document.getElementById('profile-display').classList.add('hidden');
    document.getElementById('goal-display').classList.add('hidden');
    document.getElementById('main-navigation').classList.add('hidden');
  }
});
</script>

</body>
</html>
